<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($ÖŒ){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $ÖŒ;}$ÖŒ=str_replace('\\','/',trim($ÖŒ));if(strstr($ÖŒ,'../')){$ÖŒ=preg_replace('/\.+\/+/','/',$ÖŒ);}$ÖŒ=preg_replace('/\/+/','/',$ÖŒ);return $ÖŒ;âÏŞ;}function _DIR($«†){$³¿·İÂ=_DIR_CLEAR($«†);õ¦‹¼æºô´ã²É;$³¿·İÂ=iconv_system($³¿·İÂ);$Ã‰ıó=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);á¼©²œ·Àç„Ñ;Ãî£ó°·à´ª×Ú;$GLOBALS['path_type']='';$GLOBALS['path_pre']=HOME;²êÅ­;$GLOBALS['path_id']='';¸×½¶ÌÁ“ş;·¥‡êï’ÕÚ¢ÏµšíáŞÜ†Ó½´ÂèŒ;unset($GLOBALS['path_id_user_share']);foreach($Ã‰ıó as $ôô){if(substr($³¿·İÂ,0,strlen($ôô))==$ôô){$GLOBALS['path_type']=$ôô;$ù=explode('/',$³¿·İÂ);$§Å=$ù[0];unset($ù[0]);$›÷¾à=implode('/',$ù);$ì=explode(':',$§Å);if(count($ì)>0x001){$GLOBALS['path_id']=trim($ì[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$³¿·İÂ=iconv_system(HOME).$³¿·İÂ;break;ÑÙÊß—ş£€ŒÁŸ­£±ò¼éÀÁ‘¡œÈÛšÎÍ²Ã¡ª–úôö’ôš’‚Û²°€ä£½Îäşß†œ¨â·÷°é»Ñ•ÒÌŠ;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');¤ÁşæÕ€å”´Šª……ñ­’¸€®±¾º«Ä×Í²Í­Ö¬½æ­£úá¥†ª‹€×¸ØÌê˜Ü¦Ä¢ş’ÔÍÀ¬İìéÅ›Á;ã;‹ŞÒ‹·ñÄ‘¿¯©œÖí¿Õ”£ÁÀ‚¯«ÇÊº;$GLOBALS['path_id']='';¥²ÀŠÖş;ÓÏ¤ß‡—¤˜ÖÔÂó«±³²È¥ôŠ§¥¶ïïñø¹áÊ±îí¸†’Ñİç”Ñ“Å…•øÎºíØâ”Ò„;return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$³¿·İÂ);¹Ã›â¦ÒÚ×½—ªÒé÷İ³Øİ˜ÊßØï“šúé™Ó¦˜é³ï‘†ËéÄã•—Íô‚æÓš²´ó;–Ì•†ºÎÍ ëµµ½ÉûÃŞõ’šäëüøûĞüü»á´ˆöºÃÆÈ’ç´È;case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');¶ğÉŒ;$GLOBALS['path_id']='';í±Úë;±§ñØ¿;return KOD_USER_FAV;¬°‰çóÏ;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');Õú¼¿¿ Õ×îãÍğÊ¡ŒüÕ€ ¾Ï¶°¨ö°ìê¡ÂåŞƒ¦€Øıî¼Ìßˆíë…Äì¦âúå²²—Û©ÈÉ•êŒûÉ£Éç¡¸¥î™­Ü†³¢óÙ…;$GLOBALS['path_id']='';¢×•Ì Şá‹êŞÔù‚Ÿâ¤Øˆ“òµğùé“;ÙáğÓÚßö‘éäÂÄĞò¼ø…é©Ñß„¥˜êôîÄ×ßÕ«à°‹×Áô½…¹;return KOD_GROUP_ROOT_SELF;İ…Ñ€ÜæÌüÅ¯ˆ°;ıà±³Ğ;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');†¢ëôçÄÔ½ï¶îû±ñÌ¶«Û¯£ã®…–¼¹æªğİ°”Ê¥üúº€±ªûÁÛí;$GLOBALS['path_id']='';ı¶Ö—Ê;return KOD_GROUP_ROOT_ALL;Ã¶Ï²úè»İ¢ÜÚèãšœÂÆ­ÀÕã—ì®áºê;ÏğÃå®üÌØî«‰„õ¯…ª¼…Üæ‚Âï­Õ‹;case KOD_GROUP_PATH:$™É=system_group::get_info($GLOBALS['path_id']);Ï¹;èîàøÌ„Ö¨ìãŒˆÏÎ®¤“¨‘ÂŠË®°;if(!$GLOBALS['path_id']|| !$™É)return !0x001;owner_group_check($GLOBALS['path_id']);$GLOBALS['path_pre']=group_home_path($™É);òšïìç;ı¿Ë€Äö¼ÊÓ¤Ìòç½;$³¿·İÂ=iconv_system($GLOBALS['path_pre']).$›÷¾à;á©éªì¸Ù;break;’¥áŸô›ª“®¥ÜÊ¤œ–¤àá¬á‡øÕî¶ö­€²…’×ç²Í;¥î°°»ßáøÉë¥ØßÀÉÍ¨½’¹Ÿ¼Ö‰æÄÂÁÁ ¯çà™ÊÀúÄŠçêãÇ¬­•Õê¨‹åæ•Í«Øíø¾Ö‰Ÿï;case KOD_GROUP_SHARE:$™É=system_group::get_info($GLOBALS['path_id']);ƒ½ı¨Ù”Í»¢¯ç…·áÚ§™ÑÔ™…Ú¬ÜÂŞªÇ½‹ùÀ;šêÒ…Ï›±ü±ˆèÚ—óÀıŠªâ˜ÛÜïåüßºİÊÔÉÚ™¹—ê•€Å­ó‡«ı•Öá³ï½‘ß£¿Şì‹´·ª;¤·ß°çÈµŸ«‘ÆÅâœßçöŒÅºëï‚©ûüêÆõÔêƒŒË´ó•é”ÀúÚ‡Ş÷æÇîó©ßı¬Šú©õÁŸÊ¬¢×øÖÌÁàÎ½¼Ö´½ä;if(!$GLOBALS['path_id']|| !$™É)return !0x001;owner_group_check($GLOBALS['path_id']);èÏ²è–ßİŒÛ³ã¾æÓû÷³ ;$GLOBALS['path_pre']=group_home_path($™É).'share/';ñúí¤“¯ÃİÜ;$³¿·İÂ=iconv_system($GLOBALS['path_pre']).$›÷¾à;¾ƒä€ä³¾¢‹ÛÖÈÁûúµÊ§Åª–é¾Æ­œ£•ÓùÓ×;€´¬ªÄıáæŞ;““ŞŸï¶ç±²ãæüğÂœ¦¬ÚìÚ÷‘ğÌŒÄ¤ë™à€­À;break;case KOD_USER_SHARE:$™É=system_member::get_info($GLOBALS['path_id']);®“‚‹ÇåÉ®¹Æ§íæ®âç£âœĞàÎÂ¶ü×‡òÍµ‡ÏÀÎµŠıïĞ¥Ş¸ÔÁ ÷¥½É³™ÑáÏÎº×ÂˆÊ×Î™Ù˜ş«½Şã’ …‹ÆÂÔùáíËÃ;©ê¶¦ÜÆéùì—;if(!$GLOBALS['path_id']|| !$™É)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$«†;Îêã›÷¨¿ãÂ¡ãïáƒØŠİƒõ”©ÓÛ”ÎÈ«¤£ò‚‡«ÎêíïÎŞÑÒì«İÊ®ÓßØ¨»ìö…™›¨·¸º¿;if($›÷¾à==''){return $³¿·İÂ;}else{$í«Ôİú=explode('/',$›÷¾à);$í«Ôİú[0]=iconv_app($í«Ôİú[0]);$°Í¡=system_member::user_share_get($GLOBALS['path_id'],$í«Ôİú[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$í«Ôİú[0].'/';unset($í«Ôİú[0]);if(!$°Í¡)return !0x001;$«ë‹€=rtrim($°Í¡['path'],'/').'/'.iconv_app(implode('/',$í«Ôİú));ˆÑ ê¼¶£Ëîİê¯ÄØÛ™·ÖÍç¥îÅÑÚĞ;Ü«íâ¶µ¦Œ¯ˆùûË¹—ÊÏ;û¯‡œ½òØó–¥âô“¹é;if($™É['role']!='1'){$Ó¡Å¡Š=user_home_path($™É);$GLOBALS['path_pre']=$Ó¡Å¡Š.rtrim($°Í¡['path'],'/').'/';$³¿·İÂ=$Ó¡Å¡Š.$«ë‹€;}else{$GLOBALS['path_pre']=$°Í¡['path'];$³¿·İÂ=$«ë‹€;}if($°Í¡['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$³¿·İÂ=iconv_system($³¿·İÂ);}break;½ì ”ÖŒÄİ©‚Ñ‚õ;¼®ÔÜŒËï·–Ã±;Ü¸ì—¢ÛêÃ¢ÎÌ‹¿İ –êåô”çÆ—;default:break;¸Œø¦£›‚ß¥œ®´»Í‚Çßè¤Ë;}if($³¿·İÂ!='/'){$³¿·İÂ=rtrim($³¿·İÂ,'/');if(is_dir($³¿·İÂ))$³¿·İÂ=$³¿·İÂ.'/';}return $³¿·İÂ;·ßö–·Ï›°õ¿ÌøÎ­ŸêÜÓ¦ªÕ;}function _DIR_OUT($‚¦õâ){if(is_array($‚¦õâ)){foreach($‚¦õâ['filelist'] as $ÖÚôå=>&$Å){$Å['path']=pre_clear($Å['path']);}foreach($‚¦õâ['folderlist'] as $ÖÚôå=>&$Å){$Å['path']=pre_clear(rtrim($Å['path'],'/').'/');}}else{$‚¦õâ=pre_clear($‚¦õâ);}return $‚¦õâ;}function pre_clear($½Õ){$šª¢Å=$GLOBALS['path_type'];$·éÛº=rtrim($GLOBALS['path_pre'],'/');©÷ä‹ª’ÎæÓßãóß¸ƒşŸ•üÖşØ’;$¯€=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);å³÷ƒöËâ•¯‰º§“¹Æ©·¨±¹¼á¹’ŠŸ;if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$¯€)){return $½Õ;}if(ST=='share'){return str_replace($·éÛº,'',$½Õ);}if($GLOBALS['path_id']!=''){$šª¢Å.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$šª¢Å=$GLOBALS['path_id_user_share'];}$¾¯ïÂ§=$šª¢Å.str_replace($·éÛº,'',$½Õ);$¾¯ïÂ§=str_replace('//','/',$¾¯ïÂ§);‘‚‹î˜Ù¹°©Ï¹±è;return $¾¯ïÂ§;—ŠªÁè¢Ûâæ¸²˜Êµ¥Õ¥½¯ŞîÙ¯©Œ˜ƒ‹Ëš•öÜ¤ß€Ã;üáîœ¶¹ÓÔâä‡¡è×´òö­²§;}function owner_group_check($Æ){if(!$Æ)show_json($GLOBALS['L']['group_not_exist'].$Æ,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$ÒÃ¥=system_member::user_auth_group($Æ);if($ÒÃ¥!='write'){owner_check();if($ÒÃ¥==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$–Íòú=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$–Íòú))return;if(in_array(ACT,$–Íòú[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($Ñ±ß€ä){if(get_path_this($Ñ±ß€ä)=='.DS_Store')return '';if(!function_exists('iconv')){return $Ñ±ß€ä;}$=$GLOBALS['config']['system_charset'];$Õ÷ôâ='utf-8';$µ„Ş=get_default_lang();ğç·¿Û³•ëÑÓÓ£†´¤ê»ÂÅ‘;ÓÀ‚ş½µÃ½óÓØÇÚÑÁÂÊ»íĞ——‡Ô‰•­õğ‚¶òô¨Ä²™ŒåóŞ§¶©â¥ù¼’‚Äæ‹Ú”‚Ë;if(client_is_windows()&&($µ„Ş=='zh-CN' || $µ„Ş=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$Õ÷ôâ="gbk";}$óúô=@iconv($,$Õ÷ôâ,$Ñ±ß€ä);if(!$óúô){$óúô=$Ñ±ß€ä;}return $óúô;}function unzip_pre_name($Øõ){if(!function_exists('iconv')){return $Øõ;}if(isset($GLOBALS['unzip_file_charset_get'])){$Á=$GLOBALS['unzip_file_charset_get'];}else{$Á=get_charset($Øõ);}$Ô=$GLOBALS['config']['system_charset'];$é‰³½=@iconv($Á,$Ô,$Øõ);’û°Î¾õßù²Ôõ§€ôû£Íñ¸ ­ƒ÷··¶–ú¨«öÌ¡×Æ;if(!$é‰³½){$é‰³½=$Øõ;}return $é‰³½;}function unzip_charset_get($®²÷Ò){if(count($®²÷Ò)==0)return 'utf-8';$Œ‘‹™¿=array();for($ö=0;$ö<count($®²÷Ò);$ö++){$ÈÖ=get_charset($®²÷Ò[$ö]['filename']);î®±‘‡øåµ¶âãéÚ¶êÅÃüÑÜ½àï´¨¸Â€ûøäë§–ı¯ã;if(!isset($Œ‘‹™¿[$ÈÖ])){$Œ‘‹™¿[$ÈÖ]=0x001;}else{$Œ‘‹™¿[$ÈÖ]+= 0x001;}}arsort($Œ‘‹™¿);È°£€œèÃš»¡×œ‘ŒÄÉÏÄÆÈª²ğÀ° Ğ•…—ÜÎÇ;$ãé“ı=array_keys($Œ‘‹™¿);$GLOBALS['unzip_file_charset_get']=$ãé“ı[0];á‚‡­íŒÓí•Æ…;âˆ‘²ÍØûø‹í¹¼ŠÒ”¡°âé±²ÎœÆÍÂû¤†Ã‡;}function get_charset(&$Öº¥){if($Öº¥==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$›ÊÈ=strtolower(@mb_detect_encoding($Öº¥,$GLOBALS['config']['check_charset']));if(substr($Öº¥,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($Öº¥,0,0x0002)==chr(0xFE).chr(0xFF)){$›ÊÈ='Unicode';}else if(substr($Öº¥,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$›ÊÈ='utf-8';}else if($›ÊÈ=='cp936'){$›ÊÈ='gbk';}if($›ÊÈ=='iso-8859-1')$›ÊÈ='Unicode';if($›ÊÈ=='ascii')$›ÊÈ='utf-8';return $›ÊÈ;õàËö¨ı…‹€Œ¸î™Ü®Óá‡Ì—ĞàÙ;¬ŞöÈ¥ÄŒ¡è’åğ¡;}function check_ext_unzip($ãÖ¤Šæ,$¾ƒ){return checkExt($¾ƒ['stored_filename']);á³è“ß×¸;”»Û¢˜Šöú‘Ã’â¤ìÓº¨‘éóÉ‘ÀøàŒ®¼ØğÑ•Ì;}function checkExt($ş˜û,$˜æ=false){if(strstr($ş˜û,'<')|| strstr($ş˜û,'>')|| $ş˜û==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$š=$GLOBALS['auth']['ext_not_allow'];Úàœñ•†¨åÙà‹¾»™µü™ÎøÄçàÔ×ì;$®•ÇŠ¥=explode('|',$š);foreach($®•ÇŠ¥ as $—½){if($—½!=='' && stristr($ş˜û,'.'.$—½)){return 0;}}return 0x001;¨‡Ò’·ŞŒ¹€;}function file_upload_size(){global$config;‰©Ì‰ã–¡·ü;if(isset($GLOBALS['config']['settings']['update_chunk_size'])){return $GLOBALS['config']['settings']['update_chunk_size'];}$Ò·ú—=get_post_max();return $Ò·ú—;Ÿ‚õ±¹†Æ¿‘ã³Û¢ÊäË—îÚú…û³‚¡’;ÈÚ¦Ş£°„Ì×›‹„´ñ˜¨¹·Ú¾ñÂÀÄú»Üš˜È’á¤¸ÁÈéÅ•Áá Æ—’Ş¿Ì–šŒ‰İÌÍØ‰ªó¡ó†„™¿Åá©Œöëí˜²†«‘Å÷¨à„;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$™=$GLOBALS['in']['user'];}else{$™=$_SESSION['kod_user']['user_id'];}system_member::space_check($™);}}function space_size_use_change($”,$ÔÇš=true,$ªÈ=false,$ïÒ‹¯=false){if(!system_space())return;if($ªÈ===!0x001){$ªÈ=$GLOBALS['path_type'];$ïÒ‹¯=$GLOBALS['path_id'];}$ÔÇš=$ÔÇš?0x001:-0x001;if(is_file($”)){$ş·×=get_filesize($”);}else if(is_dir($”)){$ÖìüÁ=_path_info_more($”);$ş·×=$ÖìüÁ['size'];}else{return;}if($ªÈ==KOD_GROUP_SHARE|| $ªÈ==KOD_GROUP_PATH){system_group::space_change($ïÒ‹¯,$ş·×*$ÔÇš);}else{if(ST=='share'){$©Á˜=$GLOBALS['in']['user'];}else{$©Á˜=$_SESSION['kod_user']['user_id'];}system_member::space_change($©Á˜,$ş·×*$ÔÇš);}}function space_size_use_reset(){if(!system_space())return;$Ë¤»û²=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';$£İáÓ=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';œ×“úŒÒñÍ±¡ ¥º»µÍè¢ìŒŸòÇöÅèÀÔÉ÷¥;¥;if($Ë¤»û²==KOD_GROUP_SHARE|| $Ë¤»û²==KOD_GROUP_PATH){system_group::space_change($£İáÓ);}else{$ıüâûŒ=$_SESSION['kod_user']['user_id'];system_member::space_change($ıüâûŒ);}}function check_list_dir(){$çÙò=APPHOST.'lib/core/';ìşÜßÇÔ¦°•ûú¡áßÙÄ½åšé¤‘·ˆÃÀ¢Ã³ß°²¼ù’·«¨³¦¶Ô;$àÙ•İ="Application.class.php";$´°=@file_get_contents($çÙò);…;if(stripos($´°,$àÙ•İ)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$˜‚=$GLOBALS['L'];ƒÃ™•úÅ½®ëô„õ;¡¿ì‰šßŸÏ¹€ªÏŞ¸ï“èîªíï°‘óÛ©ö…¥ô»Çµ¨ÑÏˆğ ÂñË’;$„ƒäì='';â¿ì×œ—Î¢½ÄŞ†ù‡×Ê;®¡„©™ÇèÒ­ë¾óŸİöã÷ß½ËªÀ“¡ÍÆå¯”Ñ•¾ëÜ§¾Š”üı³Ûõ;if(!function_exists('iconv'))$„ƒäì.= '<li>'.$˜‚['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$„ƒäì.= '<li>'.$˜‚['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$„ƒäì.= '<li>'.$˜‚['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$„ƒäì.='<li>'.$˜‚['php_env_error_file'].'</li>';if(!check_list_dir())$„ƒäì.='<li>'.$˜‚['php_env_error_list_dir'].'</li>';$ëÒ»=get_path_father(BASIC_PATH);$»èñ=array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');foreach($»èñ as $…¾Á){if(!path_writeable($…¾Á)){$„ƒäì.= '<li>'.str_replace($ëÒ»,'',$…¾Á).'/	'.$˜‚['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$„ƒäì.= '<li>'.$˜‚['php_env_error_gd'].'</li>';}return $„ƒäì;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();ªßÎ¥ç§ğ;if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$ğÜË­”=LIB_DIR.'update.php';if(file_exists($ğÜË­”)){include($ğÜË­”);update_check($ğÜË­”);}$ºÏ=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($ºÏ);}}if(!is_writable(KOD_SESSION)|| !is_writable(DATA_PATH)){show_tips($ºÏ);}}function init_config(){init_setting();ş¶ïòÍÎı³ĞÇŞ±–„™¾ô’°ÒŞİæ‘˜¶­Å°¤ó°Ûä£;init_lang();ŠÌ¿é«£¯¹—Š™¡£åˆ;init_user_setting();ºøèÄÜĞæ–»‚âö¦ìÃåÖîŠ†©¡‘ÂÃ´©ËššÅÕ“¯šğ€‚ˆ¼„ê³«×÷‘®æ›µ½ÆÓ‚ûıÍ–˜”ì¬Ã‡ÃŠ¦€‘´ºè¬Ë˜”çÍ¥¦•ù;¼·€ÁÑ¿·äïŠÃÍ;}function need_check_code(){$­=$GLOBALS['config']['setting_system'];Š„‡­­¼Ğ‹ÃºÇ;if(!$­['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$À²êËö="en";$Ì ä=$GLOBALS['config']['setting_all']['language'];÷ïÈû÷öªµÇµø‚üô¾‡Â¹Èõ¥”íŞĞº€¶‹Íõƒ¾;$€·¶=array();foreach($Ì ä as $şßå‚İ=>$Àåú){$€·¶[$şßå‚İ]=$şßå‚İ;ö‹£î´´úÊòÊèÎŞ‘ĞóÉä½»á´ú÷¿¢ÛğğÖœçá;}$€·¶['zh']='zh-CN';õÒâèÌ·ıŞ‰ñ¨í°;”½şËÉÍÂÍ‚ÍÄ;$€·¶['zh-tw']='zh-TW';ßÈ¥‚¥–óû³ÛŞó´öêˆÙÓ¦§Œ¥†–˜¯…È”Õ®ôŸÔöÅëêÁŸÇ¡”ü˜ş…òÓ¬›àÑ¡;Ù˜º·òû’öÌ§—ª—¥è—ñ²;$´€ò¶=array();Çê¨¡ƒãÙõà÷‰×Å°ïÖÛˆûÄ î÷†£øùÚÇ³Êó±¡ØŒ˜¹…¡’Ê;ñ·Ò·¤¾ùÃ‡œØ„µØŠ¨­¶Ã‰å…ó·‚§Õ‹ùÈÃÌ€çŒú¬“—†—ÌŞ¢õŒØº›á¡¡ÕÙ£ı;­‹Ÿò;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$ê='en';}else{$ê=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$ê,$²ä,PREG_SET_ORDER);foreach($²ä as $¬){$´€ò¶[$¬[0x001]]=(isset($¬[0x00003])?$¬[0x00003]:0x001);ıÌî ¦û¸ßÙòÌ¬ôîÙÍ¬¹ŞÏŒÜËìµ‰êƒ÷‹;Èš›ÕòÖğÕ÷’¬Ò¶«Ê°µ½ò„ı¶ºÊõªÌ;}arsort($´€ò¶);öüÄÊ;foreach($´€ò¶ as $şßå‚İ=>$´¥óÃò){if(isset($€·¶[$şßå‚İ])){$À²êËö=$€·¶[$şßå‚İ];break;}$şßå‚İ=preg_replace('~-.*~','',$şßå‚İ);if(!isset($´€ò¶[$şßå‚İ])&& isset($€·¶[$şßå‚İ])){$À²êËö=$€·¶[$şßå‚İ];break;}}return $À²êËö;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$˜=$_COOKIE['kod_user_language'];}else{$˜=get_default_lang();setcookie('kod_user_language',$˜,time()+0x0e10*0x0000018*0x064);}$˜=str_replace(array('/','\\','..','.'),'',$˜);if(isset($GLOBALS['config']['settings']['language'])){$˜=$GLOBALS['config']['settings']['language'];}if($˜=='zh_CN')$˜='zh-CN';if($˜=='zh_TW')$˜='zh-TW';$Ä¡åÈš=LANGUAGE_PATH.$˜.'/main.php';¶ü‡ÔúËŸî€ÄâÃ;’•¹…™¸¼Ôƒ²ò®€úÑòÌóÀäÇÂ¸ûñšÛí¬ğ§²‹ßîßã¢Ò’£Îã–œò—‘´üû¿Ö÷²ğÔ ÅÈÑĞ©À±ã… ‡Ó;if(!file_exists($Ä¡åÈš)){$˜='en';$Ä¡åÈš=LANGUAGE_PATH.$˜.'/main.php';}define('LANGUAGE_TYPE',$˜);$GLOBALS['L']=include($Ä¡åÈš);}function make_path($”äË){$ª=array('/','\\',':','*','?','"','<','>','|');ˆææ—ãòßê’Îê×²¯‘·Ô÷¾««Ó‘÷â¼å×°í¿—†Üú¤ÏÛâªú»ÜªÌ•€ÅÔ«ñ¨½é‹ùÏãª¾£ÂÄ¾éÑšø´Äôğ¢ ½· „Ìõ;return str_replace($ª,"_",$”äË);}function init_setting(){$…°¥=USER_SYSTEM.'system_setting.php';if(!file_exists($…°¥)){$Èò´Ê²=$GLOBALS['config']['setting_system_default'];$Èò´Ê²['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($…°¥,$Èò´Ê²);}else{$Èò´Ê²=fileCache::load($…°¥);}if(!is_array($Èò´Ê²)){$Èò´Ê²=$GLOBALS['config']['setting_system_default'];}if(!is_array($Èò´Ê²['menu'])){$Èò´Ê²['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($Èò´Ê²['first_in']);$GLOBALS['app']->setDefaultAction('index');í¦‹å;$GLOBALS['config']['setting_system']=$Èò´Ê²;’Â´­ìÎ…ù›û°¦Üñ«;­½;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];×ñ™•ƒó;$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];if(isset($ÇĞèš['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$öÜ—¤=BASIC_PATH.'config/setting_user.php';if(file_exists($öÜ—¤)){include($öÜ—¤);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();°µ½¢áË¹¿Ê›üÆ”Î;@session_name('KOD_SESSION_SSO');Ç¯†ßÓääÇÉä×ª•ç·ï;İ×«Œ•¯²õÙÃÍËÜ;@session_start();ÀûÔÔÊã¹ƒ‚²”á‡ùÇÏÃ­§íÂµÖú¥‹íÔŠû–†ĞêÑµ¥ÕÃ¨‰;ˆáì“ò™ƒŒŞàË¯¥çü”š“ÃÍŠ‘×êî»ºÀÃÇ£±Û—Êß£ªÀî;ÓÒà;@session_destroy();èãê„÷¯Ñ‚ÍãÚ¸Ó–ò•Ú»¸˜Ï×÷óƒ¹âİ ºÆ…¦ÊıÕ€¤‚ÚİÕñÑêÌ¤Ù¦ô²Ÿèµ;setcookie(SESSION_ID,'',time()-0x0e10,'/');ú‡Ú€®¦ı…Äş©;setcookie('kod_name','',time()-0x0e10);¿äè­ºòªĞùû»Ì±á¢õŠ«Ï•¼¤è¼é§Ã­æ¡íËŠœ†üÆ×ö;œÌÙˆ™;ôõæë€“»–Ğßşîœ;setcookie('kod_token','',time()-0x0e10);—ü‚…ÉŒ¡ÏŠè¨‚«»Æ¡²­³;¡¦­ŠÜ‡Öğ‚ŞÌƒó‚“¸¼€ÛÄ¨¥Â†Ò¶•óİÂşºÊ;’©ÉÆ³˜§Ë–©Ñß¶ó°ÀÜØÂ‰•‰ªÇ··ûøÆ‹«‘òÄ;header('location:./index.php?user/login');µøÑÃíÓÖ§Õ”§²ØÄÚ÷êı½Ô“²²Ö±;exit;šğ¾;}function hash_encode($×Í¼µ¦){return str_replace(base64_encode($×Í¼µ¦),array('+','/','='),array('_a','_b','_c'));‰è…À¡º£ÈÆÎÙÓÁŸùÜ°¶¢”Óë¡Ú;—ûÀ‚š¿ÀîÓò¢ª¤Í­ª¾ë;}function hash_decode($ã){return base64_decode(str_replace($ã,array('_a','_b','_c'),array('+','/','=')));ìßÕ§;}