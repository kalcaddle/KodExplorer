<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($åØ){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $åØ;}$åØ=str_replace('\\','/',trim($åØ));if(strstr($åØ,'../')){$åØ=preg_replace('/\.+\/+/','/',$åØ);}$åØ=preg_replace('/\/+/','/',$åØ);return $åØ;Œ›¥¦×;˜«®ÑïÔ°‚™¡ĞÛÇÃ;}function _DIR($¾©¹Ô){$¬ú=_DIR_CLEAR($¾©¹Ô);¬ÍßÜ³¹Ì;­;$¬ú=iconv_system($¬ú);ç€éÖµƒÜ‡Â†À—ÌĞÃÈ¼ÔéŞµÇ;¾şïíĞàÂ‚âÛ¤´¸ëø†ğ¾ÃòƒÆ…¢Ì¤ËÇ‹†Š€óÛá¶ŞÅ“ƒúÌ;$•Ÿ°îÇ=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);ØÙû¦ıÇí‰Øó“Ùèî» Í´ÑûÁğÔ¢£ëõÙÊÏ´Æõ²;Çı;$GLOBALS['path_type']='';$GLOBALS['path_pre']=HOME;ØÏÁÂ¿üâş˜ßú™¢ëíÄÚ»ê¥‹Ÿë‚ÒúæâÀß¤ƒ ¢æ¯¡ş˜;$GLOBALS['path_id']='';à÷˜¥ÀÕµ–À”Ìˆ¨»Çì…ıÙ‰;unset($GLOBALS['path_id_user_share']);êŞØ—§¹ÀŞ;foreach($•Ÿ°îÇ as $–•çÖ){if(substr($¬ú,0,strlen($–•çÖ))==$–•çÖ){$GLOBALS['path_type']=$–•çÖ;$´ß=explode('/',$¬ú);$ğı›İ=$´ß[0];unset($´ß[0]);$«=implode('/',$´ß);$‹…ìÑ=explode(':',$ğı›İ);if(count($‹…ìÑ)>0x001){$GLOBALS['path_id']=trim($‹…ìÑ[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$¬ú=iconv_system(HOME).$¬ú;½ÕÔää¥î¶¼„Ÿ”®ÓôÅóœ¤ÈˆŒÎõŞ¬òœêÉñĞØÖöÈ´Ì¬Èú¾û;‰™Ó¸»ÒÈØëúâòòıÕ¦„Üå©Ğ§£ÀÏ«’¹”Š¦¤ùÖßÌ ¹¹›¬›ƒµŸß›É±Ãìñ”™…Í­óË´í£•»ÃÏôßì¢îˆ¥¥§†;ë³áôÀ°êŸİŞ;break;…Ş«™÷°ç¦ÁÛòõÊ–Œ†ÚÛûºÈŸªÑÅÏùË‘ë…—Ë°°Äá˜ê£ô;š‚…‘Ê“Å˜À“ÂÎŠ;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');ô¦ÆĞƒÃŒÌâ¶¨‡™ô;$GLOBALS['path_id']='';êõ¼Ö•;return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$¬ú);case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');ªà–ù°îßÊ¯Õñö¦õº²ÂéáÆğú»‰¶;€şâ…®™ÖÆÙæÚœµê¦·•ì¡‰ãİàùø—ËİöËÜÚÑí‰êÅÏÄ¬ªáá–‰š«¦‡Í°ë¬‘å¥¨±„;$GLOBALS['path_id']='';return KOD_USER_FAV;ÏÏ„»–ÔÂ€â¥—ë¿Â“ÇÃ³¼Ô™âıËçÉÉšššŸÕ°ô×óôº™Œ§ÙÏ»¡àşÕÔïÒ»éñ…³Œ Î«öş Îò–Š£²çò;èî”êŸ„Êê´¡İ«ÇÓåú—;ìßñÂÏó•‹İ‡‘’;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');$GLOBALS['path_id']='';Öô‡àõ¾šÈ µ²Ê°Îèœ„‹ù¯ÓÎ–Îåš´ßåŒÔíìÊ­ˆ”Î½ÆŞ‰ä×Î¬ÜÚ¦Œ®ô¢ı;ààøÔ÷ƒâ›µÊ¤Ôã’´ÖÔ…;return KOD_GROUP_ROOT_SELF;©ñ£»†ÕÆşı¨÷;»£¿’­Ú¿µïó·ìüüÕë©²Æ;¶¼²ÌÖÕ°é‹‡¾Ñ©¡û›Ä·¢šÕèšÔ‘“¨²ßï;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');š·ì„ÂóÃÓÆìôÂ‰ºú«ÕĞ”ğ¥¦„ÎÙ•®ÉØ†òÈó÷Œè¼;Æáó¢Ÿ§ŞÃæîÕ•Ê•Ê»£¿ò‘¼’ü¸ÅÄ‰„ºÏæ®ò†ÕÑÉ½Á ÒµÈØİ»é;Õò²‘îİæÀò×æ™Üµó;$GLOBALS['path_id']='';ÊõÄ¾¾¹·Ê¢ó«Ó‚ÇĞ“¶¯ùö£ÒŞ½¯”±¡ùïëïµª¯îáù’;return KOD_GROUP_ROOT_ALL;ô¨­Æ»äö¶Üš‰»Ø¸ĞŠÙËúÆ»°ñê Ôå²«Œ;È±ò»÷ÈŒŞöşåÍÑ°‹“Ğİ ‡üèßÚ¥ÊôñÄ£ºõ–È;case KOD_GROUP_PATH:$µÇ=system_group::get_info($GLOBALS['path_id']);Ş¨Šù±ÆÒê—İÅâØŒŸŠş‹ªÓğİ€ı÷¡³¿‰¥ìè;if(!$GLOBALS['path_id']|| !$µÇ)return !0x001;owner_group_check($GLOBALS['path_id']);€¾¶êÖ”±ºí½Ù÷¼ä£‘Õ‘Ôø²ˆ¹»®¦¥üŸ‰üİ¿è´ÔšîÂØÉ»–®Ş§…ß¸ÙÙëâ“¨‘ºÍÙÖŒ·—õìë‘Ü¯é¦ê;ÔÖ†â£×Á;$GLOBALS['path_pre']=group_home_path($µÇ);Ûªáµ…Í™˜õ«ÓÄº­›Çå²½Ó;®¿™Ó‹ÅÏ²ÆÉÊøØÜ·Çæõ¾†¤¡ªûãîÚ¢›¼ñ¦Ë¸;$¬ú=iconv_system($GLOBALS['path_pre']).$«;¹×ºº®…âŠ°ÄÀµ’ÙÎ‰†£ÍÀÑé‰¸œÆŒ¼;¼È…¶¡áîéÉä‡ˆë«ª–¨…ƒ°£ì•Å¹Í»¸ˆø¯£ïŸ¹„•ÂïÁì;break;case KOD_GROUP_SHARE:$µÇ=system_group::get_info($GLOBALS['path_id']);í«¯™ÅÒÒ”;ŒÅËîÏü´²Çê‚Ğñ¥;if(!$GLOBALS['path_id']|| !$µÇ)return !0x001;owner_group_check($GLOBALS['path_id']);$GLOBALS['path_pre']=group_home_path($µÇ).'share/';$¬ú=iconv_system($GLOBALS['path_pre']).$«;°¥„½â›ûî;break;÷×‚ç¨şœ¹²ã;case KOD_USER_SHARE:$µÇ=system_member::get_info($GLOBALS['path_id']);if(!$GLOBALS['path_id']|| !$µÇ)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$¾©¹Ô;if($«==''){return $¬ú;}else{$—ÚÔ=explode('/',$«);$—ÚÔ[0]=iconv_app($—ÚÔ[0]);$Òİ‡=system_member::user_share_get($GLOBALS['path_id'],$—ÚÔ[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$—ÚÔ[0].'/';unset($—ÚÔ[0]);if(!$Òİ‡)return !0x001;$„=rtrim($Òİ‡['path'],'/').'/'.iconv_app(implode('/',$—ÚÔ));if($µÇ['role']!='1'){$æ¦½=user_home_path($µÇ);$GLOBALS['path_pre']=$æ¦½.rtrim($Òİ‡['path'],'/').'/';$¬ú=$æ¦½.$„;}else{$GLOBALS['path_pre']=$Òİ‡['path'];$¬ú=$„;}if($Òİ‡['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$¬ú=iconv_system($¬ú);}break;Œ‹¨óÑ‘‹Àõ°õ«Ç;default:break;¥Ş;}if($¬ú!='/'){$¬ú=rtrim($¬ú,'/');if(is_dir($¬ú))$¬ú=$¬ú.'/';}return $¬ú;‘úÆ×Î™ìİ¥Šå²µâÑö¡¨ÓõÀ¡‹ÆõŒÇ×ùôé;}function _DIR_OUT($¨¢ß){if(is_array($¨¢ß)){foreach($¨¢ß['filelist'] as $®ë¢½ß=>&$Ëğ€æ){$Ëğ€æ['path']=pre_clear($Ëğ€æ['path']);}foreach($¨¢ß['folderlist'] as $®ë¢½ß=>&$Ëğ€æ){$Ëğ€æ['path']=pre_clear(rtrim($Ëğ€æ['path'],'/').'/');}}else{$¨¢ß=pre_clear($¨¢ß);}return $¨¢ß;}function pre_clear($Ô”Œùó){$¤Ø=$GLOBALS['path_type'];™·Æø±õ;$Ô´ÅÈ=rtrim($GLOBALS['path_pre'],'/');Àú¤îëÌ¯ëµšŞ;$Ÿù=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$Ÿù)){return $Ô”Œùó;}if(ST=='share'){return str_replace($Ô´ÅÈ,'',$Ô”Œùó);}if($GLOBALS['path_id']!=''){$¤Ø.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$¤Ø=$GLOBALS['path_id_user_share'];}$óçÈ=$¤Ø.str_replace($Ô´ÅÈ,'',$Ô”Œùó);$óçÈ=str_replace('//','/',$óçÈ);return $óçÈ;‡•ó–ºÎ‡öìÕ¬²­;ÁÜˆÜ„ğÍ ºÄ»;‹âÍ¾×µ‡×˜ÄşŸÙò¶”…–ˆ†ôÛº¨úç“ã¤ÇñÜŸ¨ä÷Á;}function owner_group_check($ë){if(!$ë)show_json($GLOBALS['L']['group_not_exist'].$ë,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$¯ó=system_member::user_auth_group($ë);if($¯ó!='write'){owner_check();if($¯ó==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$ø‘ûá=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$ø‘ûá))return;if(in_array(ACT,$ø‘ûá[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($È¡){if(get_path_this($È¡)=='.DS_Store')return '';if(!function_exists('iconv')){return $È¡;}$À=$GLOBALS['config']['system_charset'];$°¸Å´='utf-8';ÖÍ¹;ûı„ ¼í¡µ€;$—¥=get_default_lang();ù«ıî¦ñ¦ıíºôîĞ÷àµŠòÔàÁİ”Ö—¥°æï‚áœ€ÑÂñ÷Áß;if(client_is_windows()&&($—¥=='zh-CN' || $—¥=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$°¸Å´="gbk";}$©—Œò¹=@iconv($À,$°¸Å´,$È¡);if(!$©—Œò¹){$©—Œò¹=$È¡;}return $©—Œò¹;}function unzip_pre_name($Äì){if(!function_exists('iconv')){return $Äì;}if(isset($GLOBALS['unzip_file_charset_get'])){$ù‘ÁÈ=$GLOBALS['unzip_file_charset_get'];}else{$ù‘ÁÈ=get_charset($Äì);}$¾Æ=$GLOBALS['config']['system_charset'];$Şƒ=@iconv($ù‘ÁÈ,$¾Æ,$Äì);if(!$Şƒ){$Şƒ=$Äì;}return $Şƒ;}function unzip_charset_get($ ){if(count($ )==0)return 'utf-8';$¹ ï¤=array();½ÂÅòß‹ß;Ÿ¦ì…Äæş¸øŸŞò¯‡ÍÜ°ú;†Î“Ä–¹¤™Í¦ÓâÆ;for($ç=0;$ç<count($ );$ç++){$Á=get_charset($ [$ç]['filename']);ïÑ;if(!isset($¹ ï¤[$Á])){$¹ ï¤[$Á]=0x001;}else{$¹ ï¤[$Á]+= 0x001;}}arsort($¹ ï¤);ºäÂÆÅ‡Ì·›ËÒ±†÷ËÔ ·åÅÔÎÜ—ƒûŒôİÆÚ  §ÙØµõ¥‰¨«ô€ •¸†ÛÕ¹¥Øµ±Í”ø¨µ†Éİà£;$×=array_keys($¹ ï¤);ô;$GLOBALS['unzip_file_charset_get']=$×[0];• Ôó“…ûáá¬İ®÷ı­¿;Œ®Åè¼œ¢âôØ”Ãìì£•¶öÚ•Î£³Ğ˜ÒÆ’Ó½Ø¼ùôŞÜê·ñ®¥€›È;}function get_charset(&$­ß){if($­ß==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$Ñ”­ê=strtolower(@mb_detect_encoding($­ß,$GLOBALS['config']['check_charset']));if(substr($­ß,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($­ß,0,0x0002)==chr(0xFE).chr(0xFF)){$Ñ”­ê='Unicode';}else if(substr($­ß,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$Ñ”­ê='utf-8';}else if($Ñ”­ê=='cp936'){$Ñ”­ê='gbk';}if($Ñ”­ê=='iso-8859-1')$Ñ”­ê='Unicode';if($Ñ”­ê=='ascii')$Ñ”­ê='utf-8';return $Ñ”­ê;ùÈ¶Ó…±Éä´œãÂ‚€‹˜ÒÕ¦¶ƒÓÊ°¾²¥¸¬îî€ó¡ÊØ°şõ±â¸´âÄÍ¶›ó¸Ñ÷Œ©ËĞÏ„ı¾óş³•ÉŒÅÈƒ÷¬¼­úÆœï€îç‘;}function check_ext_unzip($ ÑÚÓ,$¤à®íä){return checkExt($¤à®íä['stored_filename']);Á–¡»«ôŒÁØÎ©ë§Ñ´Ü ±§„å’Ü¡÷–Šºşêü–Œ¸Â‚Å„Ú”®Æ¼€ú™ ­À¯²§ÂÉ»¦Óõ¦¿ó¼;}function checkExt($ñ¿Àñ,$©€=false){if(strstr($ñ¿Àñ,'<')|| strstr($ñ¿Àñ,'>')|| $ñ¿Àñ==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$·=$GLOBALS['auth']['ext_not_allow'];Ñ’ğöó;’„æ÷ª¦ìæòšæÂêë•œİÚÎÊº¢äÚ¥³¢ëµì•œå¿ÂÒ§¶íø;$ØÆşù=explode('|',$·);§ˆô‚­¨¥š¹Ú;foreach($ØÆşù as $ìœ){if($ìœ!=='' && stristr($ñ¿Àñ,'.'.$ìœ)){return 0;}}return 0x001;ÖÊ’;ºÁµñ¯Äë«½Ñ½; Üí©¯›¦õ»ŒÎƒŒÉŸ¶çŒÒÆºáÓ‘ğ¤Ù„Ô;}function file_upload_size(){global$config;if(isset($config['settings']['updload_chunk_size'])){return $config['settings']['updload_chunk_size'];}$À¸»=get_post_max();return $À¸»;€ĞÔ ‡;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$ç=$GLOBALS['in']['user'];}else{$ç=$_SESSION['kod_user']['user_id'];}system_member::space_check($ç);}}function space_size_use_change($ö,$ú=true,$îû=false,$Âå¼˜†=false){if(!system_space())return;if($îû===!0x001){$îû=$GLOBALS['path_type'];$Âå¼˜†=$GLOBALS['path_id'];}$ú=$ú?0x001:-0x001;if(is_file($ö)){$Ùœ=get_filesize($ö);}else if(is_dir($ö)){$²–Š©=_path_info_more($ö);$Ùœ=$²–Š©['size'];}else{return;}if($îû==KOD_GROUP_SHARE|| $îû==KOD_GROUP_PATH){system_group::space_change($Âå¼˜†,$Ùœ*$ú);}else{if(ST=='share'){$’¥§=$GLOBALS['in']['user'];}else{$’¥§=$_SESSION['kod_user']['user_id'];}system_member::space_change($’¥§,$Ùœ*$ú);}}function space_size_use_reset(){if(!system_space())return;$™”=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';ÚÌÇ³ù¬Šı¥¬Ñ «®à»ˆ•¢ÊêÇŸ‚;$îÂîõ=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';if($™”==KOD_GROUP_SHARE|| $™”==KOD_GROUP_PATH){system_group::space_change($îÂîõ);}else{$ª§Ÿ=$_SESSION['kod_user']['user_id'];system_member::space_change($ª§Ÿ);}}function check_list_dir(){$ú’ =APPHOST.'lib/core/';$´¤™="Application.class.php";•¯ŠµàøĞ„–¯¨µõ¬‡ÓºƒåÛ£;$È=@file_get_contents($ú’ );Ïğ–ÙÏÔ‰Ô—ö•‡îÒœ”âÒä¢éñé˜¡ü°îÖé¾È;if(stripos($È,$´¤™)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$¶Åœ=$GLOBALS['L'];ÉÀ„øè¹ï–ÀÄÑÃ«­çË¾±‡À·ØŸñåÔ¤ûä˜Îº‰åûÍ·Àøå©Å;…™ûŒˆÏ¨²û‚Õæó¿ş–¼°…”šÃİœÜõ­;$Ìåê…='';if(!function_exists('iconv'))$Ìåê….= '<li>'.$¶Åœ['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$Ìåê….= '<li>'.$¶Åœ['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$Ìåê….= '<li>'.$¶Åœ['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$Ìåê….='<li>'.$¶Åœ['php_env_error_file'].'</li>';if(!check_list_dir())$Ìåê….='<li>'.$¶Åœ['php_env_error_list_dir'].'</li>';$÷=get_path_father(BASIC_PATH);¢–„Áû…;$Ê¿â±=array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');Ï©èåæšêûµ®ÙÑ‹Ğ€Õé”¦œ¥ƒÖ…‰¯™ŒŠƒõÙ¬ß¿”ù«¯Ùê‚å¼‚¼¦—âÂ¼åšÂïÉÛûÔßñ¯Ñï¡Ì›²ü;foreach($Ê¿â± as $ü«Î¦ğ){if(!path_writeable($ü«Î¦ğ)){$Ìåê….= '<li>'.str_replace($÷,'',$ü«Î¦ğ).'/	'.$¶Åœ['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$Ìåê….= '<li>'.$¶Åœ['php_env_error_gd'].'</li>';}return $Ìåê…;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();÷»æéÂ‰ÇÊüÌ¥;if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$ˆù=LIB_DIR.'update.php';if(file_exists($ˆù)){include($ˆù);update_check($ˆù);}$ºãÆ=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)|| !file_exists(KOD_SESSION.'index.html')){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($ºãÆ);}}if(!is_writable(KOD_SESSION)|| !is_writable(KOD_SESSION.'index.html')|| !is_writable(DATA_PATH)){show_tips($ºãÆ);}}function init_config(){init_setting();init_lang();Û;init_user_setting();–¿ÙŠÀ¡Õ¾îúˆü„‚Æ¾æ;}function need_check_code(){$üÁê“Â=$GLOBALS['config']['setting_system'];œ…İÜßè¿Üğºäí¿ç´şÎÂ¤é¾¡«©µîğ¤Ì©ªê‰”‰‹ÓæüÌêÎ´ Î„ãòí£•šÍË‰¿ïÕÍš;if(!$üÁê“Â['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$°éª="en";ÔìÖ;È¬º—°Ÿ‹ŸÂ ¹ëÂĞÜ™Ÿ÷;$Øœ=$GLOBALS['config']['setting_all']['language'];$Í›=array();½•ŞêÏõ›ï‚»²£õÃ¹•;foreach($Øœ as $Ò´äí=>$Ïº){$Í›[$Ò´äí]=$Ò´äí;¯á¯›²¦¶¢¨òÔËè™Û¢®Éôã®ãğ±ƒœ‚½Í¾°½Ùâã‘…Œ„;”ù‹Í“ß»éİŸÛØ÷‡öóÒ™ÑÚô“¦«Ùˆ©Æ¤Õ¨ñèˆ­ÒæÌãÂ¦ÛÊĞ·¢ø¬²ÒİæÛ‡®ù«„¢í«ÌÁ“š¥ÖÀ¡ŞÒÀ—õ¹Ã;ô´£ı†‡­éøßì•á«¤°¹âà÷¼ÃÛÍÉèÑ¤Â¿™÷Ï½õÕÅ¤À¿…­ÔæØù˜“Üù‹™¾ççˆÑº¬•ùÆ;}$Í›['zh']='zh-CN';$Í›['zh-tw']='zh-TW';¡;®ó;Š­ß•éÙ®ü¶¨‰Ğæñ¸ïÄòÙíãæ¸èêÚ´”;$¾ÂÌ=array();‘×Ğ½¥’Ğ¿·§¹ÉàŒŠ÷ƒÄ¼«‹Ô±ºÈ¿˜·øùÉÑË‡öİØ·•;†µ°¯¿—±º‡ö®¤Ñœ‰¸Ôò¤°§¸ìæúº†ÓñşÙ¨°Šç±¡šì©‘›Îâ·×;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$Ë='en';}else{$Ë=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$Ë,$½òø,PREG_SET_ORDER);foreach($½òø as $Ùô){$¾ÂÌ[$Ùô[0x001]]=(isset($Ùô[0x00003])?$Ùô[0x00003]:0x001);Øß£­éÂÏ„¯ù–ÊÈøƒ¡–‘ìÖÎàĞúºÆà›ºú²¼Œà¦Î±ªı¬ÀÉ;}arsort($¾ÂÌ);—ĞŞ„¨®äù© À‹»ĞÆ·„ƒÃå©’—Ô‘Ã–Û¹Ñ©Ğ;£½àìüø;foreach($¾ÂÌ as $Ò´äí=>$Õ){if(isset($Í›[$Ò´äí])){$°éª=$Í›[$Ò´äí];break;}$Ò´äí=preg_replace('~-.*~','',$Ò´äí);if(!isset($¾ÂÌ[$Ò´äí])&& isset($Í›[$Ò´äí])){$°éª=$Í›[$Ò´äí];break;}}return $°éª;ÆáÛ‡ì—×³ÎÛ·“Âá¦Ù¶·Í”ØŸ¾;õÀÏø³Ğ±„œËàñİÁŒ­Ì³Ğ‹”½ˆâ€‚ÑÉÂÈ;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$€=$_COOKIE['kod_user_language'];}else{$€=get_default_lang();setcookie('kod_user_language',$€,time()+0x0e10*0x0000018*0x064);}$€=str_replace(array('/','\\','..','.'),'',$€);if(isset($GLOBALS['config']['settings']['language'])){$€=$GLOBALS['config']['settings']['language'];}if($€=='zh_CN')$€='zh-CN';if($€=='zh_TW')$€='zh-TW';$Õâ—=LANGUAGE_PATH.$€.'/main.php';¶…ı“¼’Õ¸°ÕïÏ£…¨ÂÃÒ†ŒÓ•;if(!file_exists($Õâ—)){$€='en';$Õâ—=LANGUAGE_PATH.$€.'/main.php';}define('LANGUAGE_TYPE',$€);$GLOBALS['L']=include($Õâ—);ÉÀÕ€ÅÔ”ƒæé¡Ÿš÷é›•“ŞÙåäåºúòÉ;}function make_path($Æ²){$œÆìƒ±=array('/','\\',':','*','?','"','<','>','|');Ú€İÑç šò²ö—œ;return str_replace($œÆìƒ±,"_",$Æ²);¶£ÉÉ‚£°;}function init_setting(){$µËà¦ı=USER_SYSTEM.'system_setting.php';óÖı‰¤›¨ş;Š÷İ©í±õôå­˜¯÷›Ó©„İ•çÚÊ´¼ñ²Áßâ²êÛø†ıªû;if(!file_exists($µËà¦ı)){$‘ªÀ¢=$GLOBALS['config']['setting_system_default'];$‘ªÀ¢['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($µËà¦ı,$‘ªÀ¢);}else{$‘ªÀ¢=fileCache::load($µËà¦ı);}if(!is_array($‘ªÀ¢)){$‘ªÀ¢=$GLOBALS['config']['setting_system_default'];}if(!is_array($‘ªÀ¢['menu'])){$‘ªÀ¢['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($‘ªÀ¢['first_in']);$GLOBALS['app']->setDefaultAction('index');ˆ£€»›—ØÈÈúøô•‰Ş´¨Ò‹¦Û°Á…¯İÌËüŒÔ¡‘½¤é‡íä€âù;$GLOBALS['config']['setting_system']=$‘ªÀ¢;á–Í¬ÊŠŸüÌşàşê¼ãÂ¿„ é‘áºõØèèºş·çÊÂ‡;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];if(isset($æ Ö©¯['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$é³‡ÔÅ=BASIC_PATH.'config/setting_user.php';if(file_exists($é³‡ÔÅ)){include($é³‡ÔÅ);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();âÃ« è–¨×ú¨»;é‚Ş´ÄæüÓí¦ãà„¸·´Ÿ¡ç§õ®‘Ø¯ñ”™¼Šƒ¾é¸„ĞµØ¿Ü¼ éÁÙ¢õùÄŞ¢»´”¼¦;@session_name('KOD_SESSION_SSO');¥æ“àÁ…Íİûé×¿”Ë¹äå†øû®Ğ÷ÖŒí‹‹”ñõ³£Ã’ ®éßÂ‰á;Ù£œ“§íÉ­¦¾Î‘€¨³õ£÷ÔÅ³áùÇŸ¡ïõ…£Ğ©;@session_start();®­ÒÛÓ‘ªä’Ó™ˆö‘İ¼ÄÀ¶ßØüÕİ¡¦ˆá‹Ù‘¸­ì¿˜òÑëŒÚã¹ âù×ïÚ;@session_destroy();©Í˜¥ûèÓõß¡Ñ ;Ø—ñãñ;setcookie(SESSION_ID,'',time()-0x0e10,'/');setcookie('kod_name','',time()-0x0e10);setcookie('kod_token','',time()-0x0e10);ã‹ƒÄÎ§İÏîüù½• ;Š²õªÙÈÇú¬ÂÒœ„ŠÏ“š¨«ŒŒ©¾ÔŸ;header('location:./index.php?user/login');exit;à;õËîöíÁ˜;×”ë«°‰¯»ÙÃÖ‚îâò¸Ëôê½ƒŸ;}function hash_encode($Ì¼•‰){return str_replace(base64_encode($Ì¼•‰),array('+','/','='),array('_a','_b','_c'));ñ®œÂ™¼;ÈÃ§Õ¶à¢¬î­ïË±é;}function hash_decode($Ê³){return base64_decode(str_replace($Ê³,array('_a','_b','_c'),array('+','/','=')));¢;}