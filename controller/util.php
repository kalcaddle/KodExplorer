<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($õÅ){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $õÅ;}$õÅ=str_replace('\\','/',trim($õÅ));if(strstr($õÅ,'../')){$õÅ=preg_replace('/\.+\/+/','/',$õÅ);}$õÅ=preg_replace('/\/+/','/',$õÅ);return $õÅ;ş²ï’Şª¤ËßÙšÛ¸ÍÔºğ³û‘ªÁäİÁä²öîÜœï¨ûÊÃŠ¦ü;}function _DIR($á²Æ–){$ØÀ=_DIR_CLEAR($á²Æ–);²¢¯äšÁ¶ê³Ú¯;ÌË¡ˆ²ÔÙª¬ÓŠÌÅÉ—ŞÚÌŒ¸“ˆ;$ØÀ=iconv_system($ØÀ);$—¹=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);áÀÖ;$GLOBALS['path_type']='';¹ßíØ“ˆ÷ª§ºá·¦•’ÕÓ•ƒêÎ‚ùŞä»¶Ü«å—ŒÔ;² ûŞô‡¬»ÑÃš¬Åæ¹şú×‰ßÊéĞœ¥ºƒÔŒµôˆ•éÁ;ù—¡ÒñÙø‡ìÎÚ‚ÒÆĞÕÀ°ºûæ˜§Í°;$GLOBALS['path_pre']=HOME;$GLOBALS['path_id']='';Ë¨ÈË£ é;unset($GLOBALS['path_id_user_share']);ê™½½;foreach($—¹ as $—){if(substr($ØÀ,0,strlen($—))==$—){$GLOBALS['path_type']=$—;$“„‡=explode('/',$ØÀ);$‡Ùµ×¯=$“„‡[0];unset($“„‡[0]);$‰êñïƒ=implode('/',$“„‡);$¾³=explode(':',$‡Ùµ×¯);if(count($¾³)>0x001){$GLOBALS['path_id']=trim($¾³[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$ØÀ=iconv_system(HOME).$ØÀ;¡éğƒ®ÊÆƒ£ÊŠ’ÑãÇª”¾´ş±¥‚ËãµšÅ‹¼°ûÉ´«•Ãñ˜æ½¢ù†Â»›‚ïš;break;Óü¤ ¥ìëÉ;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');áßËÂíŒøˆƒ¥;$GLOBALS['path_id']='';ÀŞ×ğÛ¢¥‡·éùÏÑ¸ò;return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$ØÀ);…”‘õ¯ÅŒËÅ‡ŸáÇı¹¹ÙÜŞá”ÉÛä›”×çİÑöãæ‰Ù–Îåâ•ì‚öµ€±îÚÎ¼¢˜™ˆ´®ßœ;case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');$GLOBALS['path_id']='';ô°õ™Ğ›†½å”•Ü£¢ë…‚¸ÈïÅÂøÈç¥×¤…µœúå’”·®›õ”¯‹ñÓ®ŞÙ°—¢¡İå›§ÍÁ€ñÇµÂ›¢ÖÒÑòÈæ;return KOD_USER_FAV;Ë¯ì±’ƒŸ;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');ƒ¸Ñ´ÏôÖ®ÚòÕ¨´Õ›û‹«¾¦Í–ù ŠÃ‡­™à¥œ™öÑéë©˜ÆœíïÑÄŒÍÏ·ö†¤ñ¦®¶®ÛÏ‚ì©ø¾”äè;«Äğº”®İ¬ÇåàöÅ;$GLOBALS['path_id']='';“õ‘±ÁÀŸóÓ¢”éœ;return KOD_GROUP_ROOT_SELF;¯ñƒÃ à;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');ÒàĞä…äÚ—–Ø¶‘¬Ø¥–õ—¿À‰Ã„ª¥ô“ìÇóù™Ù€ıµ—•ÒğËä¥‹;$GLOBALS['path_id']='';return KOD_GROUP_ROOT_ALL;case KOD_GROUP_PATH:$ÌÛ=system_group::get_info($GLOBALS['path_id']);à€ÅÖ”²Ÿ‰­¸ã®·™ÅÍì·;çØ™‡Ï½ãŸÍåŒ÷ßË;if(!$GLOBALS['path_id']|| !$ÌÛ)return !0x001;owner_group_check($GLOBALS['path_id']);İ‹Üù×¸Ö®Ø¸¯ÃÑ¯Íşè±­ Ëóî¸«‰‹ÉéŒ§ãã;$GLOBALS['path_pre']=group_home_path($ÌÛ);¹óÂØƒ†ª²;ñ»Ô“´¸¹ä™ìŒÅ¦ÍõÎ²–;†×¼ÑÌ¬‹÷µ;$ØÀ=iconv_system($GLOBALS['path_pre']).$‰êñïƒ;break;†;case KOD_GROUP_SHARE:$ÌÛ=system_group::get_info($GLOBALS['path_id']);if(!$GLOBALS['path_id']|| !$ÌÛ)return !0x001;owner_group_check($GLOBALS['path_id']); ıÃ”Àœ˜;¾¥Û±à°Àóåø­Ë“›Ø”áş¥°õôâ’;œòæ¢Ê¤ô—Ğ€‡—Šˆ˜°ıû¹ùü²ºšÊ‚â–ŸÕıÁ¡;$GLOBALS['path_pre']=group_home_path($ÌÛ).'share/';ö¡ÊµÆ§æ¨Ø§¿¡Ë‹;$ØÀ=iconv_system($GLOBALS['path_pre']).$‰êñïƒ;break;ûÏÓ„èäµæàî…Ûì¸–ˆ„™ê›¸À™úá¼²›±;ÉãïúÚäŞç÷Û™¡Òºë‰‚”ğ«ì˜È­º•¹îü¹Çƒ©Âİ¡Æ‡ıß¨Ñš•Ú;»¹³¥ŸèŒ×’ÜÅÊòÍÏ¸êÆù„ÁÜÁôøóàŞ;case KOD_USER_SHARE:$ÌÛ=system_member::get_info($GLOBALS['path_id']);if(!$GLOBALS['path_id']|| !$ÌÛ)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$á²Æ–;if($‰êñïƒ==''){return $ØÀ;}else{$Õ=explode('/',$‰êñïƒ);$Õ[0]=iconv_app($Õ[0]);$¸¿Î=system_member::user_share_get($GLOBALS['path_id'],$Õ[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$Õ[0].'/';unset($Õ[0]);if(!$¸¿Î)return !0x001;$˜á–=rtrim($¸¿Î['path'],'/').'/'.iconv_app(implode('/',$Õ));¬û˜ä;if($ÌÛ['role']!='1'){$Şßë¡¼=user_home_path($ÌÛ);$GLOBALS['path_pre']=$Şßë¡¼.rtrim($¸¿Î['path'],'/').'/';$ØÀ=$Şßë¡¼.$˜á–;}else{$GLOBALS['path_pre']=$¸¿Î['path'];$ØÀ=$˜á–;}if($¸¿Î['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$ØÀ=iconv_system($ØÀ);}break;¯ıÑÄˆĞ¥°¢ÀÆüİïÉ§ˆ®¹ÍÎàÌŞ†é§òŠ;default:break;}if($ØÀ!='/'){$ØÀ=rtrim($ØÀ,'/');if(is_dir($ØÀ))$ØÀ=$ØÀ.'/';}return $ØÀ;}function _DIR_OUT($œØ){if(is_array($œØ)){foreach($œØ['filelist'] as $Ü¨¢ôŠ=>&$Ò·Ã){$Ò·Ã['path']=pre_clear($Ò·Ã['path']);}foreach($œØ['folderlist'] as $Ü¨¢ôŠ=>&$Ò·Ã){$Ò·Ã['path']=pre_clear(rtrim($Ò·Ã['path'],'/').'/');}}else{$œØ=pre_clear($œØ);}return $œØ;}function pre_clear($»Å){$İ=$GLOBALS['path_type'];éş‘°óæš¨ƒ‚»‘´ö§•ê‹ÅÁ¼ÔØ‹í€Üà°ÉË¯Úû£Â—;$¹ÚìÏ¡=rtrim($GLOBALS['path_pre'],'/');ş;æ›…Š‘ÃãÇˆãûäÈ˜¡¡ş’ÙóËµá›×åš—Â‚³ÈŒÄØÏ¨¡×;$=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);¢Œ¹¢è›;åÙİ÷³ÑÃé´ßÁšùØÜûŒ¦ˆĞşØù¡°ˆ¿íŞöÌÄĞ«½…ı;if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$)){return $»Å;}if(ST=='share'){return str_replace($¹ÚìÏ¡,'',$»Å);}if($GLOBALS['path_id']!=''){$İ.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$İ=$GLOBALS['path_id_user_share'];}$î=$İ.str_replace($¹ÚìÏ¡,'',$»Å);$î=str_replace('//','/',$î);úò˜–ûğåûğÊèûõ–Åõáè‚›‹ë·İ;ÛŠªØ—ĞáèĞºâñêë±ÙÊ©§úÒÍĞÏï„;return $î;}function owner_group_check($çÂËÉ«){if(!$çÂËÉ«)show_json($GLOBALS['L']['group_not_exist'].$çÂËÉ«,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$„=system_member::user_auth_group($çÂËÉ«);if($„!='write'){owner_check();if($„==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$ÁÊÆëñ=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$ÁÊÆëñ))return;if(in_array(ACT,$ÁÊÆëñ[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($–õØš¨){if(get_path_this($–õØš¨)=='.DS_Store')return '';if(!function_exists('iconv')){return $–õØš¨;}$ê·¦æ =$GLOBALS['config']['system_charset'];$³ê–Ğî='utf-8';ğÊúòÉöİí˜Øâ•ÀÚµÍõÂ€©ä«¼¦ó°˜¿¬‹‰£™ç’±ÀôÇß¶Õºì¤Èùš‹úÄï;¢ªèœÀõáæŞøÜ·“†±ş¾Øæß;$šÊÙ=get_default_lang();Ì;if(client_is_windows()&&($šÊÙ=='zh-CN' || $šÊÙ=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$³ê–Ğî="gbk";}$¢î=@iconv($ê·¦æ ,$³ê–Ğî,$–õØš¨);if(!$¢î){$¢î=$–õØš¨;}return $¢î;}function unzip_pre_name($ÌóÄ³){if(!function_exists('iconv')){return $ÌóÄ³;}if(isset($GLOBALS['unzip_file_charset_get'])){$¾‘ŠÑ=$GLOBALS['unzip_file_charset_get'];}else{$¾‘ŠÑ=get_charset($ÌóÄ³);}$¼=$GLOBALS['config']['system_charset'];$Ö–¸¶=@iconv($¾‘ŠÑ,$¼,$ÌóÄ³);³¿;ˆåÜ·Áºó§¼ÈôĞĞ„ÚŸóœÄÊ;if(!$Ö–¸¶){$Ö–¸¶=$ÌóÄ³;}return $Ö–¸¶;}function unzip_charset_get($ûáù){if(count($ûáù)==0)return 'utf-8';$®=array();Â„óÍÖŒŠ¨ã¡á›úµ®ôÙâ‚±¸ıÎ›øÎÊè•­«™¡øğ­„™‘¥ú¬ ±Ê;¶´œ€ªíĞ¯Èğ£åµÂ±;²©Õë¨¥‡¡ôÑŠ;for($€=0;$€<count($ûáù);$€++){$¤¡¯=get_charset($ûáù[$€]['filename']);¸üï²¹ğÜ§Âğ³±Öèó‰®Ê¯å²î¹”Ó”ƒ’Ì¯½³é®‘‘ğƒ¤;àØ«ùÜØÊ„ıı­ÔéÕùñ÷;if(!isset($®[$¤¡¯])){$®[$¤¡¯]=0x001;}else{$®[$¤¡¯]+= 0x001;}}arsort($®);úÄ;Äã¼”¢Ã„Ü;$æè=array_keys($®);óĞİ°âï¢òÇÑÎÕ;$GLOBALS['unzip_file_charset_get']=$æè[0];}function get_charset(&$ğî){if($ğî==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$»=strtolower(@mb_detect_encoding($ğî,$GLOBALS['config']['check_charset']));if(substr($ğî,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($ğî,0,0x0002)==chr(0xFE).chr(0xFF)){$»='Unicode';}else if(substr($ğî,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$»='utf-8';}else if($»=='cp936'){$»='gbk';}if($»=='iso-8859-1')$»='Unicode';if($»=='ascii')$»='utf-8';return $»;¡Ó¤÷Î—ï¾Ûòº¡¬Úˆ•¾²öÖ©‰üšøıÖìü‘Ğµˆ Í÷ßªëšË™ôÔ;€ˆ‡û‰îÚºÑÊÜÒ¾¤¥ú½ÀäˆÅĞÓÙ¸Ÿâ¸;}function check_ext_unzip($üê‹‡,$¦æüí){return checkExt($¦æüí['stored_filename']);¶Ä†Ö“ş·½êÑŠ„ÇŞ³Íò–ËŞ;}function checkExt($ÈÔ¯,$Ã•Ô=false){if(strstr($ÈÔ¯,'<')|| strstr($ÈÔ¯,'>')|| $ÈÔ¯==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$£­Ç=$GLOBALS['auth']['ext_not_allow'];­õ·õÕêÄÉ‚¨£äğë¹¡²ı¶‡¿ƒ¢ˆ¦ĞÏ‚¼ƒ°²º¦;¢ñ€Çå;$êÑ=explode('|',$£­Ç);foreach($êÑ as $úËàë¸){if($úËàë¸!=='' && stristr($ÈÔ¯,'.'.$úËàë¸)){return 0;}}return 0x001;ü¥”¸Ù÷¹Ş¯”ƒ ŠÉ²üÉùâÃøì×›³÷ìŒ±ê²;}function file_upload_size(){global$config;âîæ²ñ£µ£ÖğÊ;if(isset($GLOBALS['config']['settings']['update_chunk_size'])){return $GLOBALS['config']['settings']['update_chunk_size'];}$—µ±¿=get_post_max();return $—µ±¿;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$Å°=$GLOBALS['in']['user'];}else{$Å°=$_SESSION['kod_user']['user_id'];}system_member::space_check($Å°);}}function space_size_use_change($ë¥¤,$¼‡¤=true,$È=false,$ş=false){if(!system_space())return;if($È===!0x001){$È=$GLOBALS['path_type'];$ş=$GLOBALS['path_id'];}$¼‡¤=$¼‡¤?0x001:-0x001;if(is_file($ë¥¤)){$ŞÅƒ÷‹=get_filesize($ë¥¤);}else if(is_dir($ë¥¤)){$Ÿ¼ş=_path_info_more($ë¥¤);$ŞÅƒ÷‹=$Ÿ¼ş['size'];}else{return;}if($È==KOD_GROUP_SHARE|| $È==KOD_GROUP_PATH){system_group::space_change($ş,$ŞÅƒ÷‹*$¼‡¤);}else{if(ST=='share'){$â=$GLOBALS['in']['user'];}else{$â=$_SESSION['kod_user']['user_id'];}system_member::space_change($â,$ŞÅƒ÷‹*$¼‡¤);}}function space_size_use_reset(){if(!system_space())return;$¬å=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';×¸­º¾¬´ùİìé¼³ìµ¾¢Õû¡âŞÅ¤şñ‹ÄÙ‰Ñ²Â€ì¬¡û‹åÈÂÓş‚õÔı—·İİÜÜĞè¢ªñôÜ´ôÊ¶¢ë²­û™ö¿ìõÁâÊ¿;$ƒÙàú=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';¿“İ­ƒõ»›“Œ€Ÿ²¨‰»Ç¼Ù¤Û™ıÆåÂï®Øî•·œ¢»’ŞÖ¥êÖÅ;¼“²ğˆü¨ªéÚØåóÏ¦áÅçÅ‘¨;if($¬å==KOD_GROUP_SHARE|| $¬å==KOD_GROUP_PATH){system_group::space_change($ƒÙàú);}else{$•Æ›=$_SESSION['kod_user']['user_id'];system_member::space_change($•Æ›);}}function check_list_dir(){$šüóÌ=APPHOST.'lib/core/';—¨´òšçĞÀÉ—©©ÒĞ¾™ëµÛ±ö½Ìó±šã¯äú×™îØ´Öªõ Á ¯êòªŒìßèŸÖ¦ëËØ;$ë="Application.class.php";²íèí€ÈÅ¦´ëÒ»­åÇáÓ°¯¿áâî‚ÆŸü˜å¯†Ï‡˜ã;¹»ğ;$²‘¦Ò=@file_get_contents($šüóÌ);Â¼Ò°œ»Ïóâ¼À»Ã;if(stripos($²‘¦Ò,$ë)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$··=$GLOBALS['L'];Â¥»è÷üú¾À·’ğÔÎÁÉ±ıŠíÂû²ò™×ªĞ¶;š°Ã‰³Š©°¢à¨Şş¯÷ãİÄå÷ä…Í³‹ëâä»Âşë†‰ ²Ñ³Â³Û¡²Œš—éß;µâ¼³İûô–æêÜ¨´§¿ûé»¯İÔ‡‰¥¾§ ¸ëÖ›¨Šù¤ş²æú°·ï›¡¬Ê;$='';‘±ÇÊ;if(!function_exists('iconv'))$.= '<li>'.$··['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$.= '<li>'.$··['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$.= '<li>'.$··['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$.='<li>'.$··['php_env_error_file'].'</li>';if(!check_list_dir())$.='<li>'.$··['php_env_error_list_dir'].'</li>';$æÅ=get_path_father(BASIC_PATH);Ä¦ıå·°·êòêÇ•Ó°¶¾³¡Õ·ÑÏÆî¬»ÇÌ;ñ‘ì® Ì×èù»³ù¼‡„ã™µ¬ãÒËÊ™õ¬;$ =array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');foreach($  as $±Œ){if(!path_writeable($±Œ)){$.= '<li>'.str_replace($æÅ,'',$±Œ).'/	'.$··['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$.= '<li>'.$··['php_env_error_gd'].'</li>';}return $;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();šëòª ”×æĞÖüÚÉ‹«½º;if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$ˆ¥ô=LIB_DIR.'update.php';if(file_exists($ˆ¥ô)){include($ˆ¥ô);update_check($ˆ¥ô);}$ ²Ä=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($ ²Ä);}}if(!is_writable(KOD_SESSION)|| !is_writable(DATA_PATH)){show_tips($ ²Ä);}}function init_config(){init_setting();;init_lang();init_user_setting();Ì¨ÙïÚåÂ;}function need_check_code(){$ËêşÀ=$GLOBALS['config']['setting_system'];if(!$ËêşÀ['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$Ï="en";•çÖá‘±Òë—•š¨÷ôóãôµ;$•=$GLOBALS['config']['setting_all']['language'];Ã „Ø“†à²©ıÑ¤ƒÂ¾İ±´ØêµıáñÂÃÊÏ§’¾ë²ÂÄÆÉ¦øó¤Ê™§Ø†ÀŞ«Ã;Ãú†ÑÉæíŞÎÅÁàö•Í«ç·¤Ü¬ˆÑâ”çÂÃĞ;$É¢ˆ=array();foreach($• as $ç=>$Ö){$É¢ˆ[$ç]=$ç;}$É¢ˆ['zh']='zh-CN';®İë—–ôÂ˜Ç¦­°´ºò÷Œ±Á¯ºòÀ¢ó˜ÌÕæ…Åø;Ÿà£¥¡±…ÌôâÚ¬„­®ô§Â¤‰˜¹–Õ‹‡ƒîÒ¢ĞöÈñ¨Í¾;$É¢ˆ['zh-tw']='zh-TW';¢Ú;$Ğ‹ù=array();î¼ÏıÅç·Û½ÃùÅÆé˜éº²¬¸€ëÖ²†¢çÎœ“¾Ø;±´Æë¨ˆœ ÛñˆèöÍâ”©;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$¦È‚='en';}else{$¦È‚=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$¦È‚,$ˆìŒ,PREG_SET_ORDER);foreach($ˆìŒ as $…½°Ìª){$Ğ‹ù[$…½°Ìª[0x001]]=(isset($…½°Ìª[0x00003])?$…½°Ìª[0x00003]:0x001);ôõ•çşşŞÍáòöÏšÀßœÏÁª×®·Ó³õ„€ İÕÙÓ;}arsort($Ğ‹ù);Ëíš™Ğ ©ÑÆ¡Âğùñ©Í¥ŸÒ¦¿°ü™„É‰À•÷Ú®Éé¿é”‘ë;³‰Î¹¬·ˆÉÊÆ¢;Ì¬ öúÆ–ÍíÖşêğ„´ùÄ;foreach($Ğ‹ù as $ç=>$òŸø){if(isset($É¢ˆ[$ç])){$Ï=$É¢ˆ[$ç];break;}$ç=preg_replace('~-.*~','',$ç);if(!isset($Ğ‹ù[$ç])&& isset($É¢ˆ[$ç])){$Ï=$É¢ˆ[$ç];break;}}return $Ï;„°³Ô¯“¾™­·µôéÑ¨ó¡â Øëé£³Ñ·ÏË¯ĞßÁ¦Ôäªƒß÷‡²¡;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$“ùü=$_COOKIE['kod_user_language'];}else{$“ùü=get_default_lang();setcookie('kod_user_language',$“ùü,time()+0x0e10*0x0000018*0x064);}$“ùü=str_replace(array('/','\\','..','.'),'',$“ùü);if(isset($GLOBALS['config']['settings']['language'])){$“ùü=$GLOBALS['config']['settings']['language'];}if($“ùü=='zh_CN')$“ùü='zh-CN';if($“ùü=='zh_TW')$“ùü='zh-TW';$Ç©â=LANGUAGE_PATH.$“ùü.'/main.php';ó¿ìµæı‹Ë¨;if(!file_exists($Ç©â)){$“ùü='en';$Ç©â=LANGUAGE_PATH.$“ùü.'/main.php';}define('LANGUAGE_TYPE',$“ùü);$GLOBALS['L']=include($Ç©â);}function make_path($„ö¹˜){$„‹Û=array('/','\\',':','*','?','"','<','>','|');µï†€ƒüÅÈ¦©ˆËÔŞ¿í‹²ñ©©¬Áå°ÍÁ®–¨ä†®äŠ¯áĞø‰ù‚ÔÎà•¼ì;return str_replace($„‹Û,"_",$„ö¹˜);òÜ×Ø¥›¼;}function init_setting(){$ñ‡Í=USER_SYSTEM.'system_setting.php';if(!file_exists($ñ‡Í)){$œñ™=$GLOBALS['config']['setting_system_default'];$œñ™['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($ñ‡Í,$œñ™);}else{$œñ™=fileCache::load($ñ‡Í);}if(!is_array($œñ™)){$œñ™=$GLOBALS['config']['setting_system_default'];}if(!is_array($œñ™['menu'])){$œñ™['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($œñ™['first_in']);$GLOBALS['app']->setDefaultAction('index');İ;$GLOBALS['config']['setting_system']=$œñ™;ÑúÍÙì‰ƒÚ™±äÕ;ƒ™³ÛòÁ‚ş¿Ñ¡‚Ä¨Ğç’î„„ˆ¢Ìğ¢;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];óìã³¿†µ„¯†ìÁõğÆş”“ğ·½‰Ç÷ÛùšÍØşÁÅãô…é«Š™²öÛ¨ç¢§üµ™´ó¢üƒšÙü´§Ö;$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];if(isset($œ˜İ¢ƒ['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$¬=BASIC_PATH.'config/setting_user.php';if(file_exists($¬)){include($¬);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();­çä€ã³ÙĞ½Ü«Ö‘¬ß‰ö;ÇÉ¼Êã–È™½ŸÎ¦¼ç…ŞëŒ;@session_name('KOD_SESSION_SSO');@session_start();²¾;@session_destroy();setcookie(SESSION_ID,'',time()-0x0e10,'/');çˆ»±Ä†–ÚÏ°˜îş¿«æÅŠÓÔ—İ¢ÇáÔ†‚•ÏöüØ³®¹ÄøŠô’øôÑ¥Ü˜¯°íÆïä;‹âõ¸¾£ ¤£„×üÕ;setcookie('kod_name','',time()-0x0e10);êö¾¥ÜØêÕâàçÛÖº³Ò±äÀøóĞ‰ã¶Ÿ×°†Â§ÅàÍ£º¹ø›áùñû¦ğ®‹²¨ş„±ãºÑ¼ëØş“ŸàáÂ›œ¼¹·Ÿ´ª¼;setcookie('kod_token','',time()-0x0e10);è’™Èœ¨ÀÆÊğ;ÜàˆÜå¹Á¡Œıåı¡…ŞƒÇúŸ…µ×¤é‚ášÓù°ñ;header('location:./index.php?user/login');exit;}function hash_encode($Í‡¯){return str_replace(base64_encode($Í‡¯),array('+','/','='),array('_a','_b','_c'));«¬ü§Ë‚Ü¤¦Æ¦‰áù™Ü«;}function hash_decode($ä‰){return base64_decode(str_replace($ä‰,array('_a','_b','_c'),array('+','/','=')));å—£ÌÎ»ÉöˆÌÓ¬ó›ÓüüÍ—Úù£º³ˆ×¼ç¿”ÎÖ¸İ£ˆšíş¢ºÒÏ®í£«ëñÂÇëæ‚Ÿî;Â¶å¬Éşõå¨¶­ò§Î²û‘Ú ÊÂç¥ÎÒ„²»¹¬şï’«¹’¢ ºØÎ­;šñ¦ğª…•²Ÿƒ±Â½…’ìó¶™ß©Ü¨–Ãª¶³†“‹ †²’°·§âÖ«•™èš¬ÖãïîÌ;}