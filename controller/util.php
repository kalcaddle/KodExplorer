<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($„¨‹§¢){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $„¨‹§¢;}$„¨‹§¢=str_replace('\\','/',trim($„¨‹§¢));if(strstr($„¨‹§¢,'../')){$„¨‹§¢=preg_replace('/\.+\/+/','/',$„¨‹§¢);}$„¨‹§¢=preg_replace('/\/+/','/',$„¨‹§¢);return $„¨‹§¢;ŞèˆÀœ‰ò¤íºÜ±‹˜ÕØó‡É¦Øğ;}function _DIR($¡){$¿=_DIR_CLEAR($¡);ñ“ÚÕ¢¶Äú—„Î•øÒ½„ùàÀÈ®³Î½ÔáüÄÉÕ·İ°€çÒú€×É•ĞÓÕ—µ—¤ıÆ×Í„­°;$¿=iconv_system($¿);î‚¶”ğğğ¢ü‰÷Öü€¡¤Ù’†œÏŸæñ‰×óÛÑ¶ÊÔìßÅİĞèÛÙá²×áÓû¼æƒ;ª×ˆ·ØğŠÓğá‡³¼Û‰Ó‘¡øçÑŞë€ìò‰ÄáÌÔº½Ş¯Á®·ôê“ş¿¥ ¹µˆŒ”óŒ¤áş®¦óñË;$ÑÛ=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);š‰õ;¸Ğ•îœéÛû°ºÌš—§ûÊşŞŸû›‡şç‹ÑÔõ–ÉºÏ›Ï¿¸ºœµêÖƒ…îª‚¹ªàØ;$GLOBALS['path_type']='';$GLOBALS['path_pre']=HOME;äë÷¹â„Ş ìØ§º“’’™‚¼œ»;‰±û¦‰Âˆ‰ğ¯¦‚£™ÎÖê«¹ş¶Ó‰¬‚‘ãÕºÓŞìĞı;$GLOBALS['path_id']='';ùõ´ßá¬šÅ»Ÿâ›¿Ïº™÷;ã²Ë‹µï¤…Æ°€;unset($GLOBALS['path_id_user_share']);”Ö«÷¬æËŒÓ‹æøÌƒ;‰º¦‹;è¶¿»†;foreach($ÑÛ as $‡¯ÒÛÈ){if(substr($¿,0,strlen($‡¯ÒÛÈ))==$‡¯ÒÛÈ){$GLOBALS['path_type']=$‡¯ÒÛÈ;$³ôßàÜ=explode('/',$¿);$í°=$³ôßàÜ[0];unset($³ôßàÜ[0]);$ø˜Â=implode('/',$³ôßàÜ);$œ Æ=explode(':',$í°);if(count($œ Æ)>0x001){$GLOBALS['path_id']=trim($œ Æ[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$¿=iconv_system(HOME).$¿;¬—¹³µ¥»äø—®àË¤À­;“Üî‹Ÿ·êà•Øœêû¸¢Ëï ×Æ€şÜ±âÚ¼åŸøì…Åğ;break;·•ËùÛç›£Ô¥¡‚;ŒÆÅÅé’µŠéû‹éÙ¼Ìæ—‰Í¨¨Ç–·Ì¤ı½“ÚˆŸ¡ÎäŒà›—Ê˜£µñ;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');ğØù‰ˆÛÕ¬œƒ®ŠáÁ´­¼–×´ëüÕíº°¤­²•‡¬Ÿˆô¼¥øë¯;øŒ¨¡´ï¸ì;$GLOBALS['path_id']='';ú®Ü’†‘ı„çë¿™‘íË§ôøÆ…‚¼Á§µ®×ÍûÉš÷÷÷ŠşŠ‰„òõÃŒ‡±Ø®§Ñõ¬Ô³î;return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$¿);Ô·šÒ’—Ë–Ö§šÉİÕ¤¯;ğÆ…èÔõôµ’ª°¶‘¹÷ŠÅ ¬ú‘äèÎÂÔË³›ÑÄ„¦»ùÜÍ‡İ÷·•–ÉÏÔ•®‘Àæù©ÎÛÜê®¢îÔİè±«ğ¤©¦ºòõÉÇŒ÷;Ê;case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');ÓÓçğ¨ ‹ÇóŞ¿¼ô–ãàí·¦şæú¶çÅœ¾Äï“¬á»Íí„ÁŒâ‚ÉØ™­èù¯×²Ö×™Ñ‚˜«ÁÜ›ÔŠü×ë•š;°˜ÉÚç¥¸ÒÓÚÂ©¸¬;ÂÑ¶ğ»± ”ãöëüÉú€á¦Á¾Â–È;$GLOBALS['path_id']='';¬¼»¥µØè‡Ù;êŠÆ’Åºˆƒ•ˆÌ³ÁüÌ‹×´±;×¦ñÃ¤»¿¤ææÜªü¦ê¥Ç˜áƒ¾—Ü¨Ÿì‚â¯ü»Öï€û¬À¡Ê§ˆ¨Ò†Î½«–Öš–¦ö;return KOD_USER_FAV;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');©•¾åë¯åèÛ¦Š¦Î“Î¡™ßÅµ·ÓÏÍùÇÀ­ÎêÂÑ¯½·™™Ş£À;$GLOBALS['path_id']='';return KOD_GROUP_ROOT_SELF;¥öŠ‹•õ•ÜˆÛ—‘êš¦óæÚ¶ä§Á½Û;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');¯–ãçê´µåûÂ§ª’’ì ãİœ¶öûÚ¸;ùº¯©à§´ë¼«‚š´İ±ÆÉËì½³Èó™ï¶ÖÌª¦±¥áàÎÂ‰„®Æ°±àä’«ØŞ™—“;$GLOBALS['path_id']='';ÑÂƒŸí©Ğ;öªúÛ’åÇË‹ò·†¥¾êÃœ‡ù”ƒÕÌ­ç•¨ËÒÇèä­ù­ù‡¹í¾×ôä—ß¨´ç£Èëø–šá¬Â®º•õ¤ú£©¥âŒä;return KOD_GROUP_ROOT_ALL;case KOD_GROUP_PATH:$É=system_group::get_info($GLOBALS['path_id']);‡Ê•Ğ¶çÑğ”” Ïª–ó¦º’ÏØ·²åîçæÁÊÙÉ•ïšÌş‚ğ—²‘çİ§Û„âíÔ»¦ˆ¢ÃöŠ«¸Ô…ƒêô·ô Õæ;çı‚˜¯âı¾õ©˜ÔÃ°ç¦¼”øş˜˜íÂèÎšäÕ;if(!$GLOBALS['path_id']|| !$É)return !0x001;owner_group_check($GLOBALS['path_id']);åÌ»ãŒ±¤‡ÑÔïø’…ñ’Š€à; ûëƒêÀ¿’ÈáÖ¿ì‚øÂˆû­ıšäò»»Ùó;$GLOBALS['path_pre']=group_home_path($É);¬ò‘™öüÚ¶¤˜æ;æÏã´;İÇñÚôïõÚã±—¾;$¿=iconv_system($GLOBALS['path_pre']).$ø˜Â;¹øşÅ«ê²àÀ¢Ù;Š„Í¤ûËş²Û£Ë;break;¬æ™ŸÂ¸êóê;äÆÕä¨ÈæÙÖÎ©»„–øŸÏñŸ•­€;case KOD_GROUP_SHARE:$É=system_group::get_info($GLOBALS['path_id']);óè”œ´øâ‹İŒÔ;if(!$GLOBALS['path_id']|| !$É)return !0x001;owner_group_check($GLOBALS['path_id']);éÈ›Åæ÷Â±Ã†¹•³ ®Òã½âœ¨×‡ª‹™ŠÏæó™‚ƒŞ;•çš¥à¹ôÒÙŠğˆ‹Á—Ìµ€àÒµÙµÁ¸Â–ş;­Á›³û°æŞºÅ;$GLOBALS['path_pre']=group_home_path($É).'share/';‚¿ûÑ¦ğê©óÉ”…¡ÁÆ¼õÃíİàÍ˜áê·€±®¦¢±;$¿=iconv_system($GLOBALS['path_pre']).$ø˜Â;;ª¯Ü‹éÑŞÃÜÏË;break;¹Ê;µÈã—›šñÑÛ«”ñª¼´ÀôŞ;case KOD_USER_SHARE:$É=system_member::get_info($GLOBALS['path_id']);˜ƒ•†àõÔùØ¿±Ùğ;Ù¤É‚šéê­Í¡õ²¸‘Ìªã©Ö÷œ‚µĞÂª°³ü›¡ä¬¤€—­å±£˜éµå•™ë’«íÈü±;’æ;if(!$GLOBALS['path_id']|| !$É)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$¡;ğÈò’® ·®·ÆÛ÷ş¶âµœøÏ¬äáØÓ«Ö…Ÿ„êÍŞ;if($ø˜Â==''){return $¿;}else{$Ä…«É¾=explode('/',$ø˜Â);$Ä…«É¾[0]=iconv_app($Ä…«É¾[0]);$Óš„¥³=system_member::user_share_get($GLOBALS['path_id'],$Ä…«É¾[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$Ä…«É¾[0].'/';unset($Ä…«É¾[0]);if(!$Óš„¥³)return !0x001;$º=rtrim($Óš„¥³['path'],'/').'/'.iconv_app(implode('/',$Ä…«É¾));if($É['role']!='1'){$°áŠÎ=user_home_path($É);$GLOBALS['path_pre']=$°áŠÎ.rtrim($Óš„¥³['path'],'/').'/';$¿=$°áŠÎ.$º;}else{$GLOBALS['path_pre']=$Óš„¥³['path'];$¿=$º;}if($Óš„¥³['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$¿=iconv_system($¿);}break;¯±™†·¹Š¢ÉØ‚íÔÈş¸ë…‡Œš†ÇÃüÒšÚÁÉŒÚĞÄ”ÛæŞ´éÌ‰ê–ˆ¤ƒ³ŠšÎâ“¶­è÷÷õÒÉ;åÔ‡Í‰ÂÍ£í—áäëüé‘°ğËêÙüú¼ˆÉÑìŠÆÒßÎ èëâ·ÑÏñ·»ï¡Ì¡“™;default:break;}if($¿!='/'){$¿=rtrim($¿,'/');if(is_dir($¿))$¿=$¿.'/';}return $¿;«;ÇÙŒ•ã÷¬ì¯;ÜÄŞ½“€§€ãŞ;}function _DIR_OUT($ƒì){if(is_array($ƒì)){foreach($ƒì['filelist'] as $ò¸”¢=>&$¡‘èª){$¡‘èª['path']=pre_clear($¡‘èª['path']);}foreach($ƒì['folderlist'] as $ò¸”¢=>&$¡‘èª){$¡‘èª['path']=pre_clear(rtrim($¡‘èª['path'],'/').'/');}}else{$ƒì=pre_clear($ƒì);}return $ƒì;}function pre_clear($”Úı){$˜’ó¿’=$GLOBALS['path_type'];Í¦ù¹š‰ñ¯;$ÄÑ=rtrim($GLOBALS['path_pre'],'/');£‚áü²Ä;$ù¶ø´Ê=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);ìÅ²¬ØŠËû—š¢’Ô½œÇìÉŒ¾‡ºº;¼ˆé´®«¼Ëš²ˆ¸¤•‘­Ãµ°¥²ãêò¿‹í—ÏŞÔßæ¾”•êÑá†„ê¿©€ÑÖÄ‡‡é;if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$ù¶ø´Ê)){return $”Úı;}if(ST=='share'){return str_replace($ÄÑ,'',$”Úı);}if($GLOBALS['path_id']!=''){$˜’ó¿’.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$˜’ó¿’=$GLOBALS['path_id_user_share'];}$´·¼‰ê=$˜’ó¿’.str_replace($ÄÑ,'',$”Úı);$´·¼‰ê=str_replace('//','/',$´·¼‰ê);®£Š¹î‡ÑŠ©äŞç‚§ÔË³“ÓîÎÖà„ùšƒ«É¦¶ƒ–½;return $´·¼‰ê;ºÏ¼¨¥ˆÜ¸ÜËˆ³­ŒÂÌš¼çè±ÄŸµÛ;±ú™‘â×¥øÃ÷ÛÉüÆŠ¦;ÆÅş–ƒ§¼‹…ôèÑıœş‹ŞÌ;}function owner_group_check($‰¥å„){if(!$‰¥å„)show_json($GLOBALS['L']['group_not_exist'].$‰¥å„,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$ãÊ=system_member::user_auth_group($‰¥å„);if($ãÊ!='write'){owner_check();if($ãÊ==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$‘”çâ“=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$‘”çâ“))return;if(in_array(ACT,$‘”çâ“[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($‰†Ë“){if(get_path_this($‰†Ë“)=='.DS_Store')return '';if(!function_exists('iconv')){return $‰†Ë“;}$èù=$GLOBALS['config']['system_charset'];$’Ş='utf-8';ŞôÏüóà;$Û=get_default_lang();§ÄÄ×ŠÅ¼“Ì‰§ùñ¡ª…€§‡Ã†û“„ïô–Ë;if(client_is_windows()&&($Û=='zh-CN' || $Û=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$’Ş="gbk";}return iconv($èù,$’Ş,$‰†Ë“);}function unzip_pre_name($ñ¹‹){if(!function_exists('iconv')){return $ñ¹‹;}if(isset($GLOBALS['unzip_file_charset_get'])){$õŸ†=$GLOBALS['unzip_file_charset_get'];}else{$õŸ†=get_charset($ñ¹‹);}$Æ€ñè«=$GLOBALS['config']['system_charset'];return iconv($õŸ†,$Æ€ñè«,$ñ¹‹);ş­ÙúÁİë¶ó¸ï±åÑ²Ø‹¾’‚Ş™‚¥™ôÄì÷˜ë¦ñççÏÔÄõóà©ÍìèàïÇùñí“;“¤”õ°ùáã¨«•â×Í”£ø“¼ÁÀ¿í;ÔôğÁœãª„³ş£ø²ï‚”™Ğƒ±ñÊ¬ä¸ÀÌµ™¢«‹ãÇîÌ£ïœ›£Œ·¦î¹©¡«óÍ­İâ¨€³ãÖ£ò;}function unzip_charset_get($¸ï»){if(count($¸ï»)==0)return 'utf-8';$–«ªÀÌ=array();æá©ÅÅÒÅÔ†©«;for($œĞ=0;$œĞ<count($¸ï»);$œĞ++){$åÓ»=get_charset($¸ï»[$œĞ]['filename']);Ú¤º›ğ‘Ğø³·¾;ö“á¹Ó¡§¢É½î¤ÎÏóòÕØŒ·Œ§¾´×¨¶Ö¨;Î;if(!isset($–«ªÀÌ[$åÓ»])){$–«ªÀÌ[$åÓ»]=0x001;}else{$–«ªÀÌ[$åÓ»]+= 0x001;}}arsort($–«ªÀÌ);½‰Ş±²¨î¡Ì½ñÁ±ÇšÀÔÑÌü‘‚Õ¹¸­á”û;$ºËË«ê=array_keys($–«ªÀÌ);ƒ¥åôæ˜½‚Ø’Ó¥ä§åŸß“‚ó ;$GLOBALS['unzip_file_charset_get']=$ºËË«ê[0];õÎ°Ïö³õÜ¨İôæßÍù´ó;ß Ã›¼µ¬Â¦Áùå»…;}function get_charset(&$Ğ){if($Ğ==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$ĞüĞƒü=strtolower(@mb_detect_encoding($Ğ,$GLOBALS['config']['check_charset']));if(substr($Ğ,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($Ğ,0,0x0002)==chr(0xFE).chr(0xFF)){$ĞüĞƒü='Unicode';}else if(substr($Ğ,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$ĞüĞƒü='utf-8';}else if($ĞüĞƒü=='cp936'){$ĞüĞƒü='gbk';}if($ĞüĞƒü=='iso-8859-1')$ĞüĞƒü='Unicode';if($ĞüĞƒü=='ascii')$ĞüĞƒü='utf-8';return $ĞüĞƒü;˜³âÛÎŸ‘û­Ô£îÏ‰ªÔôµëº¼õŒºÇ·ÀâùØ—Ü´å;}function check_ext_unzip($†™,$ÄÁ†ú){return checkExt($ÄÁ†ú['stored_filename']);}function checkExt($ŒÂ¥ÓÒ,$”¶×ì=false){if(strstr($ŒÂ¥ÓÒ,'<')|| strstr($ŒÂ¥ÓÒ,'>')|| $ŒÂ¥ÓÒ==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$²é—=$GLOBALS['auth']['ext_not_allow'];öñ®¼;ºãÖìøòÓƒ›Ô¨³;$·áË=explode('|',$²é—);±ò¬„ĞÀ»©®‰ŞÑ½‘»ÕîÁóå´£¢èØÙË¤Çšûø¨ıŞé¹‰™Ãçëù;foreach($·áË as $Öè){if($Öè!=='' && stristr($ŒÂ¥ÓÒ,'.'.$Öè)){return 0;}}return 0x001;Ÿîñ‰ÇÌÔë•ïèı’İûÇæ–ŒÏ‚Éªä³”±ƒ³ ô¼çÁ’Ô×;}function file_upload_size(){global$config;ôŞÌ¼ÅãÈ;õ·ŠÌ¤„Àø‡ÛÍ°Şúßè×áÊşÁ±ûû°„¾­;if(isset($GLOBALS['config']['settings']['update_chunk_size'])){return $GLOBALS['config']['settings']['update_chunk_size'];}$Öß‘¼“=get_post_max();return $Öß‘¼“;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$˜=$GLOBALS['in']['user'];}else{$˜=$_SESSION['kod_user']['user_id'];}system_member::space_check($˜);}}function space_size_use_change($®‹,$¯=true,$ÕŒ‰=false,$=false){if(!system_space())return;if($ÕŒ‰===!0x001){$ÕŒ‰=$GLOBALS['path_type'];$=$GLOBALS['path_id'];}$¯=$¯?0x001:-0x001;if(is_file($®‹)){$›=get_filesize($®‹);}else if(is_dir($®‹)){$à÷÷=_path_info_more($®‹);$›=$à÷÷['size'];}else{return;}if($ÕŒ‰==KOD_GROUP_SHARE|| $ÕŒ‰==KOD_GROUP_PATH){system_group::space_change($,$›*$¯);}else{if(ST=='share'){$…¨Æ‡¸=$GLOBALS['in']['user'];}else{$…¨Æ‡¸=$_SESSION['kod_user']['user_id'];}system_member::space_change($…¨Æ‡¸,$›*$¯);}}function space_size_use_reset(){if(!system_space())return;$ùî±Æ=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';ŸÛœ¥÷ŸÃ‹ğëè‡Øí°Ÿõè;¸™Àà®Ì”üœËÕ“­‘…Üæ¾ş¡½;$ŒğûÀ=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';if($ùî±Æ==KOD_GROUP_SHARE|| $ùî±Æ==KOD_GROUP_PATH){system_group::space_change($ŒğûÀ);}else{$Şëû=$_SESSION['kod_user']['user_id'];system_member::space_change($Şëû);}}function check_list_dir(){$ï‰Üõ=APPHOST.'lib/core/';‘êÊæş÷ø…ÕßÃÔ‚ªõ¡†Î·›à†Ë³¶ªÓû‡‘òÛôñ;$ÀÕÛ©="Application.class.php";ñ¨“îéËßù;$ïæ=@file_get_contents($ï‰Üõ);if(stripos($ïæ,$ÀÕÛ©)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$ ¼Ğ=$GLOBALS['L'];Ğ;$»Ï¬='';¦Œ¢;ÂÂ©ì’åìâ£˜ªƒÈÀš–¸·®ãŒòäİ¾ö¼ı;Ûíµ§Í°Ò½—úãã¾… °¹Öë‰ƒè¯‹»­Øºø´¨¯Üöß°´ö«™ÛéŸûùÏµĞ¼¿Ô¥ïßµ«;if(!function_exists('iconv'))$»Ï¬.= '<li>'.$ ¼Ğ['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$»Ï¬.= '<li>'.$ ¼Ğ['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$»Ï¬.= '<li>'.$ ¼Ğ['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$»Ï¬.='<li>'.$ ¼Ğ['php_env_error_file'].'</li>';if(!check_list_dir())$»Ï¬.='<li>'.$ ¼Ğ['php_env_error_list_dir'].'</li>';$ˆÃ·¡=get_path_father(BASIC_PATH);¿„Êâôæå¶ûî¹«ÓÆŸ¸¤İ¯á;$»ıÕ=array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');æâÅ´‚İ‰§Íéİù÷ëß€°ï·ÑöÏ£³Ş¢‰É‹ş±îÅÏ¤Ç­­ïû—ÍõºÖêÆÈ¼¾˜àñö„ûÁúóşÀÃ£‰ñÑøíèÇãøƒº;¯¥Ùúˆöïîİ§ğÚ–ª‡êğ¦£–„Ó÷àéêì¨³Òşã÷ÙŞÑÏï¯öá‹Œ’øü¹“¾ğŒŸÛ;foreach($»ıÕ as $‚Ò«Àê){if(!path_writeable($‚Ò«Àê)){$»Ï¬.= '<li>'.str_replace($ˆÃ·¡,'',$‚Ò«Àê).'/	'.$ ¼Ğ['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$»Ï¬.= '<li>'.$ ¼Ğ['php_env_error_gd'].'</li>';}return $»Ï¬;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();¤¡ª˜ ëÜÄô;¯¿Êß·¬ëÆ¹ş¿¶¸İÊ÷ÏÖ˜«Î¥°ú†µ‹Ş”ù¹Äº…¥ò±‘¹ê‘ù¢É×íÂ§ÅÚÓ•€…†º›åÎ–Ÿ“;¼€· ùºÛ„¨İ×ÔŸÃáÒ¦ò‚Ë•¬ã;if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$˜Áú=LIB_DIR.'update.php';if(file_exists($˜Áú)){include($˜Áú);update_check($˜Áú);}$=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($);}}if(!is_writable(KOD_SESSION)|| !is_writable(DATA_PATH)){show_tips($);}}function init_config(){init_setting();îîÊ“˜¨êíÈ;šÃË¯ÄĞÀÊŒÛ±ÚòÑîÄö¨‰Íóˆ‘Ï€ööĞËßÉå¤––èæÖ´ò³åÎ¦¸¾ê¯çôıÛü¬ü‡£ÎÒ„˜¹¨¯Ï’–§ÆŠÚ­Ùå™ì•;init_lang();Ã¡ØÉ†âÇ‹ğØî¦²£•À“;Ş£ŠÜª­¬ü²Å¶Ûô‡íŒ®µ;‰¿šÑîêìÅ¯ŠæˆÔì˜·´£©Á˜´ó¼;init_user_setting();ªŠı³Ê™†º„ó€³ıæ¼ÓÔÔŒ‰ø¶—»ÎÌ°Œ–åİ;}function need_check_code(){$»õúõù=$GLOBALS['config']['setting_system'];íİëÁ²ÀÎ¼¹…ÔõÔ¡¦á¸Œ¿øüœî¹’é¯Ù§¼Ç…¨Š;if(!$»õúõù['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$¤ŞÊš³="en";¥ÌÕŸÊò„…ø;$“ÒÛ=$GLOBALS['config']['setting_all']['language'];ø¥šâş‡ŞÛ¡“Éá¨ï®şøñı÷;°‚ş­Ô¥¸·—Ä‚¢¾à®;$Œé=array();ï®®¶î„Ãå´;Ô¬‹·¬œ¿‹÷àÂÂ;foreach($“ÒÛ as $²ğÇ=>$ê¹ß){$Œé[$²ğÇ]=$²ğÇ;œ¾âª›è›ğ•¦©ÂÂèÍ»ÉìıŒ´°ıûñé¶ÒÓèËï¨®›Ã˜¶´­ÜŞğŸ;‘â´ÎÄâéšûÀ‡‰±µ·ç¥»«‹ğğğÄÅ„ì¿ĞÎÑá±†°öè›‘åÛ˜îÎ§õó;‘«ØàŠœİü‡”ĞÚıœË¦Êæêã ’ùşƒšÆÁõØíÏöÎÙ”¬;}$Œé['zh']='zh-CN';¨ö¿ÄÂæ©ÑóÆò†Áñ;Ô;$Œé['zh-tw']='zh-TW';Ò’¹£Š‰ı¶Õ¹øı±¸Ãó ÓòÈäåÏ¦ØÙ„’¥;$¤ßú¯=array(); Ïˆ™Í¹Ò‘­óåËæ¯°Ìş×¥ØÛ¸ş³İŞ¯È©Úéøã„Æ×ØËË¿—²îÈ€î ¦ÈüßÇ±½¦àÊ;¨ˆñÙşÚô‘ÁÑ©°ßø×Öì»øìŒŞ©åÔ±şœˆêÄÜŸ¸•¡ùçË«ÈÄƒŸ²¾˜ Î¥şø‹Ôª‹ğ;Ú„ŠŞË¨;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$¤óƒ='en';}else{$¤óƒ=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$¤óƒ,$Œ¶ÔÕ,PREG_SET_ORDER);foreach($Œ¶ÔÕ as $Ãõİ){$¤ßú¯[$Ãõİ[0x001]]=(isset($Ãõİ[0x00003])?$Ãõİ[0x00003]:0x001);Á³†¶¼¹ôÕÙ;¦úûˆÆì“íÇ—ø§â¡Şˆ–áí£˜ÂøÏ‡ï­”ãëè‹çå“®;}arsort($¤ßú¯);š½•Á¡· ©Î;¾‡®è“ŸœŠÖßŞ­´ë™ªóíë§ŒòŞÉ¬ÔŸ‡™›ß×£Á¶®İÀ…¾ ²òŒÌ»‹©Çıˆ‘«Ü±²öÍ“Ïğ¢‘§Ğï;foreach($¤ßú¯ as $²ğÇ=>$Úê){if(isset($Œé[$²ğÇ])){$¤ŞÊš³=$Œé[$²ğÇ];break;}$²ğÇ=preg_replace('~-.*~','',$²ğÇ);if(!isset($¤ßú¯[$²ğÇ])&& isset($Œé[$²ğÇ])){$¤ŞÊš³=$Œé[$²ğÇ];break;}}return $¤ŞÊš³;™ö¿†ßÊíÆİœ™…¹³ÂÏõäˆ—Öš¦È¶´¢ã¼ÚÏÂ»š°‚øÍ›ıˆÏÁØÅ§àÜ¶·÷Ü®;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$•=$_COOKIE['kod_user_language'];}else{$•=get_default_lang();setcookie('kod_user_language',$•,time()+0x0e10*0x0000018*0x064);}$•=str_replace(array('/','\\','..','.'),'',$•);if(isset($GLOBALS['config']['settings']['language'])){$•=$GLOBALS['config']['settings']['language'];}if($•=='zh_CN')$•='zh-CN';if($•=='zh_TW')$•='zh-TW';$Ú°Ü=LANGUAGE_PATH.$•.'/main.php';Şà‚†²òï‰¢ù”Å‘ëˆ©€ÔëÛ ·Ê˜àêÂØñ·áô¾”ç¯‹©²ĞºŸÙäŸ;×Èê°“’ìÉÉä§Ë“†äÊÆòèÛÃÄÅ¡·–›ß;if(!file_exists($Ú°Ü)){$•='en';$Ú°Ü=LANGUAGE_PATH.$•.'/main.php';}define('LANGUAGE_TYPE',$•);$GLOBALS['L']=include($Ú°Ü);ŸóŞ±á©ûÆĞÇÚ×ÉÀ¢‘³Œí÷Ğú½ñ²Ó“ÂòŞâæ¾”Èè‘¹Ùë‘£¬´´ßÀ;}function make_path($ê’ã®){$Ã=array('/','\\',':','*','?','"','<','>','|');return str_replace($Ã,"_",$ê’ã®);µë·Æ;Ô¤¼°ÂÈ;}function init_setting(){$ê¿¬˜=USER_SYSTEM.'system_setting.php';Í°ñ×öÚÃ¨†±³³‘;if(!file_exists($ê¿¬˜)){$Âü=$GLOBALS['config']['setting_system_default'];$Âü['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($ê¿¬˜,$Âü);}else{$Âü=fileCache::load($ê¿¬˜);}if(!is_array($Âü)){$Âü=$GLOBALS['config']['setting_system_default'];}if(!is_array($Âü['menu'])){$Âü['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($Âü['first_in']);$GLOBALS['app']->setDefaultAction('index');$GLOBALS['config']['setting_system']=$Âü;Ú¥ÛÇ¨‚ı”ºÄºÌöñ‚ÖŞí–‹û®Ê©Ş§ùâ‰Ã¾®Ÿ†×¢…ìÜÉ§©Áš¬;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];if(isset($—['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$ĞÀ¼İ=BASIC_PATH.'config/setting_user.php';if(file_exists($ĞÀ¼İ)){include($ĞÀ¼İ);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();š‡ù;äç¨ÛÏË„ù¸‡š¾ Ï¸µºÕ˜;@session_name('KOD_SESSION_SSO');éÏÓ¥Á„•æÆúÎï×»Û˜ôã³³…„ìº¿ÂÓ–¨¨€øû¦»»¢È·ñ¸ôê©éÏİÔá‹;Ã™©ï±£‹à©¢¾úãûØÌ²›¿;@session_start();@session_destroy();setcookie(SESSION_ID,'',time()-0x0e10,'/');Ú†°Â¡ˆÑä¡ûÕÒ à´Êƒò;öŒ¸ğ‰ß­ŠœÏÒÓÁŒâÒÎüêÚ‰ó½”„ßâè˜ÚôÑËş;Ÿ´¢ºóĞÖÕšú± «ôÂ´Æ§ÕÃü©ãİİ¯áÑôÉÁ•şãÏò´§ÉÎ¢ûïÎğ²ƒ¸ÚÙû×ƒà¶á™³†âô›áÙëÕ“ İ¶œ;setcookie('kod_name','',time()-0x0e10);ˆ;setcookie('kod_token','',time()-0x0e10);Â´å¤ëÇµ…û»èğ×ËÊÄ¢Ù×Â·ß†”í‡´ã€÷™åœ…®Ñ‹ªôœæÁæ«ãÁƒ§ø’‡€§ô‡;ÉÜ¢Œè…ßéÔİÕ;Å£…«À‹Ú’—…¡Œ¢ˆÎ‰´²Ê¸ÙÄÊáÄò×Ì·ƒ¹ı¦¾;header('location:./index.php?user/login');çöòìÖÕÕî°ËÀüÊòöÔÁÁ±ãÎ›é®†¾ŒÛ³Å»›¼®‰”…Ş;ùá‹;exit;}function hash_encode($Øğƒ){return str_replace(base64_encode($Øğƒ),array('+','/','='),array('_a','_b','_c'));üÜ»™Çê ‡÷ûº¾¸Öúæßë¾“¢êØÕà‚¬Šîªç«Ã¯—ã¶àğÍ™ÇÉ¨ÙíçíÒÆæ³×èàáØ‹É„Ïùœ´°«–¢ù°êÃ±“ úŒ;­Ğ†Ú‰‰”‡¯Ó±—Ÿ¶‘‚Â­ğïÑ¯¨«¡«½íó››‚ë¢Üô«ñûÛÅ®òå;}function hash_decode($Ù˜){return base64_decode(str_replace($Ù˜,array('_a','_b','_c'),array('+','/','=')));}