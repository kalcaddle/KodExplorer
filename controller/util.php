<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($¶){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $¶;}$¶=str_replace('\\','/',trim($¶));if(strstr($¶,'../')){$¶=preg_replace('/\.+\/+/','/',$¶);}$¶=preg_replace('/\/+/','/',$¶);return $¶;ëÎÕ›ıšÅçó´”;}function _DIR($Ó©ú){$Ë’=_DIR_CLEAR($Ó©ú);™Ê†©¶ÕÇ;şªî;$Ë’=iconv_system($Ë’);Šë·•ƒî¦»Çö’èÂæ“½­ŞÍÀˆµæ“´’¡¤ìŞì;$Ë¥Î”=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);$GLOBALS['path_type']='';êëİ†Ö°úß;Åí…Ø¬²¸ùóÁ;$GLOBALS['path_pre']=HOME;$GLOBALS['path_id']='';ìö‰ÙÖõÑ¢œŞñ±“ü¾›Ó¬ ­ÙÓæÓÇ¨„£üèôòêËé¼í†œà·¯İÆîøšœšÇõí¯Ê;unset($GLOBALS['path_id_user_share']);foreach($Ë¥Î” as $ÎÙÕ¸){if(substr($Ë’,0,strlen($ÎÙÕ¸))==$ÎÙÕ¸){$GLOBALS['path_type']=$ÎÙÕ¸;$Ê¬Õ––=explode('/',$Ë’);$…=$Ê¬Õ––[0];unset($Ê¬Õ––[0]);$¯å=implode('/',$Ê¬Õ––);$ßÄœÏ=explode(':',$…);if(count($ßÄœÏ)>0x001){$GLOBALS['path_id']=trim($ßÄœÏ[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$Ë’=iconv_system(HOME).$Ë’;äø¦¡ä’€êè;break;âÇ®­ş‡üØİ¶Ä¨âš¿ù­Ä—İ«ì½ğ‰¯Àù‰¿İÑîŒÑö‰«ÔÀïü¤Š½¸ƒµ—®¢Õ ¬ãÏìŞÙ­¼¬œÈı”Ò©è“š;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');¤ÕŞ§ŒõÖ¯ËöÛ°ÇÉ;çìäñª½ƒ‘Íé¿êÂÇ”¦ì±‹æ×­Ëê®·ÔŞµ†Œ›ø¶ØüÈ§ç‰“;$GLOBALS['path_id']='';”•Í¨ç÷’ú“ø³¸Š—Æ–ÆÚ•¢‹İì›€ãæÏøû¡ä—´ßª;return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$Ë’);¾Ùİ¥²‹ñ¹©ò™È’ÏÏŸêÉÖÄÆŸì¯;case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');ú“µ‰°ûãÆŸï¤Œ‹¥ğò;$GLOBALS['path_id']='';•ŒÔ¬Àµ×îÉ»»è·ÎÁ€›¦Çº–ëÇ¢’¸•‰£…°ÚËğ£àÚßœÃ—êâØëşş³¹– ‚¸³»Í¼ŞÓÚ¯¦ÀÊâ›«şßÂ;return KOD_USER_FAV;×Âœ‹ü²¬şëß»¹œ›;«¸‚‰Ş´•ĞÒÏúÆéÃÙ¹“ø¥ÜÏê¤ï×Ó™×®“€;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');Ÿ­ıéš–úØú¾õÒ“ŞşÅ‹;ä«;¹ë‡Ôúş¸®·‰¾ÒŸÎÍøÊŒïƒûÉˆŒûòÆçúœãú;$GLOBALS['path_id']='';return KOD_GROUP_ROOT_SELF;Ê÷Ò´»­îÏ¦•;‹§ÃÚô½¥‚­Â±¿úÇªö»ğ;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');Ã±«àË÷;$GLOBALS['path_id']='';æØ¦€±Õ”;´İÓòƒÕ Æå;return KOD_GROUP_ROOT_ALL;Î;case KOD_GROUP_PATH:$¯Æ‹¡=system_group::get_info($GLOBALS['path_id']);if(!$GLOBALS['path_id']|| !$¯Æ‹¡)return !0x001;owner_group_check($GLOBALS['path_id']);óÚÌÀÒƒ±Õàå´´Ø·‹ùşğÍ†õœÔ¦âàÇŠ¢öô–ÑÁ×¤Å;$GLOBALS['path_pre']=group_home_path($¯Æ‹¡);ùÚ;¯ÛÉççÄæÙ’ìĞ®Âö‘£¾›Æ¶‘İˆÓµ­™¾¨À¯×ø;$Ë’=iconv_system($GLOBALS['path_pre']).$¯å;§ßĞ”°ş×;break;ú€¡•¼˜–€î;case KOD_GROUP_SHARE:$¯Æ‹¡=system_group::get_info($GLOBALS['path_id']);Â¿ ¥“ÕÓ­•ûîÅÔ¾•“ü½òÍÑ¤ÍªËß¦³;if(!$GLOBALS['path_id']|| !$¯Æ‹¡)return !0x001;owner_group_check($GLOBALS['path_id']);$GLOBALS['path_pre']=group_home_path($¯Æ‹¡).'share/';ŠöàßÊõÇı»œŒú² øï”ÆÂ¸•í„õ”¸ƒı‰Ñˆ²èËÂŞ”Á›;$Ë’=iconv_system($GLOBALS['path_pre']).$¯å;break;íÔ‚Ö˜»ì†Àâšøæ™‚¸¡„ëŠ;case KOD_USER_SHARE:$¯Æ‹¡=system_member::get_info($GLOBALS['path_id']);äï…–¾œú­«Ğ°ƒèëğî¬ÓŠ¥»£¨óÅ¬àÏü¹â€¿ù¾;ˆÒ…öâğ¾“¿ÏÒºÏáÜäŸôû®õêåõŒñŒŞ¯ƒç‚ˆŞå™Ğ¥¬ôşËÄá¨ª;ˆÆ‹°ŠûŸ¶ĞªÜŒÍ†”²áã°ñ”ñİ±¹…ÁË¼ÍûÆÊœı›ÆÚ¨•à©©”ŒÅı¬Ùğ‹è¢ÄíÁ‡ºıÕ·Å ÔÃ¼›Ÿå±€Û•œ;if(!$GLOBALS['path_id']|| !$¯Æ‹¡)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$Ó©ú;—µ‹£Ÿ®èğïÉïÆµæ;if($¯å==''){return $Ë’;}else{$ù¤ñ™=explode('/',$¯å);$ù¤ñ™[0]=iconv_app($ù¤ñ™[0]);$¤=system_member::user_share_get($GLOBALS['path_id'],$ù¤ñ™[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$ù¤ñ™[0].'/';unset($ù¤ñ™[0]);if(!$¤)return !0x001;$š=rtrim($¤['path'],'/').'/'.iconv_app(implode('/',$ù¤ñ™));å»£Å¢¼–Çé§¼;if($¯Æ‹¡['role']!='1'){$ŠÑ„Àİ=user_home_path($¯Æ‹¡);$GLOBALS['path_pre']=$ŠÑ„Àİ.rtrim($¤['path'],'/').'/';$Ë’=$ŠÑ„Àİ.$š;}else{$GLOBALS['path_pre']=$¤['path'];$Ë’=$š;}if($¤['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$Ë’=iconv_system($Ë’);}break;üÏæ”Ú…ñƒÖè’°®´íÅü×ì¹Áà¼üéÚ¸½Øˆ¤ì;îı;default:break;Õ­áã;£¯‘Óƒ·Ş¨Ñø©°•Œƒ™ÌàÁ­íÑëÓÕÚ;}if($Ë’!='/'){$Ë’=rtrim($Ë’,'/');if(is_dir($Ë’))$Ë’=$Ë’.'/';}return $Ë’;}function _DIR_OUT($¡ ){if(is_array($¡ )){foreach($¡ ['filelist'] as $Ôş=>&$¦ø÷§){$¦ø÷§['path']=pre_clear($¦ø÷§['path']);}foreach($¡ ['folderlist'] as $Ôş=>&$¦ø÷§){$¦ø÷§['path']=pre_clear(rtrim($¦ø÷§['path'],'/').'/');}}else{$¡ =pre_clear($¡ );}return $¡ ;}function pre_clear($­§){$è=$GLOBALS['path_type'];$ºËé¢=rtrim($GLOBALS['path_pre'],'/');ÄöÕá—û¶—ÉÜ‘Á…»Ï¹é;$ºøßéö=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);å;if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$ºøßéö)){return $­§;}if(ST=='share'){return str_replace($ºËé¢,'',$­§);}if($GLOBALS['path_id']!=''){$è.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$è=$GLOBALS['path_id_user_share'];}$ªØ§Õ=$è.str_replace($ºËé¢,'',$­§);$ªØ§Õ=str_replace('//','/',$ªØ§Õ);Ñ–Ê‹ğüØ;ÍåŞ„ü©áëçË»¡µ³Û®”Æ¦¯üˆÚÕ¯±â›şÅèä¥íâÎĞò»¸¾öÙó«¶£¿üÉ;return $ªØ§Õ;ÊĞû³ûù‡á ôÅîÆ¸ªşö¢ÙëÍ‘Ùü‰¬ÈÙ­ÅÊÁ‰Ñ¤©Çé˜¢Ãšæç‡´ø—ÂˆğÀ‘Š;ÜØİÂ¥ÚÅ°Ğ –£„•à¶“³;ù—’ƒé¶­± ÅÀÃŠÏŞğ·å¦±üéºí«ËŒµ¸×†³ï™·ÙÏäŒğ;}function owner_group_check($”§){if(!$”§)show_json($GLOBALS['L']['group_not_exist'].$”§,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$úÎ‡÷=system_member::user_auth_group($”§);if($úÎ‡÷!='write'){owner_check();if($úÎ‡÷==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$ò›Æ=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$ò›Æ))return;if(in_array(ACT,$ò›Æ[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($º²–){if(get_path_this($º²–)=='.DS_Store')return '';if(!function_exists('iconv')){return $º²–;}$—=$GLOBALS['config']['system_charset'];$üÂ='utf-8';Ç âÂïêº¨­¡¼•©„áÊş†±´‘É×ŒÈÁ†Ö‰§ºË—¥†¿Ó¨Í;Ğ×«¶Í³ù›“İÌ§;$”¡Â“À=get_default_lang();ÚÍéœ–«¢ìµÉ§àÍˆ¡¡°ï²ïçÆ‘«ÚÑô ÇĞ°–»Ì¬çîš¹Â›‘¦½³×®åÈ—¬;if(client_is_windows()&&($”¡Â“À=='zh-CN' || $”¡Â“À=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$üÂ="gbk";}return iconv($—,$üÂ,$º²–);}function unzip_pre_name($¨ôŠ){if(!function_exists('iconv')){return $¨ôŠ;}if(isset($GLOBALS['unzip_file_charset_get'])){$‹Å¦¸=$GLOBALS['unzip_file_charset_get'];}else{$‹Å¦¸=get_charset($¨ôŠ);}$•Ó=$GLOBALS['config']['system_charset'];return iconv($‹Å¦¸,$•Ó,$¨ôŠ);éë¨‘©Ûè×Á±îîŒ;}function unzip_charset_get($ ®ôùº){if(count($ ®ôùº)==0)return 'utf-8';$ óè=array();for($´†ß=0;$´†ß<count($ ®ôùº);$´†ß++){$ñˆ=get_charset($ ®ôùº[$´†ß]['filename']);šæ•£é­ÄîÚÂÁ¯“şá½é«á¤ú³„‡Í«“¼øñÖ—ØëºÃš€²ôÂô¥Öó‡”;if(!isset($ óè[$ñˆ])){$ óè[$ñˆ]=0x001;}else{$ óè[$ñˆ]+= 0x001;}}arsort($ óè);§Ìã–Ø–“‚¯Â÷©ü³Éñ€ºÒ‡›ñù¤;ƒ®«‡µø²Éµ«»Ã•øşØ“şŒ‰Â®™õ¶­Ôè¤×—ÏßÍÉ“˜€¿Ó;$‰=array_keys($ óè);$GLOBALS['unzip_file_charset_get']=$‰[0];}function get_charset(&$ã‡Ö){if($ã‡Ö==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$‰†º‚°=strtolower(@mb_detect_encoding($ã‡Ö,$GLOBALS['config']['check_charset']));if(substr($ã‡Ö,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($ã‡Ö,0,0x0002)==chr(0xFE).chr(0xFF)){$‰†º‚°='Unicode';}else if(substr($ã‡Ö,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$‰†º‚°='utf-8';}else if($‰†º‚°=='cp936'){$‰†º‚°='gbk';}if($‰†º‚°=='iso-8859-1')$‰†º‚°='Unicode';if($‰†º‚°=='ascii')$‰†º‚°='utf-8';return $‰†º‚°;‹ÕÙËèñË©ÆÙ­°à¯óü±Ã¡õ•ôÓİ€ßúó‘ğ€“ÆÙß°Ì¬Ù“†;}function check_ext_unzip($§ƒ™,$¥½•¯ú){return checkExt($¥½•¯ú['stored_filename']);}function checkExt($˜€â¢‡,$¤·=false){if(strstr($˜€â¢‡,'<')|| strstr($˜€â¢‡,'>')|| $˜€â¢‡==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$­æ=$GLOBALS['auth']['ext_not_allow'];ğ¯®Ä¾ªä ±öÉœÉş²ĞÖˆò²ºôâèÛ¹™ÅªÉÔÙ”„;$´µêıÒ=explode('|',$­æ);¬™ï„¢ã·İØšÆµÔàú€ªĞÙ¸åŞ¬š•—™ç‘áº¾û«ÃŸûüç;foreach($´µêıÒ as $Ã){if($Ã!=='' && stristr($˜€â¢‡,'.'.$Ã)){return 0;}}return 0x001;}function file_upload_size(){global$config;ˆĞ¦´ë¼Ë…¤İçßœã‹à„›ÜƒóÄ¢àé¼Í¹¨•Áø¼õåøÁë Óş¼¸Š¼¥;ˆ—”°ó‡ì—Ó‰ë;î„ËÏí‰¨±³é«ğà’ê£ı;if(isset($GLOBALS['config']['settings']['update_chunk_size'])){return $GLOBALS['config']['settings']['update_chunk_size'];}$ˆŒ“=get_post_max();return $ˆŒ“;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$Œ=$GLOBALS['in']['user'];}else{$Œ=$_SESSION['kod_user']['user_id'];}system_member::space_check($Œ);}}function space_size_use_change($ø£ê,$—=true,$Š“=false,$úœØ‡=false){if(!system_space())return;if($Š“===!0x001){$Š“=$GLOBALS['path_type'];$úœØ‡=$GLOBALS['path_id'];}$—=$—?0x001:-0x001;if(is_file($ø£ê)){$“ØÌå=get_filesize($ø£ê);}else if(is_dir($ø£ê)){$÷á¶ñ…=_path_info_more($ø£ê);$“ØÌå=$÷á¶ñ…['size'];}else{return;}if($Š“==KOD_GROUP_SHARE|| $Š“==KOD_GROUP_PATH){system_group::space_change($úœØ‡,$“ØÌå*$—);}else{if(ST=='share'){$ ”=$GLOBALS['in']['user'];}else{$ ”=$_SESSION['kod_user']['user_id'];}system_member::space_change($ ”,$“ØÌå*$—);}}function space_size_use_reset(){if(!system_space())return;$É˜‹İ=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';ÉªÂŞ”Õ·áóŞì€;$Ş=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';if($É˜‹İ==KOD_GROUP_SHARE|| $É˜‹İ==KOD_GROUP_PATH){system_group::space_change($Ş);}else{$€›ò=$_SESSION['kod_user']['user_id'];system_member::space_change($€›ò);}}function check_list_dir(){$¸=APPHOST.'lib/core/';èáóö¶Õ¢„­ãí­úÍ´³ÍÏ¦ïı—©;€Ü¥í˜ˆĞ·İûÈƒ²;ÉáÆÀîı—’‹¦–ŒÓúú‚õÉ¶ª˜†Ğ¦öÎ¾ ¯½òùŸº»¹Ò¡Äù¸ÑÍ³ÍÏª—‡Ô°¦Ö„õ•¥¦Ó˜ óÓÛ;$¥Ò="Application.class.php";$¥÷’ò=@file_get_contents($¸);Ï’»İ¸;if(stripos($¥÷’ò,$¥Ò)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$ı¡õñ=$GLOBALS['L'];„‚œ×¬úü¤ïíÊû¾Ü¸œ–Ì€Äõ‰šôªç¡âİ¥åúü’õù·„ê¥Îçä¬ Âì‚ˆã‹¢Ø¶³À×—Ÿüü;ÒÆ¼¤şš ÇÓÍ’æ çŞêÒ;$‘õÇ•='';ÉÒ‘éÔÓ×ÖÛ¼âş–™²ÖğÊöîÇ’é×£ßŸ¸ÁŒà¯öµƒÎßŒïß¢‰“øúİğé¥ƒÔı§´àö«ıƒŒ®ùÂ²ÉÏ;×ƒ€©;if(!function_exists('iconv'))$‘õÇ•.= '<li>'.$ı¡õñ['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$‘õÇ•.= '<li>'.$ı¡õñ['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$‘õÇ•.= '<li>'.$ı¡õñ['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$‘õÇ•.='<li>'.$ı¡õñ['php_env_error_file'].'</li>';if(!check_list_dir())$‘õÇ•.='<li>'.$ı¡õñ['php_env_error_list_dir'].'</li>';$Àò÷Ê=get_path_father(BASIC_PATH);Ÿ‚Üœıå¹Ñ´Ì¹Ôµ™¿ˆ¢á÷«ıĞ¯ıùÁ;ã°Šæ…ˆº¦ï²ÑîµŞ°¢ÏúòâĞ³ÕÉıÜ¼ÄÀ õËˆúÔ—¶ú‡èÍõŸ­”;$ÏãËÂ=array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');æôù£º»Ä°ˆÌ¬Üäâ×ëË¦âëÓö¼£Ûˆå;foreach($ÏãËÂ as $¥İ){if(!path_writeable($¥İ)){$‘õÇ•.= '<li>'.str_replace($Àò÷Ê,'',$¥İ).'/	'.$ı¡õñ['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$‘õÇ•.= '<li>'.$ı¡õñ['php_env_error_gd'].'</li>';}return $‘õÇ•;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$÷=LIB_DIR.'update.php';if(file_exists($÷)){include($÷);update_check($÷);}$¿Ãëİ=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($¿Ãëİ);}}if(!is_writable(KOD_SESSION)|| !is_writable(DATA_PATH)){show_tips($¿Ãëİ);}}function init_config(){init_setting();œ °İ„ƒå ôï™…–‘û;init_lang();¥ß¨‰ıéõ¾Úª°‘ÇĞÂ¥ÕÆŒõ¼û;°ïÄÔËÍ»;init_user_setting();±ìí³úæ©»çì§Æ•öüª“Ú;¿Šıç°Ş;}function need_check_code(){$ß¯œÏ=$GLOBALS['config']['setting_system'];if(!$ß¯œÏ['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$îÙ="en";ç¦ÑŠåÛˆÍŒçŞÆÅÙõáã‚ª¹ªşïŒ¥±ã‰ïË¯ÁÕ•Şã«;¾ğ‚…†ùƒ±;$Ôªêè=$GLOBALS['config']['setting_all']['language'];$È»è=array();foreach($Ôªêè as $Ÿ›‡Â=>$àä¼ ){$È»è[$Ÿ›‡Â]=$Ÿ›‡Â;Ü¹ªÇ‰ãñôÌşÁ–ºª¯œ;}$È»è['zh']='zh-CN';Õ„ï·è­×¿ìşœ§©ªï²;©Ü€È¼ãó„¦æ‘Ã;áèñ”¢¹ßíÜíÄáİûËŒÔ‹øÓ¨¡ıÒ‘°á;$È»è['zh-tw']='zh-TW';ÖÂ°ô×Ó®·ÁŒ¥‡î„ƒ»ØÇŠ­ï««Ã½Ü¥²¶ãŠø•€Ñ;»œäÆğ¯;¬»¯³;$´¶=array();®Ï½ûèâº;Ç¤½¤¥†à‰ú;üìøöƒøÈì¨ÒšäƒÍ;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$÷='en';}else{$÷=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$÷,$•¦ÎÒÅ,PREG_SET_ORDER);foreach($•¦ÎÒÅ as $¼¨†){$´¶[$¼¨†[0x001]]=(isset($¼¨†[0x00003])?$¼¨†[0x00003]:0x001);}arsort($´¶);foreach($´¶ as $Ÿ›‡Â=>$Ÿì÷£){if(isset($È»è[$Ÿ›‡Â])){$îÙ=$È»è[$Ÿ›‡Â];break;}$Ÿ›‡Â=preg_replace('~-.*~','',$Ÿ›‡Â);if(!isset($´¶[$Ÿ›‡Â])&& isset($È»è[$Ÿ›‡Â])){$îÙ=$È»è[$Ÿ›‡Â];break;}}return $îÙ;•ªô˜ø…Ñ;¼„Ãå—¾ËÈ Â½Ò¼øÁÒ™÷Ùéş˜À‡‚ØÉ¸²¾½¿‚£×Àî á²İµîÖ÷ÁğïœÚï´›ö·ôÀ¹®ó÷ë;“¤åêé£”ğ§Åä¨åÒ¡‰¹ãšÈøÅ½’¾Ãã¼Á³ÏæÒ¶Ò½Ùæ®‚­”«“æÌœ °¶éªü¨¼»ë ÷®ÓÈ;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$èäÙÏ”=$_COOKIE['kod_user_language'];}else{$èäÙÏ”=get_default_lang();setcookie('kod_user_language',$èäÙÏ”,time()+0x0e10*0x0000018*0x064);}$èäÙÏ”=str_replace(array('/','\\','..','.'),'',$èäÙÏ”);if(isset($GLOBALS['config']['settings']['language'])){$èäÙÏ”=$GLOBALS['config']['settings']['language'];}if($èäÙÏ”=='zh_CN')$èäÙÏ”='zh-CN';if($èäÙÏ”=='zh_TW')$èäÙÏ”='zh-TW';$ü¨‡‘=LANGUAGE_PATH.$èäÙÏ”.'/main.php';if(!file_exists($ü¨‡‘)){$èäÙÏ”='en';$ü¨‡‘=LANGUAGE_PATH.$èäÙÏ”.'/main.php';}define('LANGUAGE_TYPE',$èäÙÏ”);$GLOBALS['L']=include($ü¨‡‘);†äš°áÂì¯–Şáßô‰;}function make_path($„–){$¬=array('/','\\',':','*','?','"','<','>','|');return str_replace($¬,"_",$„–);}function init_setting(){$‡«³É=USER_SYSTEM.'system_setting.php';›ê™×êÅõÑÉ¿´–¤‰Ò¥¸şÛ„£Ê;èØˆÈÍ’©¬‚âÚ†ù‡²˜Äî°Û‡â²µ­Ëˆ;if(!file_exists($‡«³É)){$ñğ=$GLOBALS['config']['setting_system_default'];$ñğ['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($‡«³É,$ñğ);}else{$ñğ=fileCache::load($‡«³É);}if(!is_array($ñğ)){$ñğ=$GLOBALS['config']['setting_system_default'];}if(!is_array($ñğ['menu'])){$ñğ['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($ñğ['first_in']);$GLOBALS['app']->setDefaultAction('index');ï°ù;ãúÇÕ—ÁÜÊÚ¢ºçÒ–ïÔù£Š§ï“Ïá„Ğİ¿Ÿë;$GLOBALS['config']['setting_system']=$ñğ;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];®ÍŞ‰ï™ñÃ°â™ª‡¤Ò;¢ÉÄÖ;Ø»ó¶ú“£Ÿ® ŒŸ´º;$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];İ­¶¢İš»‰¡ßÛ˜—;²™²ëÕ¶áŞª–Á¿¤±ïŸ»ù†Œø‹®ÂÏ†£ºæÕÊ€‰¶ßí¾˜—Ø¼³ÈÛîÂâú¼íª€¾°£ø—ùÃ˜;ò¨Ï‡ËïµìûÔ¡¶Âµú¡â²ÄÁÌ€Êíà¦†ø¦÷Íš¡¡ì×ÚŠ­ûÁğ²¼“•î××»Ø¢ª¹É°³ï;if(isset($‹['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$Ÿ­·=BASIC_PATH.'config/setting_user.php';if(file_exists($Ÿ­·)){include($Ÿ­·);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();Œ×¤èÆæËÂ¤ºì¤øÈñµÂ¶ÎÆ±†ªš;@session_name('KOD_SESSION_SSO');@session_start();··×§¯ãçÑ¢œ¾ÕŒç×—±;ğ÷›É;¥ÊüİıŒØ¢ÎÚ§·éÖ›Ò©©ôÅèËÒĞ£êƒ›°íÀúêù÷÷Çˆ÷îÀâÅÜµî‡;@session_destroy();setcookie(SESSION_ID,'',time()-0x0e10,'/');setcookie('kod_name','',time()-0x0e10);Á›óÄ¶¤²;setcookie('kod_token','',time()-0x0e10);—š—·Ş˜°;header('location:./index.php?user/login');“µÉƒ½ô¹­ìÂî‰;‹ÁÍ…à–ö–Ù®ä¡ßëËúª™˜¹‹Ô;exit;å°«ºÙ·ü§¼İ¾´ô™âÚºÃÆ†¿ğŸ×ª«è€€–;¸ú†Ï–ßÎü÷şÊĞ’Ş‡ÜáÄÑœò¿ŞâÈ•—‰ï€Âë‡’‚¥ñĞ¢êĞì»ãËÃÀ®‰’ÊûÒªß›¿÷¥°;}function hash_encode($Ÿ¤ìğÆ){return str_replace(base64_encode($Ÿ¤ìğÆ),array('+','/','='),array('_a','_b','_c'));”¦€Øæ¯âùùßÌ¥¿èä·–°õ³¯ğÓ;}function hash_decode($·ˆ){return base64_decode(str_replace($·ˆ,array('_a','_b','_c'),array('+','/','=')));Ñ¦•‰ûèÜ¡¨Æ‡àÔ‘ËÑÀ½¦–;ÌÛ×“â—;ó„¢£ÕÉ¹×ÒÉÓ»§õäíüÅÃ›×ì™Í“¯ê€âÀ;}