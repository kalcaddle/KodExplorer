<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($Ù){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $Ù;}$Ù=str_replace('\\','/',trim($Ù));if(strstr($Ù,'../')){$Ù=preg_replace('/\.+\/+/','/',$Ù);}$Ù=preg_replace('/\/+/','/',$Ù);return $Ù;´Î¿ˆêÛ‰«“’ù™¿ÁÏÂŸ °ßùæ¯½¾ÉĞ»¨šï÷Úøâ¶‚É•‰âÔË;}function _DIR($Ì½ÇÛ){$…¡Ñ¤=_DIR_CLEAR($Ì½ÇÛ);íÍÏÈÆ³şÉÂÉßÌ­´˜áÍƒ¶–şëØáĞÚ„€­á×›°§äöÛäÁ®¡ëÜÖ„¾¤ˆôºˆà;$…¡Ñ¤=iconv_system($…¡Ñ¤);$ú×=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);²øƒ»­;ÆøÜ’©áÁ•¯€İÍÛÅÒı˜Ó£Ã×àìÓ¹„·öìÖ½íÏšùüÃ¬Ãí;$GLOBALS['path_type']='';ÍŸË¢Âú¤üÎİ‡Ô;$GLOBALS['path_pre']=HOME;Ü®­İ¨«¡¸×å¦Ó;³Í×;$GLOBALS['path_id']='';§Äè¶¿´ëµ–;unset($GLOBALS['path_id_user_share']);Ó‚£‚àÌ­ƒ††è¬Ùïˆû•¯Àşæ€›øĞ¦ºõ›÷¿;¤§™Ö–ˆŠ³Ù;foreach($ú× as $¾Ü“){if(substr($…¡Ñ¤,0,strlen($¾Ü“))==$¾Ü“){$GLOBALS['path_type']=$¾Ü“;$ÆÀ=explode('/',$…¡Ñ¤);$ÈšÌ=$ÆÀ[0];unset($ÆÀ[0]);$ÚÌßÛÙ=implode('/',$ÆÀ);$ëÓÌ’=explode(':',$ÈšÌ);if(count($ëÓÌ’)>0x001){$GLOBALS['path_id']=trim($ëÓÌ’[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$…¡Ñ¤=iconv_system(HOME).$…¡Ñ¤;»î®•üìò‘²¹;’†µ«İÌ´çüíêÅùÀœ‰Ò¡ÊÁÀ›ãı¹Şášìô¡£ şïÕæğääßĞªÚ‘Æääè¯¦©ÊŠ§„é‰Ÿ;›ë½”Ç‹ô¤äï¸¼£ÇşÒä»Â”ÑÀÄÑ³ş¤…ïÀñ®Õ¹¹Êİºí×÷’ ÷ä…³¨™…è›ÉºÏÈß;break;Æçö¡ÂŞÀıÍ™õà¹;úŸ¿ëõ§ÜÚ½«·˜½şü¢ç­È‘øÓ¹ü½Ã•ÁŞ‘áŸüØÇÙ´Ô˜ß±Œ¯ÁôÜ‹;¡îÙ¦×ôğ“Åºó›ó•âÛŒãıÏÃ¿Í‘ØÃò“±¹;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');¬ú¢ë•ç¦‰ƒ›Ÿå÷«Éõú¶ÉŸ;$GLOBALS['path_id']='';Ô„ñ³ÆĞÄ©ïÁ‚¸œ¶´—šæ¶§–÷œó„£ÊãäŸ‚è’µ°ãùÙ;return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$…¡Ñ¤);Ø“š«µõáÜŒÚøŞÌÃ‚ëÅëşúâõö·³ÔÄèŞ›””’;case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');ô£öÅúŒ­¢–°½µ–µ;Ñë ±‰ìôŒÙ»øØ¶–»­óáâ¸îË;İîâ§ò´¡–ôíˆâ°–Úõ’æ£´ıÔñ´ë¨;$GLOBALS['path_id']='';return KOD_USER_FAV;¼¸œË¬ÑìÃÆÚĞÏ¾æ™÷øœ­€ñŸ´İÈË«ÀèÖÜ´ƒ¯¡Æõü˜Æ»™­Õ’¦×®Ó×¡óŒş¼×«Ú˜”²õ;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');êüœç•ã¤¯‘úÁ·ÒğŒ;×Ÿ¼©‹ÜÛ•ÊĞ;$GLOBALS['path_id']='';return KOD_GROUP_ROOT_SELF;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');$GLOBALS['path_id']='';return KOD_GROUP_ROOT_ALL;ºñÀ®Ó£çÃï€ÎĞ­ë¨Í¨ÑÙ†­ïĞ;case KOD_GROUP_PATH:$™©Ò=system_group::get_info($GLOBALS['path_id']);‚Æ‡şãï”Ç;Â¡Ş—ÅÆÚµÆ©†ô–®Ã¿Å®—® ºÎ‚‹¯;if(!$GLOBALS['path_id']|| !$™©Ò)return !0x001;owner_group_check($GLOBALS['path_id']);†â÷‹Æ;$GLOBALS['path_pre']=group_home_path($™©Ò);õ¯Á¡ËÄèÒÃÌÂØ”×ìç¤ıËœœÚ¨¹¢Å–ù¢ŒûÑÎ“‡ğ×Ó´°èÎÖôóÕÁ;å—×ÀÌŸéÓ•€;$…¡Ñ¤=iconv_system($GLOBALS['path_pre']).$ÚÌßÛÙ;¬¿şÂº¢Ï¶ôŸÔ’²Ü;break;ö†;case KOD_GROUP_SHARE:$™©Ò=system_group::get_info($GLOBALS['path_id']);if(!$GLOBALS['path_id']|| !$™©Ò)return !0x001;owner_group_check($GLOBALS['path_id']);$GLOBALS['path_pre']=group_home_path($™©Ò).'share/';$…¡Ñ¤=iconv_system($GLOBALS['path_pre']).$ÚÌßÛÙ;œò®§£àõôñÛÊ;»şÆı¸œÉäÛÉ¨—ë÷Í;break;óÊøÕ²²’;®€ˆ±ÙÈ;½µ…³­½Ğ÷£¬ÁÌÄ®Å’İ¶…¨·;case KOD_USER_SHARE:$™©Ò=system_member::get_info($GLOBALS['path_id']);±‘·ª¯ôßÌù”ú¸äòÜ’µ©ÖãîéóÌ¡øõÙ÷õÃ©‡úÔ·ğ´…ëÉ¥®ó‚Á©¬˜œƒ‚é¤ûßıôÖÂŸŞ¾ó–°¨œœòÂ¡‘Äâ»ñûÉ€;if(!$GLOBALS['path_id']|| !$™©Ò)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$Ì½ÇÛ;ÉØ¤¿¯æŞ¦Ó¥×üÁôïß·‘ğüô­îñ÷üñ;ÔìÉù™æíÇ’©…‡œá•çşïÒ‡ÓÏ­Ù…ı©íÓ—·Î°¼ø­Î¢³Ö¿–ë§–ÛùúÍ;Î»Ğş£¯Ê„³¢õ—ğÕÏ;if($ÚÌßÛÙ==''){return $…¡Ñ¤;}else{$Ç=explode('/',$ÚÌßÛÙ);$Ç[0]=iconv_app($Ç[0]);$÷õ»=system_member::user_share_get($GLOBALS['path_id'],$Ç[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$Ç[0].'/';unset($Ç[0]);if(!$÷õ»)return !0x001;$î¹Ü´¯=rtrim($÷õ»['path'],'/').'/'.iconv_app(implode('/',$Ç));±–şÕÆ ÊÁÃË¸Ú¼ª¿×÷¸Í³£¼íñõ¸¨Îı–«àíâ­¦½ê¶è«áãÜ•ˆšƒ‰¢;if($™©Ò['role']!='1'){$¨”İ=user_home_path($™©Ò);$GLOBALS['path_pre']=$¨”İ.rtrim($÷õ»['path'],'/').'/';$…¡Ñ¤=$¨”İ.$î¹Ü´¯;}else{$GLOBALS['path_pre']=$÷õ»['path'];$…¡Ñ¤=$î¹Ü´¯;}if($÷õ»['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$…¡Ñ¤=iconv_system($…¡Ñ¤);}break;default:break;íı£ÊøÁÅ;}if($…¡Ñ¤!='/'){$…¡Ñ¤=rtrim($…¡Ñ¤,'/');if(is_dir($…¡Ñ¤))$…¡Ñ¤=$…¡Ñ¤.'/';}return $…¡Ñ¤;¨ºŸæ¥ÕĞÑä²µÁÈ¾ÛÌÇè;Ãøá½ª¡ó˜ªí­…;¯ğÃ˜ï—Şûˆ·¯ïİ…Á¯éôå¬½;}function _DIR_OUT($ùµ¢ª§){if(is_array($ùµ¢ª§)){foreach($ùµ¢ª§['filelist'] as $¸ÀÖĞ =>&$à¨‹){$à¨‹['path']=pre_clear($à¨‹['path']);}foreach($ùµ¢ª§['folderlist'] as $¸ÀÖĞ =>&$à¨‹){$à¨‹['path']=pre_clear(rtrim($à¨‹['path'],'/').'/');}}else{$ùµ¢ª§=pre_clear($ùµ¢ª§);}return $ùµ¢ª§;}function pre_clear($Ú){$€Ï=$GLOBALS['path_type'];Î¶ış¯æ°€;$¤=rtrim($GLOBALS['path_pre'],'/');$’=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);‰Û›¨Áúñ–‡ÀÍ†ÀıìñıÊÃÌÃ€â™ì‰¼¦ñ‹ƒ³Ä‰¥Û‘æª—§¨…š§Ïİô”İØ­Ëá;if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$’)){return $Ú;}if(ST=='share'){return str_replace($¤,'',$Ú);}if($GLOBALS['path_id']!=''){$€Ï.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$€Ï=$GLOBALS['path_id_user_share'];}$Ì¾ğ=$€Ï.str_replace($¤,'',$Ú);$Ì¾ğ=str_replace('//','/',$Ì¾ğ);return $Ì¾ğ;ÇÒŞ¨;óÇ·…¯á×‹¢ñ²òÏ¨‡®µùâ¡âÅ´;•ÓÎïíÏ¿íüÍ“´æ¥İúîª¹ßŞ±’éùäÈ¢à³Ûõˆ«åõû¦ä;}function owner_group_check($×){if(!$×)show_json($GLOBALS['L']['group_not_exist'].$×,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$’í—=system_member::user_auth_group($×);if($’í—!='write'){owner_check();if($’í—==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$åÉà=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$åÉà))return;if(in_array(ACT,$åÉà[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($†é¢){if(get_path_this($†é¢)=='.DS_Store')return '';if(!function_exists('iconv')){return $†é¢;}$åÉáà¾=$GLOBALS['config']['system_charset'];$›ùœ='utf-8';†öëÉ÷íˆİ·è¤;$§á¼=get_default_lang();şı»£ÌûåóÇËŒÆ¤õí…—œ¡¢Ô˜óÂÎúù¯Ù×®×”Ò¥¹™Ø…¦ ª¯¬¥ÌÎÈ¢æ½ä¶;if(client_is_windows()&&($§á¼=='zh-CN' || $§á¼=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$›ùœ="gbk";}$÷Î›=@iconv($åÉáà¾,$›ùœ,$†é¢);if(!$÷Î›){$÷Î›=$†é¢;}return $÷Î›;}function unzip_pre_name($ğ†){if(!function_exists('iconv')){return $ğ†;}if(isset($GLOBALS['unzip_file_charset_get'])){$ùÚ=$GLOBALS['unzip_file_charset_get'];}else{$ùÚ=get_charset($ğ†);}$ğÇ=$GLOBALS['config']['system_charset'];$éµôÇí=@iconv($ùÚ,$ğÇ,$ğ†);‡Ïß™Ôš‘£µê±¬ÔÚÚ÷˜µ›Šı‰ó³;if(!$éµôÇí){$éµôÇí=$ğ†;}return $éµôÇí;}function unzip_charset_get($Åå){if(count($Åå)==0)return 'utf-8';$¦şÎÀ‘=array();¥¤ÑÂ¬ùÛâ•æàÛ•™·ûÃıá½¤áåòİï¦‚Á¨Åî¢¢Ò¸‰´×åÉõş‚òÂ€Ô¥¶Œªéš¶ìÜŞ²Ì‚Ô ºŞÔ“ÄŸ‰Ã¡û‡¢ÑˆÇ‰—Ó³¦¾;for($İ«¬½=0;$İ«¬½<count($Åå);$İ«¬½++){$ù¿³š=get_charset($Åå[$İ«¬½]['filename']);Ø˜±”¤Óæ¬œïÃï¤ê¯óÉÚ;¨ŠÎŒêšÛÕïÎ¨ƒ¦±Ğİ¡±Î¦€Œ”à¨¤ìùÜË£æš²ò†;if(!isset($¦şÎÀ‘[$ù¿³š])){$¦şÎÀ‘[$ù¿³š]=0x001;}else{$¦şÎÀ‘[$ù¿³š]+= 0x001;}}arsort($¦şÎÀ‘);½…ÁÄ·’£ØÄñ€Åş•¦§º“¢—ßÆıúøñÆÁÜ…àâÇ¦šÚÉó ¼óå¼ŠŒä;$Æì=array_keys($¦şÎÀ‘);$GLOBALS['unzip_file_charset_get']=$Æì[0];ĞÙ´;ÇÌüÙ•ï½Ü–×¸àËØÀ¾ÚÊÊ¿êÆìë•ÇçÜ•äì¥¿‚–üß­Ô˜ ñ¬à°‡¬ûÆ¼ç©Ó£ñ¼‡¡î­àğÃŞÑ;şœºåÈÖÖÇûøöïÂÑ‘É‹¬‘øáÓù†¥ÓºË¡çÛô±³Ì¿úÈ¸ò¹ûÄÊÆĞö×ÉØ¬ÃßÒ˜›âä¼òÌ™èşÌµ¾Çş÷º¸ó;}function get_charset(&$Ñù“){if($Ñù“==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$ÒÀ=strtolower(@mb_detect_encoding($Ñù“,$GLOBALS['config']['check_charset']));if(substr($Ñù“,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($Ñù“,0,0x0002)==chr(0xFE).chr(0xFF)){$ÒÀ='Unicode';}else if(substr($Ñù“,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$ÒÀ='utf-8';}else if($ÒÀ=='cp936'){$ÒÀ='gbk';}if($ÒÀ=='iso-8859-1')$ÒÀ='Unicode';if($ÒÀ=='ascii')$ÒÀ='utf-8';return $ÒÀ;øÍ÷İ‹ê«¤;}function check_ext_unzip($Šáô,$ÕõÆ){return checkExt($ÕõÆ['stored_filename']);}function checkExt($”åÃÇ,$¼–ò›¢=false){if(strstr($”åÃÇ,'<')|| strstr($”åÃÇ,'>')|| $”åÃÇ==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$¸¾ÛòÈ=$GLOBALS['auth']['ext_not_allow'];$Œ”ßÒ¥=explode('|',$¸¾ÛòÈ);‚èó¨‡å°—›—øÂ±Æè¡ğ¼È;foreach($Œ”ßÒ¥ as $‹©±){if($‹©±!=='' && stristr($”åÃÇ,'.'.$‹©±)){return 0;}}return 0x001;ˆ ¨ª€ğñ³â«ò¿¼ıˆÉ“çœ¹±…›Ú¶ëÌãø;¥Òï£Œ ¦õ”Ïüù€”–—ØÉÔÂëÆ€´ğÄ‡ßŒ„…Şó©ë”Ğá© ß¤¡ôº¸ƒ”ƒØÖïŸÖ¥‘œ­;€…“ò;}function file_upload_size(){global$config;if(isset($GLOBALS['config']['settings']['update_chunk_size'])){return $GLOBALS['config']['settings']['update_chunk_size'];}$½éµ=get_post_max();return $½éµ;®Ğ‚¾‚‡Úİ¾Æª£À€¨â­õóæí“”¥Ğş;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$„§…=$GLOBALS['in']['user'];}else{$„§…=$_SESSION['kod_user']['user_id'];}system_member::space_check($„§…);}}function space_size_use_change($äî¨,$è=true,$‘èÂ=false,$éä²‚=false){if(!system_space())return;if($‘èÂ===!0x001){$‘èÂ=$GLOBALS['path_type'];$éä²‚=$GLOBALS['path_id'];}$è=$è?0x001:-0x001;if(is_file($äî¨)){$œşÎ=get_filesize($äî¨);}else if(is_dir($äî¨)){$®°=_path_info_more($äî¨);$œşÎ=$®°['size'];}else{return;}if($‘èÂ==KOD_GROUP_SHARE|| $‘èÂ==KOD_GROUP_PATH){system_group::space_change($éä²‚,$œşÎ*$è);}else{if(ST=='share'){$=$GLOBALS['in']['user'];}else{$=$_SESSION['kod_user']['user_id'];}system_member::space_change($,$œşÎ*$è);}}function space_size_use_reset(){if(!system_space())return;$ë=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';ïÙõµ¤¿íÆï¹Ÿ;¥„Ú‹ÚÅïÇˆä‘¥ãßÉ“Ò±éëâ¬–ÎºÑ¤”Ê‘îÕì;$Æùü=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';óÃî¾×€‘Šé;if($ë==KOD_GROUP_SHARE|| $ë==KOD_GROUP_PATH){system_group::space_change($Æùü);}else{$ì–”¼Ñ=$_SESSION['kod_user']['user_id'];system_member::space_change($ì–”¼Ñ);}}function check_list_dir(){$ñê=APPHOST.'lib/core/';›Ñ—çÖı;Ø˜¸¬üœËÔœÜŞ‡ÛÌï‰;$ÖêĞÒ—="Application.class.php";¢İâúûú´¨ˆ±ÄÓ;$á=@file_get_contents($ñê);œ¹÷¦ÏòËŠæî¡ÎÆ §ø•¶ÏÊ´íïìª¿ßŒ¶ûÆ®¢–°–áÍ¡É½Ã™…ãÁıù÷ÎÅ­¼µšæôùó¬öºÛ™Ñ°´ÚÑı™;³ˆı½øÕ¨É¨À;if(stripos($á,$ÖêĞÒ—)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$¯Å½«=$GLOBALS['L'];éÁ“¯–š‘ÇúÕµƒÓòûªœÆÒÜÔº·…€õ±Á®“¬ğ¦Ü‡ÁíÏ;$é¥ø='';é¤‰±÷å‡³³”¾õÃÑ¢´øş¼ºíŒşØ²÷Æ­ä±ÒíãËÔêşó÷³ˆ·©ËŠÌƒÌ½¾»Ê½”ıµÚ¬›şŠğËßÜÊÓÕşÜ¨¨˜ôªœÁè;æ”„“;˜’²ÎíŞêúŞõìªÕÉõª ô‡®°Æ“ÚâÕÄ¾Óø×æ¬¦Õ‹’Ğêˆ;if(!function_exists('iconv'))$é¥ø.= '<li>'.$¯Å½«['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$é¥ø.= '<li>'.$¯Å½«['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$é¥ø.= '<li>'.$¯Å½«['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$é¥ø.='<li>'.$¯Å½«['php_env_error_file'].'</li>';if(!check_list_dir())$é¥ø.='<li>'.$¯Å½«['php_env_error_list_dir'].'</li>';$–Ş‰=get_path_father(BASIC_PATH);üÕÅØ¨;$‚=array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');Ÿ´œƒ‹àÂßÙšÇ†Á’Óî;foreach($‚ as $Ü­”»·){if(!path_writeable($Ü­”»·)){$é¥ø.= '<li>'.str_replace($–Ş‰,'',$Ü­”»·).'/	'.$¯Å½«['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$é¥ø.= '<li>'.$¯Å½«['php_env_error_gd'].'</li>';}return $é¥ø;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();ø²İ…“ äìº¬óûÉ†Ğ¹„­;ØŸÒÀ³ÖÓ¾;¹­€İƒº¢™”œËò¡ß“†ÍÎ³ÁËı;if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$œ·Í=LIB_DIR.'update.php';if(file_exists($œ·Í)){include($œ·Í);update_check($œ·Í);}$Ÿæ³=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($Ÿæ³);}}if(!is_writable(KOD_SESSION)|| !is_writable(DATA_PATH)){show_tips($Ÿæ³);}}function init_config(){init_setting();init_lang();¡ş½Ë‚ß«•æøäš»±™„ÍÑÑ˜ğ¸Ì¯Ù®íØ”çú”ö¹ßø™Œ€†ô›Á¦´Åô†˜öĞÚ§«Š–„Ÿı€³õ¹”îÒ şÒ¦óíèš£;init_user_setting();}function need_check_code(){$¡˜=$GLOBALS['config']['setting_system'];ƒßÈ£İÈÖÓƒëÃÕŒÂ©³¶˜Ñ»Ëàå“şˆ¬÷Òğû²º;¨ÉïúŠ¤ÒŞãé£È’åƒ€å³‡Á«á…öèÏİÙ †£‚®´Ô™¿°áÑ–äÒ—Ë†¤ÓÈĞµÎ;if(!$¡˜['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$å‡á©İ="en";££ ÀõÜ;$¡ÕË=$GLOBALS['config']['setting_all']['language'];¿ÉÑùéâıßÈ…Âñâ²ßê;Ø;˜ù;$¦Ğ«Ç§=array();—ÕÀèĞªÌÎ‹•ÔÎˆ¸ç£Øë¯ñå˜˜;foreach($¡ÕË as $ÃàŞ=>$öÔÔ){$¦Ğ«Ç§[$ÃàŞ]=$ÃàŞ;¿ŠíÊ Âš¨û›Ÿ;®»‰öÚ¨;æâç€š¬àøè×Í½¦ãûÅ£‡³î§ö‰Ğò¥à“›İâ‚ÀË‚Û÷âÔà»¢Ÿâ†œ¨ª¤ÛšÌÒ¤ÆÉşÙäÜ½;}$¦Ğ«Ç§['zh']='zh-CN';êù;ñ·ú¾¼—ÛÆ¡ÛİÃÁÈûó¹Ùùôˆµı€‘¦æèØÆä˜„å¯ß¬Ñ¼Š•şÒ’ó;ŠòƒìøŸ•¤Äñ¾‘Åâ®Œ­­æ“‹¤úª­æ¥¯µô“¿ç–­á¶Ã‡ú¶ÆŒûª»‰×èïëô;$¦Ğ«Ç§['zh-tw']='zh-TW';ô¤;ÎÄò„º†Ä£ò…Ô¶ÏíÓ;$éı™ó=array();Á÷ø©˜¼øİ°ü;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$¶='en';}else{$¶=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$¶,$¼Ô´,PREG_SET_ORDER);foreach($¼Ô´ as $©ëÎ){$éı™ó[$©ëÎ[0x001]]=(isset($©ëÎ[0x00003])?$©ëÎ[0x00003]:0x001);×Ä¡ğ¸÷ó¹ì—ã…ÓÜâ„Úû»;¡ş§ Ñ¹”ß¦ƒâ›§;}arsort($éı™ó);¥ûÄ¢òÃ„‚ÇËÁ«¿ÓÍ¾;¾Ê´™íŒŞı˜‡òµÁßÌ¦ä¡„È¦ŞÄâûıóÎø®Ãâ§²ï†ÁîÈáÔ‹;foreach($éı™ó as $ÃàŞ=>$¡±§){if(isset($¦Ğ«Ç§[$ÃàŞ])){$å‡á©İ=$¦Ğ«Ç§[$ÃàŞ];break;}$ÃàŞ=preg_replace('~-.*~','',$ÃàŞ);if(!isset($éı™ó[$ÃàŞ])&& isset($¦Ğ«Ç§[$ÃàŞ])){$å‡á©İ=$¦Ğ«Ç§[$ÃàŞ];break;}}return $å‡á©İ;ê•µÍ’´Áà­ïîñÓ—¤Äå³»¯•»×²íşö¤ïáº¦°ÌÚñ®‰âú;ø¯¹ŠÆ¯ŠŒÑ;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$‡¯·=$_COOKIE['kod_user_language'];}else{$‡¯·=get_default_lang();setcookie('kod_user_language',$‡¯·,time()+0x0e10*0x0000018*0x064);}$‡¯·=str_replace(array('/','\\','..','.'),'',$‡¯·);if(isset($GLOBALS['config']['settings']['language'])){$‡¯·=$GLOBALS['config']['settings']['language'];}if($‡¯·=='zh_CN')$‡¯·='zh-CN';if($‡¯·=='zh_TW')$‡¯·='zh-TW';$ ò=LANGUAGE_PATH.$‡¯·.'/main.php';Ê†¬Àµİ‘Ï¼š³Ú–ê·æ;if(!file_exists($ ò)){$‡¯·='en';$ ò=LANGUAGE_PATH.$‡¯·.'/main.php';}define('LANGUAGE_TYPE',$‡¯·);$GLOBALS['L']=include($ ò);òõİ“éûæË™±Ñ;}function make_path($İ){$¡î=array('/','\\',':','*','?','"','<','>','|');¸ «È×“¬–«;return str_replace($¡î,"_",$İ);}function init_setting(){$ÃŸ=USER_SYSTEM.'system_setting.php';ªª¥æË”ô©µá¾áª—;ñ¦™·‰±ÉªÅ;¢ö»¬ª³±Ä÷Ñš»¹¿¢…Ô˜®óÍ‘³°¼;if(!file_exists($ÃŸ)){$¦”ø=$GLOBALS['config']['setting_system_default'];$¦”ø['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($ÃŸ,$¦”ø);}else{$¦”ø=fileCache::load($ÃŸ);}if(!is_array($¦”ø)){$¦”ø=$GLOBALS['config']['setting_system_default'];}if(!is_array($¦”ø['menu'])){$¦”ø['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($¦”ø['first_in']);$GLOBALS['app']->setDefaultAction('index');ô¶è§úáøŒ;$GLOBALS['config']['setting_system']=$¦”ø;«Óê±©ƒßÑğĞ‚­›;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];æ…³•ˆ‡Õ³ğÀä›ÄÄ¸–¶Š˜ä¦À§»²ö†šû¹©ıÏ²Œ;if(isset($ÏáŠÁ['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$ïÜ=BASIC_PATH.'config/setting_user.php';if(file_exists($ïÜ)){include($ïÜ);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();ÑÆØù‚Œğ;@session_name('KOD_SESSION_SSO');@session_start();@session_destroy();ë’ƒ÷éÓÚó•şäñç™ˆç†¨€×ïØÒñåÃú±½ŞÏá–¹¶;setcookie(SESSION_ID,'',time()-0x0e10,'/');ñ“½Ú­ÆÂ´ïÂßœßÒ‚£ÍÕŒîóÜÑ‹;setcookie('kod_name','',time()-0x0e10);setcookie('kod_token','',time()-0x0e10);header('location:./index.php?user/login');ïÙ’ÊˆÙ½ÉÏÊ©ë«ûîÏÊ€¥Öî™³Á¥ÊÉ£‘“ë±Şó‹ë²Ô;ÉŠ¦ÎÂ„ÎšŸ„†¶ûÃñ‡Õ‡—½ÎÀÍôÖøî«ÂùÑ’¼Öá×öåôüñÁù—–‘Õ¥à–òî‹Éçúõ«ôÈ;exit;¨ú™÷Å™ˆ¸ÑÊİœ”®³•šåóğßÁÆ¿ÅÆèÁ;}function hash_encode($¥){return str_replace(base64_encode($¥),array('+','/','='),array('_a','_b','_c'));}function hash_decode($˜Â–­){return base64_decode(str_replace($˜Â–­,array('_a','_b','_c'),array('+','/','=')));íí‚¯µ ïúæØ¼ÇºÅÁºêÄóâ’‹÷õ¤»Œ;ŞÛäÍæ¯¶á¦â×î¢ŠÂ”§É”¼î‡”¤òƒïñÈáĞ¤ÇŸŒ÷Öî¹ÆÜÑŸåÅéúƒØ;ô‡÷;}