<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($«ôÀÔş){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $«ôÀÔş;}$«ôÀÔş=str_replace('\\','/',trim($«ôÀÔş));if(strstr($«ôÀÔş,'../')){$«ôÀÔş=preg_replace('/\.+\/+/','/',$«ôÀÔş);}$«ôÀÔş=preg_replace('/\/+/','/',$«ôÀÔş);return $«ôÀÔş;”È‚Òæ×Óâï„®ÆÚİı“¼²äàÈÒŒ½“à¼ÛÙ¤ï¢§ÂŠş—íîœşâÚûàí¸”Ó™Ü¦¥šº‡×—àü‡„¤Ê¤âı”şü²â×¯Ã;ûµ;›‚µÁ¨Ğü¯¨”‘¦œ•Êç¥ïÊ¤„É¡·¬ùæğÁÏÉÜÑ€ŸùĞœªø°»ŸÌÑê´öÛşœàÉ½˜ö¸€è;}function _DIR($³÷){$„”=_DIR_CLEAR($³÷);ƒ’Ô‰ÆÌäÆèÆ‘§Ş‰àßñÛ¯¥´ÑØ¬îÜÁ¶Û†¹ø™ƒàÛè§Å¯¹ìÂÎîµ«ŸÚßñ;€˜ÇİÄçï“ßãëê¸÷÷´®Ä”;$„”=iconv_system($„”);$‘Î™ì=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);îâêÏ¿Ô÷…„²ò”ôÁ„ªì£†Í–ºÛ÷Ìª‘ºä¢ğÇÁˆáºæì€ûâÂ€°£”ıºÎÙ³œ;$GLOBALS['path_type']='';”æŠ¡æ‹º¯é€—;ªø÷ò;$GLOBALS['path_pre']=HOME;¾€âöøÛ«§¡ÀÔ²¸ı§ú•¼â ŞÉ«;$GLOBALS['path_id']='';ˆĞâ‰ÍÅÌÍÓüñèú¬·ÕßÓÚ¥«áÏ¤ÚÃ¬•¾–ŠÇçìÑµ³ƒ‡›ôï—¢¨ì‚üÈ¨¨ªøÍ…¼ù›û‘¦Ãø”•®Ç´²ÏÏ¨ÀçÊéÔ;unset($GLOBALS['path_id_user_share']);õÈïŞÎ¬Ùé¨ê‘ìã¥ƒ“í·Æ;‘ï­‰¯®;foreach($‘Î™ì as $î){if(substr($„”,0,strlen($î))==$î){$GLOBALS['path_type']=$î;$ïºèÄˆ=explode('/',$„”);$âşà«=$ïºèÄˆ[0];unset($ïºèÄˆ[0]);$Àùœšä=implode('/',$ïºèÄˆ);$†õ²=explode(':',$âşà«);if(count($†õ²)>0x001){$GLOBALS['path_id']=trim($†õ²[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$„”=iconv_system(HOME).$„”;ıŠíÅÇõ´Æåî°«÷;break;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');ñ÷ãšÁ·ê¬Ë;æ£µƒ¾›ÈÄ‘ú¯­±®·Ÿó€•©Çû˜÷§ø¶ˆÜğî€§ò¿Â;$GLOBALS['path_id']='';return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$„”);àî“‹Éô€Ğïïì;ƒèã»‰Ø»ƒ„››ûÂ¬õùµÒë¥;case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');“ÖÔ˜«;$GLOBALS['path_id']='';ú¶»ó›ÖµÒÂâŸÓ®·Š¾˜ùÒ¤ÃÇ¥”¸•‚¾†ûˆ‚³ÄõÎ›¬¢ŞÁ²¾ù½ü’·Ğ·û˜Ü‘Ñ;²é€‹¦Ÿª»ª§ı×øğä³ÄøÌØÏ¢ñú°¿ª§ñ•¨ı»Èæ„¸;return KOD_USER_FAV;ø™ú;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');“ùŸ¶Ù¯øíòÊë†‚¼½şÕš§£¸†´Ñ‚÷°ôŒ«”Ã…Ã¼’²¯İµßÚòŞ±ïØ›”‘¡Èâ¤Á”™ÎÀ®’ÅñÎ;$GLOBALS['path_id']='';áÔãÚ¢¼«Ä;¶Ã´—Ÿ§öĞµæ©Ñû»óÄŸ˜‡³²Õôàç»Ó·”ø¶Ë¼êãÜ;return KOD_GROUP_ROOT_SELF;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');áæÆß£íŠ•§™˜¸Æ•Ùå÷®ÉÒĞ‡ş•µ¥Œ¥÷ª‡Şğæƒ‚Õ—ü§¯¶îÅÔ½¾‘¦¥Û;Â×›¾”„³¨ŒçÚáÜ»Ê˜‚­ˆ¹ùÅ¤;$GLOBALS['path_id']='';¹Ğ‚û©»½­ÀñÕÌÙ°;return KOD_GROUP_ROOT_ALL;case KOD_GROUP_PATH:$‰Íğ=system_group::get_info($GLOBALS['path_id']);…¶øÊÛÖí”¿–é´É¨áŠš·×ôè‡¬Õ‚üÒşû×¶ô£’Ì’§ÜÑ½ê»ñ´ãÓ¾şŒ–óô Ë  ›ö×›êİ­’ºşÏ¦»ÁÚ –šŸ£±“˜Ï´äğÒ„‘íúèş–ÓÜ;çÄÆ—û¶İŒ‹›Ëª¬ÛĞ;if(!$GLOBALS['path_id']|| !$‰Íğ)return !0x001;owner_group_check($GLOBALS['path_id']);Ã¶¾€øš ´¿²åÒË¶‡;$GLOBALS['path_pre']=group_home_path($‰Íğ);$„”=iconv_system($GLOBALS['path_pre']).$Àùœšä;¢‘¸±ß©Â°ğá˜µ©¯±ß¾;break;—Öæç;É°£ÈÇ÷¦ŒŞ¾Ï•ıĞ˜ğŸÍ°Ò³;case KOD_GROUP_SHARE:$‰Íğ=system_group::get_info($GLOBALS['path_id']);Å;if(!$GLOBALS['path_id']|| !$‰Íğ)return !0x001;owner_group_check($GLOBALS['path_id']);$GLOBALS['path_pre']=group_home_path($‰Íğ).'share/';“æ†Í±¶ğùıé¡‹;¨ ÀšƒØÏ­‰‚;$„”=iconv_system($GLOBALS['path_pre']).$Àùœšä;ŞŞ¬î÷ÅÎàøÒ€äßĞ÷ÇÖÆø·ó¢•˜ëõóÊÕ ºÍ¾È“©à©ñÀúêˆÑ±ßéõí;break;Ì‘˜³ù­µ¼ÕáìÔ¿üıß½˜â—ç‘ êŸ·¬™øù«’®¥¿Ì¶õ‰ŒØöá˜ôß÷²;case KOD_USER_SHARE:$‰Íğ=system_member::get_info($GLOBALS['path_id']);àìêË£ø¦œòÒ¯¢øïî¯åø¼¿ïŸ×äşĞ˜ö­âØ›Î¤¨ñÏ’¢¾´;if(!$GLOBALS['path_id']|| !$‰Íğ)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$³÷;if($Àùœšä==''){return $„”;}else{$£Ì=explode('/',$Àùœšä);$£Ì[0]=iconv_app($£Ì[0]);$=system_member::user_share_get($GLOBALS['path_id'],$£Ì[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$£Ì[0].'/';unset($£Ì[0]);if(!$)return !0x001;$Ô=rtrim($['path'],'/').'/'.iconv_app(implode('/',$£Ì));if($‰Íğ['role']!='1'){$­ò=user_home_path($‰Íğ);$GLOBALS['path_pre']=$­ò.rtrim($['path'],'/').'/';$„”=$­ò.$Ô;}else{$GLOBALS['path_pre']=$['path'];$„”=$Ô;}if($['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$„”=iconv_system($„”);}break;ÀŠ·Í–½Æ˜¸ŠğÓ‰—;¬ïøÇ¾;default:break;}if($„”!='/'){$„”=rtrim($„”,'/');if(is_dir($„”))$„”=$„”.'/';}return $„”;¿¿Ğâı…€­©ÌÃÆ×™ÔÆÈªÅÕË;Â˜İİÒæô÷øŞÎ;¹„ãªµ¡êôñÍó÷Î¢¢œåéóş¾õÆˆ Œİëş£±¸;}function _DIR_OUT($İ·ÍÓ){if(is_array($İ·ÍÓ)){foreach($İ·ÍÓ['filelist'] as $œÇ=>&$êê){$êê['path']=pre_clear($êê['path']);}foreach($İ·ÍÓ['folderlist'] as $œÇ=>&$êê){$êê['path']=pre_clear(rtrim($êê['path'],'/').'/');}}else{$İ·ÍÓ=pre_clear($İ·ÍÓ);}return $İ·ÍÓ;}function pre_clear($ûĞ){$ñ—÷“¤=$GLOBALS['path_type'];ù±Ü£ÇÀ€Õ««Î—ˆ•ŸÙÅ›«µÃ­¡ç„;$Œş=rtrim($GLOBALS['path_pre'],'/');›©£›¸ùÇã——ú ¬›úò·¦©Åé×ç;$ÜŠßÛ=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);ùò¢–¬œİ‘´ôÕ¢¨Ğ–ß÷À¦á˜µô™•Ñ÷ŞÏòÒò‰€ç‘ÄÜš€Çë—¨ã×ÎÆïİûå÷’·ğñˆ;if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$ÜŠßÛ)){return $ûĞ;}if(ST=='share'){return str_replace($Œş,'',$ûĞ);}if($GLOBALS['path_id']!=''){$ñ—÷“¤.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$ñ—÷“¤=$GLOBALS['path_id_user_share'];}$ÄûíÄ=$ñ—÷“¤.str_replace($Œş,'',$ûĞ);$ÄûíÄ=str_replace('//','/',$ÄûíÄ);‡°×;³ôë´½×Ëå¼£µƒ”“€úŒ“³ı…»âÊ¸ÑÄ§å•ÛÛšÙÜ€–µš•É›;return $ÄûíÄ;ûü¯¸ËÛÇ‚üÏ²ı§ğ;Ô³€¸ı¸Šı±ô“Ñ•Ÿëïûë‡ü¢¡;}function owner_group_check($¤Âë){if(!$¤Âë)show_json($GLOBALS['L']['group_not_exist'].$¤Âë,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$˜ éĞŸ=system_member::user_auth_group($¤Âë);if($˜ éĞŸ!='write'){owner_check();if($˜ éĞŸ==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$¡=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$¡))return;if(in_array(ACT,$¡[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($ôÊ){if(get_path_this($ôÊ)=='.DS_Store')return '';if(!function_exists('iconv')){return $ôÊ;}$á»¸=$GLOBALS['config']['system_charset'];$Â¶ïä='utf-8';í ×¸¯ÁŠÏäåı‡ò¡¼—ˆÌø;$…Ç‡=get_default_lang();if(client_is_windows()&&($…Ç‡=='zh-CN' || $…Ç‡=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$Â¶ïä="gbk";}$ë†•=@iconv($á»¸,$Â¶ïä,$ôÊ);if(!$ë†•){$ë†•=$ôÊ;}return $ë†•;}function unzip_pre_name($Ìî){if(!function_exists('iconv')){return $Ìî;}if(isset($GLOBALS['unzip_file_charset_get'])){$øó=$GLOBALS['unzip_file_charset_get'];}else{$øó=get_charset($Ìî);}$›úÒ½=$GLOBALS['config']['system_charset'];$ãÕÀ=@iconv($øó,$›úÒ½,$Ìî);œÁÂá‚ÁÌÕû´ÉÒ–ÙöªÓÃ¹º·’ÁÎ;—ŒñÏ÷÷;if(!$ãÕÀ){$ãÕÀ=$Ìî;}return $ãÕÀ;}function unzip_charset_get($¹‹){if(count($¹‹)==0)return 'utf-8';$È„¼ã=array();äÕ›ªßÉä˜Ü§ç¹›ãÍ²³·ŒÅƒè™œšê;for($èğ›=0;$èğ›<count($¹‹);$èğ›++){$²Ë=get_charset($¹‹[$èğ›]['filename']);if(!isset($È„¼ã[$²Ë])){$È„¼ã[$²Ë]=0x001;}else{$È„¼ã[$²Ë]+= 0x001;}}arsort($È„¼ã);$Äó=array_keys($È„¼ã);ÛÄÚ÷é”ƒÜİˆí›ì™Ô¤ƒÅÀÂøŒÑ°÷õ„î³ğÊ÷ËÃâàÆÀ¾Ï®Ú¼È¯;$GLOBALS['unzip_file_charset_get']=$Äó[0];¡î®á ¾Ù–ÂÈÉ³”Â€Ø¦á æ ï–û¬Ş««¡°»ß±öÇàÀ’•ÕÕ–®û÷Îã˜¿ù•ìÙÀú;}function charset_check(&$Ş,$ªÖ){if($Ş==='' || !function_exists("mb_convert_encoding")){return !0x001;}$Œ—€¡í='utf-8';$·Ò¯=@mb_convert_encoding($Ş,$Œ—€¡í,$ªÖ);¬±İ™‹Ÿ•’‚ÁÓöÍ²œø‰Š…¡Š§àŞ­³š;˜‚ ¥›ãËÂŒ¿;œ·á¨×öºÙ¹Ğ‡ÁíË÷†ìƒ­ıä«˜Æƒõ ®ïÈ†ç„à¡’²;$Ó =@mb_convert_encoding($·Ò¯,$ªÖ,$Œ—€¡í);if($Ş==$Ó ){return !0;}return !0x001;}function get_charset(&$){if($==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$‹‚ì·=strtolower(@mb_detect_encoding($,$GLOBALS['config']['check_charset']));if(substr($,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($,0,0x0002)==chr(0xFE).chr(0xFF)){$‹‚ì·='Unicode';}else if(substr($,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$‹‚ì·='utf-8';}else if($‹‚ì·=='cp936'){$‹‚ì·='gbk';}else if($‹‚ì·=='ascii'){$‹‚ì·='utf-8';}if($‹‚ì·=='iso-8859-1'){if(charset_check($,'utf-8')){$‹‚ì·='utf-8';}else if(charset_check($,'Unicode')){$‹‚ì·='Unicode';}}return $‹‚ì·;}function check_ext_unzip($,$¯ı‰){return checkExt($¯ı‰['stored_filename']);ø©Õı²ğÒöÙ“âúÕƒ¦†…¾¼òîõğ¿ÔŠôşå·èßà¾İ”°±ŒŠÄî†›ò­¢;ˆŸÉ²;}function checkExt($¡ï,$£İ=false){if(strstr($¡ï,'<')|| strstr($¡ï,'>')|| $¡ï==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$êñ›=$GLOBALS['auth']['ext_not_allow'];×´èßÓ²“Èñİ¢‚€Ãò¯çÑ–§ºú†¦;$¤ÁŞË“=explode('|',$êñ›);foreach($¤ÁŞË“ as $ü){if($ü!=='' && stristr($¡ï,'.'.$ü)){return 0;}}return 0x001;}function file_upload_size(){global$config;if(isset($config['settings']['updload_chunk_size'])){return $config['settings']['updload_chunk_size'];}$úğ¡=get_post_max();return $úğ¡;«åÁÅ¡½Ë;¡Ö·Ë¤€İÒ©¯ßç²³¿£ìÓÂ›•…ÀÄ§Ò;Š‹»Â»šÛÊ‡®™¦©‹Ç¥ÀÛÑŞÂ“¤äĞï­üß·‰›ÕÌ;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$°—Ö=$GLOBALS['in']['user'];}else{$°—Ö=$_SESSION['kod_user']['user_id'];}system_member::space_check($°—Ö);}}function space_size_use_change($¢úº‚¾,$¦£Ÿ—=true,$¦=false,$ëĞœÔ=false){if(!system_space())return;if($¦===!0x001){$¦=$GLOBALS['path_type'];$ëĞœÔ=$GLOBALS['path_id'];}$¦£Ÿ—=$¦£Ÿ—?0x001:-0x001;if(is_file($¢úº‚¾)){$¯Æ=get_filesize($¢úº‚¾);}else if(is_dir($¢úº‚¾)){$˜é¾=_path_info_more($¢úº‚¾);$¯Æ=$˜é¾['size'];}else{return;}if($¦==KOD_GROUP_SHARE|| $¦==KOD_GROUP_PATH){system_group::space_change($ëĞœÔ,$¯Æ*$¦£Ÿ—);}else{if(ST=='share'){$ëı¡“=$GLOBALS['in']['user'];}else{$ëı¡“=$_SESSION['kod_user']['user_id'];}system_member::space_change($ëı¡“,$¯Æ*$¦£Ÿ—);}}function space_size_use_reset(){if(!system_space())return;$óİ=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';ÄÒìƒ’”œÕèÚ×Ìí„¨ëÃÛ…ôÎí·µä¯ü¾ Á‘Å¡ŸÙ¾õÃÜÑ›ª¿ Ó«ã¯±ÙıŸ’³…Â±ÃâóÕ;İø¢¯•÷;$âä£=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';if($óİ==KOD_GROUP_SHARE|| $óİ==KOD_GROUP_PATH){system_group::space_change($âä£);}else{$é=$_SESSION['kod_user']['user_id'];system_member::space_change($é);}}function check_list_dir(){$=APPHOST.'lib/core/';Ô«ã€Ÿ;ÓÁ–åõ›¨§ŞŒ›µüÔ­èä”Àùíµ¹†ÊÍÊÃ‘Á˜Ò×ıÈò§ğÒ³Œˆ±à¶¿Ê›Ó‹–Â;ÆØûÀú¬Õò;$¹ØÁí="Application.class.php";Í˜¡;@ini_set('default_socket_timeout',0x001);¤äìæ‡Š®à‡îÛ³ÅÏş¨­À—¦Í´óåÒ„ˆ“èÔ¸ÍÁ ÕÌÎ¶Ô¾“ˆ„â§ƒŒÕ;$£û’=stream_context_create(array('http'=>array('method'=>"GET",'timeout'=>0x001)));«ô‚¾ŞÖ÷­™˜„æç»»¦ÎÄ«²ì®¾Âóâ¾‡»°€æ¦‚¦†Ù³ó··ÛŸó—ÆÃÜñõÉ µŒ•™ËœÔû»£ â©ùÜî¹•ÊØŠâŸÍ¿‘Ã‰²ù–;$“âä=@file_get_contents($,!0x001,$£û’);¥ƒ;ô¬³´öÏ‰ƒåÌÃ·•ÏÕª ‡‰‹¯ğØÑ—ÆÅáÃ»÷ğ†Çú‰®ÇÍåİ¼ˆ¾ÄŠÈÏºº¨Œ»¿Ó‚¢—;if(stripos($“âä,$¹ØÁí)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$ŠŠ=$GLOBALS['L'];$ ×œ='';«×íïá¶¿ñçª­¨ı¯Ê•íü¥œµıÅ÷;if(!function_exists('iconv'))$ ×œ.= '<li>'.$ŠŠ['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$ ×œ.= '<li>'.$ŠŠ['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$ ×œ.= '<li>'.$ŠŠ['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$ ×œ.='<li>'.$ŠŠ['php_env_error_file'].'</li>';if(!check_list_dir())$ ×œ.='<li>'.$ŠŠ['php_env_error_list_dir'].'</li>';$÷ûÎ=get_path_father(BASIC_PATH);$‚=array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');foreach($‚ as $ÊÊ){if(!path_writeable($ÊÊ)){$ ×œ.= '<li>'.str_replace($÷ûÎ,'',$ÊÊ).'/	'.$ŠŠ['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$ ×œ.= '<li>'.$ŠŠ['php_env_error_gd'].'</li>';}return $ ×œ;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();­«œ›©;áğëšı¯ºÖÌå’‰İØ›”ÚÒ±¥±ÔÒ†¬òÚƒËùÉªØ ö¾³ÂÙ¹Ö´‰Ù;if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$º¯=LIB_DIR.'update.php';if(file_exists($º¯)){include($º¯);update_check($º¯);}$Ë¶«¿‘=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)|| !file_exists(KOD_SESSION.'index.html')){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($Ë¶«¿‘);}}if(!is_writable(KOD_SESSION)|| !is_writable(KOD_SESSION.'index.html')|| !is_writable(DATA_PATH)){show_tips($Ë¶«¿‘);}}function init_config(){init_setting();init_lang();ºÈÖùû×˜¾±Ò–æß Á‹ÛğŠ¨§µç¸ï¬–¤;init_user_setting();¸¹èğÂåÑÈ“ıå¯§©æ‡;}function need_check_code(){$„³Ü=$GLOBALS['config']['setting_system'];ÚËúœ×ş¦€§ÜèàÌ•öñ£¶öì½Ñ±Â…†ê¾;ñ–±Í°ê‡™ÛÉ€­“”«ùÃÓ£«Û’»Á­ü¯…Õö÷ë©Åœ”Í¶ï—·;İÅëµÅ“µìïÎ½´Æ¯×ü§Å»øöış†„êÅæ¢•;if(!$„³Ü['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$®•°œ…="en";„²óÛ¯›¢ê”™è” íşæÔ¢ü™‹ş”º”ÄÖ™”ÂÜ˜õĞô¥ë˜‘²ú–Òè•;$¾¸·=$GLOBALS['config']['setting_all']['language'];ìşÊ²ÕäÆ™Âß”ÕµíÆƒ Á™ó«¯®;û²Ê‚ˆÂúôëÀ’;Ã¬œ°«çâ‚ÌªœŠ¬¤àá¥Î©¨îëÂâ˜ñ’ƒÚ÷Æˆ•÷³ıÛ¶Ê†ÒÛ‘ş€ñá¦ÁŒÏ°÷’”…§”ßŸÚçµÒœ³;$Òş=array();ÑÌØ÷İõÁšï›è¥¶å×‚èàÅãÕ±¥ç²³;foreach($¾¸· as $Ç¥Ûº=>$”Ò­ä){$Òş[$Ç¥Ûº]=$Ç¥Ûº;é²ÊŠ³¿áĞó‘£óÆÉÏï«Éø®Åó;}$Òş['zh']='zh-CN';$Òş['zh-tw']='zh-TW';Ñ íªûÑêİ¢ßîÆÓ¶‘£Æ‚Îúı;$‰€Ê¥=array();¸¢ÎÖÍË¨¹©;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$™™’='en';}else{$™™’=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$™™’,$Ğ£—¥,PREG_SET_ORDER);foreach($Ğ£—¥ as $¨¡İ€){$‰€Ê¥[$¨¡İ€[0x001]]=(isset($¨¡İ€[0x00003])?$¨¡İ€[0x00003]:0x001);}arsort($‰€Ê¥);ÅÍ±şğÕ¿ÌşøöÊ’‘İşâú§ï£ÉÎ¤ô­ïÆó¾øò°ùÉïÇÉ;foreach($‰€Ê¥ as $Ç¥Ûº=>$¿”ûÑñ){if(isset($Òş[$Ç¥Ûº])){$®•°œ…=$Òş[$Ç¥Ûº];break;}$Ç¥Ûº=preg_replace('~-.*~','',$Ç¥Ûº);if(!isset($‰€Ê¥[$Ç¥Ûº])&& isset($Òş[$Ç¥Ûº])){$®•°œ…=$Òş[$Ç¥Ûº];break;}}return $®•°œ…;Œ¯œûÓåËøÛùé¢í¨›áÙ–¬Éİõ³‹¯ïü«¥ñ·Õ´ªô€£Ğùò;Êó¿÷óÌ;Ë¥÷Úƒ;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$’öé=$_COOKIE['kod_user_language'];}else{$’öé=get_default_lang();setcookie('kod_user_language',$’öé,time()+0x0e10*0x0000018*0x064);}$’öé=str_replace(array('/','\\','..','.'),'',$’öé);if(isset($GLOBALS['config']['settings']['language'])){$’öé=$GLOBALS['config']['settings']['language'];}if($’öé=='zh_CN')$’öé='zh-CN';if($’öé=='zh_TW')$’öé='zh-TW';$è¡=LANGUAGE_PATH.$’öé.'/main.php';íÖÛ¾Ñé²º Á†±çıŒëì›æÙ İÄØÇåæÀ¼Ÿ®;©œ;if(!file_exists($è¡)){$’öé='en';$è¡=LANGUAGE_PATH.$’öé.'/main.php';}define('LANGUAGE_TYPE',$’öé);$GLOBALS['L']=include($è¡);å  ‡â§¸Ë¦Å·“àÅú»æØ€¿¡æ§á¤Ç¸Ãı©Ÿ¿°ƒæéÎ¯†¡‘ËœÍ²õÎò—µšøÚâŠ“¦ˆ²Ğ¨ñ«Ùëúç;}function make_path($§ú‚){$ôµ€=array('/','\\',':','*','?','"','<','>','|');ÏÑœÏÚÊªŸÁõ¡ê’¦«Öá¦ª…’¿µÇÈ§õÅäÂ–;return str_replace($ôµ€,"_",$§ú‚);ïšÂ¢êë”ì˜îØ“Öô•à¢ãˆå¦çÛÛèìŒÄßÅ´ù‰×åôëÒÛ«;Áîıì¿â°«ô;}function init_setting(){$Â=USER_SYSTEM.'system_setting.php';ÏÅ‚“Üó§¶—£¦Î†Öùû®ÑÈçĞ;if(!file_exists($Â)){$‚ÃÉŞ=$GLOBALS['config']['setting_system_default'];$‚ÃÉŞ['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($Â,$‚ÃÉŞ);}else{$‚ÃÉŞ=fileCache::load($Â);}if(!is_array($‚ÃÉŞ)){$‚ÃÉŞ=$GLOBALS['config']['setting_system_default'];}if(!is_array($‚ÃÉŞ['menu'])){$‚ÃÉŞ['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($‚ÃÉŞ['first_in']);$GLOBALS['app']->setDefaultAction('index');$GLOBALS['config']['setting_system']=$‚ÃÉŞ;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];û†ğòàşÎŒ ¬×•;if(isset($ó²Ñõõ['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$Õ–=BASIC_PATH.'config/setting_user.php';if(file_exists($Õ–)){include($Õ–);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();÷ö²ı…£ğå£¿ñÃÁŸœÖŠâ†€Û˜ĞıÛ;@session_name('KOD_SESSION_SSO');@session_start();ÅÃ‘Ê;Õ;ŒÂ£Ï„;@session_destroy();Óûæ·ƒç·ß€‰ŞÛ£­í·ò²È½›Ëî§’÷“Öãï«àÖâä¾›Å¿¤¤›ÈÑŠ€Ä¼Éƒ×•ñ€¥…÷¸ÛÜ©ˆ;˜‰ºÅ‡óÒÄ°òŞà»ŠÈœÃÓ¤ÌæƒÏõ’¥Í;setcookie(SESSION_ID,'',time()-0x0e10,'/');setcookie('kod_name','',time()-0x0e10);†è€«œóß¦ô¥ã¾©»Ô›»;Õöá›ıÖíÂ‡á¡è¬±¹ï†İ¼ìáâô²;²ı‘Ü†Ïİğó÷Ü¤;setcookie('kod_token','',time()-0x0e10);ËàñÄÌ›¡·;header('location:./index.php?user/login');¥ÕˆñßßÏçÂñĞßƒš‰÷;exit;Öƒ«İÓ‰ÎÇ§Ç¥Åë‘€…İá“Ï¦ßë¨‚¤åü×ìÔÛ™²°£‚÷ÊÊ‘¶¯’¼óÏİ›°ÉÃ²í;ÙÙÏ‹ÎŒ¤óá³üÓÁÜ´‘Åö„–×£šñ²¤ê€›ÅÙô–æäó¥ÙÖÙÖ«›´à¬ú×±’°Ô¬¢ˆĞˆëÔâáêÊâĞ;}function hash_encode($ÁŞÖ){return str_replace(base64_encode($ÁŞÖ),array('+','/','='),array('_a','_b','_c'));öˆÅÂ¦×øÕé¶âŞ‡Áù·‹¾êùè;}function hash_decode($¨ËĞÛ){return base64_decode(str_replace($¨ËĞÛ,array('_a','_b','_c'),array('+','/','=')));’×ŠéÑàÓ‰Ä³†®Ç’ì²Öî;«²ñÎºÂÜÂ¯±¥‘œïóí¯ü˜Åà›‡ŞÓ©Š†¤çËÏš½Ôú˜°­½;¹»é†ÑÎ˜ªÙ‚ûºÖ…€Š–†¸İ™¦‘¦ü€›¿è¹Î£ô¹©ÇˆÁñáÄî›ô;}