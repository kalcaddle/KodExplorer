<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($‚ò¶ßü){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $‚ò¶ßü;}$‚ò¶ßü=str_replace('\\','/',trim($‚ò¶ßü));if(strstr($‚ò¶ßü,'../')){$‚ò¶ßü=preg_replace('/\.+\/+/','/',$‚ò¶ßü);}$‚ò¶ßü=preg_replace('/\/+/','/',$‚ò¶ßü);return $‚ò¶ßü;»•Íğí¢¥;}function _DIR($Ê){$”•‹ˆî=_DIR_CLEAR($Ê);Ûê¼èÜæû˜ûÊŠêí°òÒü½ãœËË±á×¹Ğ±²«»Ê‡˜±„±®Ï¼š½ì‘éËô‡—Á¸ùšñËË¤öÙÂ²¤Ê;ÂÄÁÊ Îœ…”¹°¾¿ğé³‘Š’£¯˜œî;ü†º¡Ü§®í’úã™“¦ÑÀÄØŒéĞå¬„‹÷ÏâÆÍèåˆŠÃ¯¹±Â´–ÛÇ;$”•‹ˆî=iconv_system($”•‹ˆî);$Õü=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);Ü€ïŠ;¶¯­‚ĞüÕ‘Ø‡Ğ™÷»Ì‰ÆÎœéı´‡íå¬Ù‰™‘¹Æ”ŠÄ²ßÖŒç§¥ßãòéªÁ‡”À¼›®£ºÛüÃôı¼£ˆÖè×âĞ;$GLOBALS['path_type']='';İÉ£Ç°«ÒôÛ;$GLOBALS['path_pre']=HOME;$GLOBALS['path_id']='';unset($GLOBALS['path_id_user_share']);½£¤şàÀ®„úŠ‚¿€‘½¼µÅ¾Œ®;Šùªßöúñ†•í‰êÌÓ”…ºçù—ó¡¶¶ß²ÀÙÜ¡Ñú±ÓöÂÅıØ´ˆÃÛÒ–á;foreach($Õü as $ı){if(substr($”•‹ˆî,0,strlen($ı))==$ı){$GLOBALS['path_type']=$ı;$¥òşÜ=explode('/',$”•‹ˆî);$Ş=$¥òşÜ[0];unset($¥òşÜ[0]);$¹ìŒè=implode('/',$¥òşÜ);$ßßƒ=explode(':',$Ş);if(count($ßßƒ)>0x001){$GLOBALS['path_id']=trim($ßßƒ[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$”•‹ˆî=iconv_system(HOME).$”•‹ˆî;êëç¨¡­æ®ÜıÜ”—Œİš¿ĞÈñ¤¸;æ ÜÃòò¥ğƒ§ä‚„á”ùœˆ¨éÇ‰ÊÊ¯©§Œ‘ÇèÔ»Üú½Îıå³éÂãş¼€€Ä¨ê;break;¾ÖÍªÂµÓäâº”À¸²ÍÊ­İ×Œø˜ÜÂ‹‚ú;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');ÔìÈ˜¢ı†Ø’Æ’Åäß“¾è ·ıù;íñÉ×Æ…´ÂÃƒÁ©¶Â”ø§“¶§”ûÏşŠ‚¶âä—ãÒ‰­«Ğ³ß“öãÔ¡š˜µ”¿ÈËæÜÇ·ÜÑ¹“µŸ;$GLOBALS['path_id']='';return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$”•‹ˆî);case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');†ûı™óâî•ı‡Ê’Æ”Ş®ñ§åÏù ã¯À;•ŠÔ‚Óì¤ğê«ÉıñÛÃ×¼Ôêú¾‹³¿Š®ÌŠ¤¹‰ºÃİ¼—Ëá‰·Òµ€¯ù×ëÎÃçÏœÍÙÊ›ãïÔíª™Ìç°˜ÊºÏØ†Ù½€±ªÏô“İÄ¯¬;’ÑÊĞä‚³Ó˜±ÚâÄ¢÷£ÑêË¸ºÅÙŸ;$GLOBALS['path_id']='';¿ÍòÑ ¾àğ£ã¥;return KOD_USER_FAV;Òßõ×ÀÇÃŒ€şÒÚÇôÌˆÃÀÚãş»Õ¢ ûšœÓìûğãÔ²«˜¿¬—’‡¶ÚüƒâÀÃ¾¥Ãúúå›÷·Ëî´½ÒŠğ;ë;«»Ã²ñŸ°ôƒğ¹Á—ü;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');½€èÖÊ£§¤±­ıï;$GLOBALS['path_id']='';å‘×ÔÅ•§;return KOD_GROUP_ROOT_SELF;ó¸Ñ¯ü;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');$GLOBALS['path_id']='';ÜêŞŠŠÙÒÅñ€İ©¾;return KOD_GROUP_ROOT_ALL;¨·½Í;case KOD_GROUP_PATH:$¦Ñ=system_group::get_info($GLOBALS['path_id']);ŸĞ´÷Ûš‰³îÏÉ—¡Ñ½•ŠÅ‡“ç¤ÈşÄïÑ¦­¡ÅşÖ;£ô‚ş™ÜÒ;if(!$GLOBALS['path_id']|| !$¦Ñ)return !0x001;owner_group_check($GLOBALS['path_id']);à™Ù÷º«µĞ¶Ä–¾Øıâ¢ı§’ÏÎÀñ•¿ÈÓ›¹«›¶†“ñ±ÉÂèØ§ç×‹ŠÕ³œ¦;$GLOBALS['path_pre']=group_home_path($¦Ñ);$”•‹ˆî=iconv_system($GLOBALS['path_pre']).$¹ìŒè;àì¸›Š;î;éË³œ•õ†¤Î­Œ¦¹–üì³£ï¼‰­õæ;break;ıˆ;case KOD_GROUP_SHARE:$¦Ñ=system_group::get_info($GLOBALS['path_id']);¶½öÒÒìÙ÷¼‡„ãÁ›à®Î…ŸßÁ¨ßŸôš Áã÷ÊÚËÇ¥—…­›èî·Ê†;if(!$GLOBALS['path_id']|| !$¦Ñ)return !0x001;owner_group_check($GLOBALS['path_id']);“æôò‡ê§¬›Œ¤ææï†¯•´Ã¹²ğéĞ÷ºŞÍöÓÁı¿Ğ¦ëì³‘Ô;$GLOBALS['path_pre']=group_home_path($¦Ñ).'share/';¢ıÀŸóÙÂ—ÎÑšÎ;$”•‹ˆî=iconv_system($GLOBALS['path_pre']).$¹ìŒè;ø€Û²¤‰ßœÄïú;”›æ½œÖ¦ûÙ¥…”àÛ¸ˆş·É«£áÃò´;break;æ¦û“ÁçÜÃ§©½§†ïÆ•”Ğõ±•å¬¨ÎüıµŒ¤Ä‰¸†˜¡ã©å‹Ò;ÕäµğÌó£›ŠüÀ‘¢;case KOD_USER_SHARE:$¦Ñ=system_member::get_info($GLOBALS['path_id']);ê‚ô‰­™ëñŒ¡ÏÎÂ¥´ø—í¥¤‰;î¨ËäÙàË‡Šš„ˆĞ‘­•›æ›³‰€Üî;if(!$GLOBALS['path_id']|| !$¦Ñ)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$Ê;if($¹ìŒè==''){return $”•‹ˆî;}else{$’¿=explode('/',$¹ìŒè);$’¿[0]=iconv_app($’¿[0]);$¦=system_member::user_share_get($GLOBALS['path_id'],$’¿[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$’¿[0].'/';unset($’¿[0]);if(!$¦)return !0x001;$øÏ‡=rtrim($¦['path'],'/').'/'.iconv_app(implode('/',$’¿));©±òÄ¶û•È©ªä‘Æ˜šÆõ‰Ò§›’±ÂÍª’Ô‰¼½³î;if($¦Ñ['role']!='1'){$÷¥=user_home_path($¦Ñ);$GLOBALS['path_pre']=$÷¥.rtrim($¦['path'],'/').'/';$”•‹ˆî=$÷¥.$øÏ‡;}else{$GLOBALS['path_pre']=$¦['path'];$”•‹ˆî=$øÏ‡;}if($¦['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$”•‹ˆî=iconv_system($”•‹ˆî);}break;default:break;}if($”•‹ˆî!='/'){$”•‹ˆî=rtrim($”•‹ˆî,'/');if(is_dir($”•‹ˆî))$”•‹ˆî=$”•‹ˆî.'/';}return $”•‹ˆî;ÓçşìƒÅâŒ™Š¨«¼ëùçıÎğº¥©½Ïêª¾Ââ“;}function _DIR_OUT($©ã){if(is_array($©ã)){foreach($©ã['filelist'] as $Âíä=>&$«Ğè“Î){$«Ğè“Î['path']=pre_clear($«Ğè“Î['path']);}foreach($©ã['folderlist'] as $Âíä=>&$«Ğè“Î){$«Ğè“Î['path']=pre_clear(rtrim($«Ğè“Î['path'],'/').'/');}}else{$©ã=pre_clear($©ã);}return $©ã;}function pre_clear($ª´„){$„îò=$GLOBALS['path_type'];ÖÜºÖŒãºÇ¦©¬•ÕüıèÌ·îÖü™‹áğÕÓ£­;$ç=rtrim($GLOBALS['path_pre'],'/');Ôá¿¼œ˜‘ûú•ü¨Ù²ÃÉåøĞš½÷ıª¬ƒÍù;$½Õòç=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);ï¸ëíàÅ ¥†Ÿà¡ÜØ ˆ…¤Õ•Ëú¦¤Ÿë™ÜÂŠ•®÷ö;if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$½Õòç)){return $ª´„;}if(ST=='share'){return str_replace($ç,'',$ª´„);}if($GLOBALS['path_id']!=''){$„îò.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$„îò=$GLOBALS['path_id_user_share'];}$€ˆ§=$„îò.str_replace($ç,'',$ª´„);$€ˆ§=str_replace('//','/',$€ˆ§);¤¼°¯¾“¿°é”;¾á¢Ä‡÷Ú¥ÄÕÌè;Ö€ÂäÌºÀè½Ê§¾Ò;return $€ˆ§;å°Ï;Òû;}function owner_group_check($”µ•){if(!$”µ•)show_json($GLOBALS['L']['group_not_exist'].$”µ•,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$õì=system_member::user_auth_group($”µ•);if($õì!='write'){owner_check();if($õì==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$¹»£Ë=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$¹»£Ë))return;if(in_array(ACT,$¹»£Ë[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($—ë){if(get_path_this($—ë)=='.DS_Store')return '';if(!function_exists('iconv')){return $—ë;}$Ç=$GLOBALS['config']['system_charset'];$—©Ë='utf-8';Ö‚¢„÷±;;$«êïç=get_default_lang();çßËÒğ“ÎŸÉåÁÓøïÆ·£š•ôë˜†ø¦˜Û€¶çíƒ»ß„Ï¯¤š•åíÕ´ÆøÎÜîºôô´œœ›Ç…ŠÊÁê;if(client_is_windows()&&($«êïç=='zh-CN' || $«êïç=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$—©Ë="gbk";}return iconv($Ç,$—©Ë,$—ë);}function unzip_pre_name($Ü´ô¥ğ){if(!function_exists('iconv')){return $Ü´ô¥ğ;}if(isset($GLOBALS['unzip_file_charset_get'])){$Ï=$GLOBALS['unzip_file_charset_get'];}else{$Ï=get_charset($Ü´ô¥ğ);}$Ï›Ê=$GLOBALS['config']['system_charset'];return iconv($Ï,$Ï›Ê,$Ü´ô¥ğ);}function unzip_charset_get($–ı){if(count($–ı)==0)return 'utf-8';$ÇßŠ³=array();ŒàÑ©’¯Ş‡ÕÏ•¥äÁØßÆ¹öÄ—¿¥¡óõ”·‚ôÔÔŸæ…ıîÚÎ„ÜéÃµ;for($¤û°›Á=0;$¤û°›Á<count($–ı);$¤û°›Á++){$Ûçé=get_charset($–ı[$¤û°›Á]['filename']);‡àóÛµ“Ã»’²—à·˜½¡Üó˜ğÉ³’ø›ûÈøúÏÙî¬‚ğÌ”£ãõÛü´üÙ¨•ÛšŞøÍñòèí»áèŒ¼Ø¹ÍÚª›ïÎşæªû›;if(!isset($ÇßŠ³[$Ûçé])){$ÇßŠ³[$Ûçé]=0x001;}else{$ÇßŠ³[$Ûçé]+= 0x001;}}arsort($ÇßŠ³);$Ã½³Ş=array_keys($ÇßŠ³);Óˆôğ§ˆª¡îÁûÂçæ¸€ß‰²™Š´ÙµÔşùÎüÎ×ñÀ€ùêœÙĞ˜÷”ŞÌ¿Ö´Ùàé´—¾³’°àæ£¡æõºçÆÒßÚÔ¿¨Õş€‹Øáôø³Á‹Âñì©;$GLOBALS['unzip_file_charset_get']=$Ã½³Ş[0];}function get_charset(&$÷çèµ){if($÷çèµ==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$¢„œ=strtolower(@mb_detect_encoding($÷çèµ,$GLOBALS['config']['check_charset']));if(substr($÷çèµ,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($÷çèµ,0,0x0002)==chr(0xFE).chr(0xFF)){$¢„œ='Unicode';}else if(substr($÷çèµ,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$¢„œ='utf-8';}else if($¢„œ=='cp936'){$¢„œ='gbk';}if($¢„œ=='iso-8859-1')$¢„œ='Unicode';if($¢„œ=='ascii')$¢„œ='utf-8';return $¢„œ;œóÆ;˜¥Óî¥ÓùşµîŒ¯£Î»æÁ¨×·¢Ô©ıÚø;}function check_ext_unzip($Ó¬¦²É,$ŞØóô){return checkExt($ŞØóô['stored_filename']);¿¹£€Ü§œ©Æ©Æå‚¬ûô©œ³óğ’Íä‡¥¶ôäğ˜äÍÀ‚÷‡«¾íÉÌïöÉä÷ò‚«çò¾µØ;}function checkExt($¿Ô,$Î–=false){if(strstr($¿Ô,'<')|| strstr($¿Ô,'>')|| $¿Ô==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$Ó†=$GLOBALS['auth']['ext_not_allow'];$Òû=explode('|',$Ó†);foreach($Òû as $á){if($á!=='' && stristr($¿Ô,'.'.$á)){return 0;}}return 0x001;É¼¡Šä¸ÛåˆÏó­í¬…Ğì¿ú”ñğÆğ¬…ò;×ø®°¿‰ÀûÉÁÑîç—×†êŞ’‰²Ïğ¬àÕæÙ­àˆŞ ‘ŸÛàîÊñ×áÉİÍ;}function file_upload_size(){global$config;õ;ÍãŠ×·Ùã’ªÑÒ¦åÅ˜­¶Å²ªâĞÊ¦™¼¤›‹ˆ¥©àÜ·»ÁÉå”œùá¥¨™êÚÃÎé•™®ÕµÊá¾ïŒ ÍÃÛÂ¤ªÏŸŒõÇ¦á£é°şÊ;if(isset($GLOBALS['config']['settings']['update_chunk_size'])){return $GLOBALS['config']['settings']['update_chunk_size'];}$£ŒÈ‹å=get_post_max();return $£ŒÈ‹å;Õ€õªÜÖš§ÈñŠ“Ğ×¼Á¯˜Â¦ÄµÉĞşÔ·õÁ¦ÌÎ¦Âø„™”«â‡¶ö×´š¿Íİå’“¯â’…š‰ÆÀÕ•ç™ì²£˜–«Ï;é;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$û=$GLOBALS['in']['user'];}else{$û=$_SESSION['kod_user']['user_id'];}system_member::space_check($û);}}function space_size_use_change($¡¬,$ƒ–Ëœ=true,$ÊÑæõ=false,$·˜ Ç=false){if(!system_space())return;if($ÊÑæõ===!0x001){$ÊÑæõ=$GLOBALS['path_type'];$·˜ Ç=$GLOBALS['path_id'];}$ƒ–Ëœ=$ƒ–Ëœ?0x001:-0x001;if(is_file($¡¬)){$•‘õ=get_filesize($¡¬);}else if(is_dir($¡¬)){$­¿—Ó÷=_path_info_more($¡¬);$•‘õ=$­¿—Ó÷['size'];}else{return;}if($ÊÑæõ==KOD_GROUP_SHARE|| $ÊÑæõ==KOD_GROUP_PATH){system_group::space_change($·˜ Ç,$•‘õ*$ƒ–Ëœ);}else{if(ST=='share'){$ŸÉÍ•ë=$GLOBALS['in']['user'];}else{$ŸÉÍ•ë=$_SESSION['kod_user']['user_id'];}system_member::space_change($ŸÉÍ•ë,$•‘õ*$ƒ–Ëœ);}}function space_size_use_reset(){if(!system_space())return;$¨Á½µ=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';Ê²·‰ßö€áÅ;­¦¯¤½£;$êã=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';if($¨Á½µ==KOD_GROUP_SHARE|| $¨Á½µ==KOD_GROUP_PATH){system_group::space_change($êã);}else{$ÜŞ=$_SESSION['kod_user']['user_id'];system_member::space_change($ÜŞ);}}function check_list_dir(){$”®…‚©=APPHOST.'lib/core/';Ó—á†÷²Ù«éâŒàâí§¤³”ç»¿¦Ãû¬¥À¦‹”¾í›ÍåÍ§’¸Š™íŒÁ’ÀÑ§©çÏÑãüö¥¤ƒºâğÖ°Ö¤×èÜâˆöĞ”;$ëÆ˜Ğ×="Application.class.php";$ıä¢¼‰=@file_get_contents($”®…‚©);÷çË–Çò‚¼ˆ±ÂŠÚğœÇÜâß­»–¬ºûÏö†‘ŸóŠˆ;ğå¸ÔÖ†®´Ş˜’Á Š“´Ãö‹ÏƒŠèöÙÓÏ¦·Í˜‡ìô—ò£ÌÒ»Ş”Ûè§‘­Ÿü¢§åšºê¨ò¸Á‘À®†×¢ª¤ôæ„ŠÃí±Õ;³£»ÔÏÆ°Àâ÷ÆØË‚ïø½ëÈ;if(stripos($ıä¢¼‰,$ëÆ˜Ğ×)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$æäÜ¦=$GLOBALS['L'];$Úª='';if(!function_exists('iconv'))$Úª.= '<li>'.$æäÜ¦['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$Úª.= '<li>'.$æäÜ¦['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$Úª.= '<li>'.$æäÜ¦['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$Úª.='<li>'.$æäÜ¦['php_env_error_file'].'</li>';if(!check_list_dir())$Úª.='<li>'.$æäÜ¦['php_env_error_list_dir'].'</li>';$€=get_path_father(BASIC_PATH);ÌØññÎÙõØä‹òÜæšÑ›à×Úã‡ë;Á©è‰ƒµ‹ò®ÉŞöıÑÑÒ¸·¯ß¾Üºè—Òè;$±š=array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');ÖûÇŒˆº»Ñ™³Ğë†¤¤½Ô„û±¿åÉ’ÎêÃèØ·­¯´ô¼¼°÷Ê¬à¶²…ÚïÙßì;ÃËÜ;foreach($±š as $ÒÕ){if(!path_writeable($ÒÕ)){$Úª.= '<li>'.str_replace($€,'',$ÒÕ).'/	'.$æäÜ¦['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$Úª.= '<li>'.$æäÜ¦['php_env_error_gd'].'</li>';}return $Úª;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();¬ºÉá;if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$‡=LIB_DIR.'update.php';if(file_exists($‡)){include($‡);update_check($‡);}$ş®««=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($ş®««);}}if(!is_writable(KOD_SESSION)|| !is_writable(DATA_PATH)){show_tips($ş®««);}}function init_config(){init_setting();û¼Ñî²”ä¿®’ùøóª;‚å“Å²ï×ë ˆÚÁ—°ıöˆÖ¸ı†ÕÙ¾‚ ½²‹Îµğáû£;init_lang();½…™àœÉŞ“ÑµÌĞ¼¢«ú¤Ì¹××ˆÉé‰í¼‡éú¥î•†‹ŞåŸ±›ëƒØ®Ô³úŒÒ—™œ‚£Š¿ªô»ĞãĞÖî°¼áØúå±‹”‡¾–Ëã®å€°‰‹ğ´€­…ä;init_user_setting();¯™ã‘ñß÷¤ê«ªÂõğÛ‚¡å“šÀ ó¿üÈî–­‰ø®ø†Ú£¤š¦õ¨;Ğš‹åØÚÕö—Ñ´¨¤£Û¸ˆ›;}function need_check_code(){$¡Ëâã=$GLOBALS['config']['setting_system'];if(!$¡Ëâã['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$øõ="en";Â¥¶çÉ’¡Ò­‰;$Ãêü„Í=$GLOBALS['config']['setting_all']['language'];$±ƒÔÀ=array();ëïªœËááÃ©æÛå¬ğêáœ˜ÒßÇ¶šıõøÙÒòÛ¿â†Ü¯è¾ò“¦ÎøÓ¿ãµÜ‚Í¯á–æü”İõî°èÊğÌĞÍûºŒîÍ²;íÑÄŞßˆ…–ïÎ©’¡Ö›š‡Õ¬î‡¯ÄÈçº¥»©ö€‰×‰îùİ˜Œ€ï¨Š°;foreach($Ãêü„Í as $†É=>$ø){$±ƒÔÀ[$†É]=$†É;™üœÂôËÍ¦Ú¼ ¸Õ­¸ÅÕÈĞ†æú°•›©óó‹ğ¨ĞæÅ´ì÷ñ±È»é‘³ß—šÚ¤;}$±ƒÔÀ['zh']='zh-CN';õäµò§©ÄïâÃÜÚ¶êş¦÷¸«íÏÆÈô’¹¶ˆëŠ’“´Ö¢¤¹æ‚•;$±ƒÔÀ['zh-tw']='zh-TW';”›«ÌÇ™á;$Êª=array();Ñ„¥ƒíïóºÀ;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$ÍÊé='en';}else{$ÍÊé=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$ÍÊé,$í,PREG_SET_ORDER);foreach($í as $Ô‘ôò){$Êª[$Ô‘ôò[0x001]]=(isset($Ô‘ôò[0x00003])?$Ô‘ôò[0x00003]:0x001);”³»á;ĞÎûñÂŠ¨•Î™ü¾¸€Ïïû–Æ û×ªà•ï£Áñü´µ‡İÊ—¬ã”êñÍêÂ;Š·“¬ÔİÖ•ŒİàõƒÏ†á¥—Ö˜—î©«£äº©ò¡ÕÈş¬Ø•¹¶ö°ºÇ¶œìÎó†åâ¯’‡•Ÿ¥Ğ­ÎÃÎ¥ÎÒå;}arsort($Êª);Ü¼×¤ó;foreach($Êª as $†É=>$‘Âè—¨){if(isset($±ƒÔÀ[$†É])){$øõ=$±ƒÔÀ[$†É];break;}$†É=preg_replace('~-.*~','',$†É);if(!isset($Êª[$†É])&& isset($±ƒÔÀ[$†É])){$øõ=$±ƒÔÀ[$†É];break;}}return $øõ;ÓÜÚù­‰Éñ×îş§ÁåŒÍƒé‹ÛşĞ Âº¸ê;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$‚ÕŠ‹=$_COOKIE['kod_user_language'];}else{$‚ÕŠ‹=get_default_lang();setcookie('kod_user_language',$‚ÕŠ‹,time()+0x0e10*0x0000018*0x064);}$‚ÕŠ‹=str_replace(array('/','\\','..','.'),'',$‚ÕŠ‹);if(isset($GLOBALS['config']['settings']['language'])){$‚ÕŠ‹=$GLOBALS['config']['settings']['language'];}if($‚ÕŠ‹=='zh_CN')$‚ÕŠ‹='zh-CN';if($‚ÕŠ‹=='zh_TW')$‚ÕŠ‹='zh-TW';$ûã=LANGUAGE_PATH.$‚ÕŠ‹.'/main.php';if(!file_exists($ûã)){$‚ÕŠ‹='en';$ûã=LANGUAGE_PATH.$‚ÕŠ‹.'/main.php';}define('LANGUAGE_TYPE',$‚ÕŠ‹);$GLOBALS['L']=include($ûã);á˜Ÿå‚ªÁ‘ª“±ì;­Ï‰ ôâÛÜÄ°ŒÇ”ô³±’ŠÏñÒë†Ğ÷;Ôé€°Æ‚†Ñ¦Íğ´Êû…¬•¤’—ÏÔ¨úçÚçµÄÁŠ¯Á»õÃÁÇĞç–Âà¿£ÔÈ¡ì™õ–”İğü“;}function make_path($€ÙÜÃ){$¤•=array('/','\\',':','*','?','"','<','>','|');ØÆ•ÍúÆß…–Ò×;return str_replace($¤•,"_",$€ÙÜÃ);˜Æ¬ìÍÚ©;}function init_setting(){$âº=USER_SYSTEM.'system_setting.php';²¡ÁÇ–Ò—«Ô­ùÏóÙÕ;if(!file_exists($âº)){$Ó€ù­Ü=$GLOBALS['config']['setting_system_default'];$Ó€ù­Ü['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($âº,$Ó€ù­Ü);}else{$Ó€ù­Ü=fileCache::load($âº);}if(!is_array($Ó€ù­Ü)){$Ó€ù­Ü=$GLOBALS['config']['setting_system_default'];}if(!is_array($Ó€ù­Ü['menu'])){$Ó€ù­Ü['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($Ó€ù­Ü['first_in']);$GLOBALS['app']->setDefaultAction('index');$GLOBALS['config']['setting_system']=$Ó€ù­Ü;Ï½¬òÛÅ¹ˆ;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];°¼áëñûäÅûŞóØ¾Úò™Ÿõå»ş™…Õ¦;À;©¬‰•Ÿ…úåÚÙÚø™¶ë§ĞŒ©ÆñäÅ‹êœ²;if(isset($Ùº['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$¤ÙèŸ=BASIC_PATH.'config/setting_user.php';if(file_exists($¤ÙèŸ)){include($¤ÙèŸ);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();@session_name('KOD_SESSION_SSO');ûàÚÌí…”àêÚìÖ÷ º…ùÉ¿İí™ÆÙ±‰óöı§óßƒÁÎ‰Õ;@session_start();×¨½²şÉß¬Øå„ú½úşÅôÊâ¢¸Á˜»òœ×Ñô ©ŞÜ¨¼Ê¢Î;Ê©½†®¸Ïî–¾‰;@session_destroy();Ö×†Õşù¶ƒ»…Œ’µ€ÄÒËî‘ÒÉ£àá–½¯øÌ†ĞÒÛĞÍ“Ó‰™ßœÎàá¢­Ğ;÷ß³íª–‘â×©ŸËÆ÷¼˜ÈÚ÷¥ø áÃ¢…’Ÿå€—Å´…ğË–Ô¤ÀôïˆìÄ†×Ÿıü™ŸßÜÂäïâÊğù‘¥€ƒğ;setcookie(SESSION_ID,'',time()-0x0e10,'/');setcookie('kod_name','',time()-0x0e10);ûß…’´Œê»Ü½˜®‹«‚•Äâ²”Ã”·ğåëñ;Í‡à»–¥ÁíÅÀêŞàÊ¼¤°¬;ĞÊ›âèĞîÓŒÌ’¤úĞ;setcookie('kod_token','',time()-0x0e10);àæª¥ûá—áÍ;header('location:./index.php?user/login');;exit;µš;}function hash_encode($êìŒ){return str_replace(base64_encode($êìŒ),array('+','/','='),array('_a','_b','_c'));§Ó¼£ñ¢¦£„;}function hash_decode($Áì){return base64_decode(str_replace($Áì,array('_a','_b','_c'),array('+','/','=')));·ë¬»§˜©³óêËœ¿‰¿±˜âØ;Š…º¨ˆÈëŠÚ¡¥Äì˜ı¿íò©èª€ª£ÃËüÑªû´‚ËÜŠ•É•ïêºµØÓ³™Á¦Â;}