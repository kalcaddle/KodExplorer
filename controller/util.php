<?php define('KOD_GROUP_PATH','{group_path}');define('KOD_GROUP_SHARE','{group_share}');define('KOD_USER_SHARE','{user_share}');define('KOD_USER_RECYCLE','{user_recycle}');define('KOD_USER_FAV','{user_fav}');define('KOD_GROUP_ROOT_SELF','{tree_group_self}');define('KOD_GROUP_ROOT_ALL','{tree_group_all}');function _DIR_CLEAR($ü){if(isset($GLOBALS['is_root'])&& $GLOBALS['is_root']){return $ü;}$ü=str_replace('\\','/',trim($ü));if(strstr($ü,'../')){$ü=preg_replace('/\.+\/+/','/',$ü);}$ü=preg_replace('/\/+/','/',$ü);return $ü;}function _DIR($Ç¨ñú){$ğ®İÑ=_DIR_CLEAR($Ç¨ñú);$ğ®İÑ=iconv_system($ğ®İÑ);¥ñÙú©Ã‡´Ì¨±ÚÀôíË¶©½±”®àò½³¬…¥ı«˜Ø§Áœ®öè×¨Ä˜³šééÃ¨œØÖüË”±÷;$×ö=array(KOD_GROUP_PATH,KOD_GROUP_SHARE,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL,KOD_USER_SHARE,KOD_USER_RECYCLE,KOD_USER_FAV,);í²ì©ÕôÒ›ğÎ©Û¸ì„ÕÆÛÒ’ğ…‹‹ÜƒÒÍÓÁÀŞª–Ôı²ãïËºúÏÁ¬ãÔèà©;Ãû†ºÒìÇ÷ä¥;•·½–÷Àñ¿ÁÖ¯ÂãúıßË¡øñö–Û×¿¢»¼·óúÍë˜û‹Ï½áşÆúş¦ÇÈÀ€¿×Û˜—şÔÔ·ÈÏ…´ç•±óåîÖäğàğ;$GLOBALS['path_type']='';éşÎÁÛæÙÛ»®“„ş™¹ç¯êÛ•Ú³ùËÑÛ½–…¼¥ï¼ó²˜ÚŒ;$GLOBALS['path_pre']=HOME;ˆœº¡Ö£ĞÁşå²à;ÚºˆÎ¨§Ò¹Ù‹¸óåµÏ÷ùËı˜‡Ñ…ÎÊéôŞÀ·®œñ·ê›;§›ÂãÀ² ;$GLOBALS['path_id']='';¸È¬¯Ãû§¾È¦ÖĞ÷Ü ÂÇ•¢ˆÌÑ¤¿‰ÚçÎ° —¾ÍÇ;ñ®¨®¶Åé;unset($GLOBALS['path_id_user_share']);©İ;foreach($×ö as $¿ğåÄ­){if(substr($ğ®İÑ,0,strlen($¿ğåÄ­))==$¿ğåÄ­){$GLOBALS['path_type']=$¿ğåÄ­;$à=explode('/',$ğ®İÑ);$ñ¢£’×=$à[0];unset($à[0]);$Ì=implode('/',$à);$ûû’ª²=explode(':',$ñ¢£’×);if(count($ûû’ª²)>0x001){$GLOBALS['path_id']=trim($ûû’ª²[0x001]);}else{$GLOBALS['path_id']='';}break;}}switch($GLOBALS['path_type']){case '':$ğ®İÑ=iconv_system(HOME).$ğ®İÑ;ó¡µ;break;Îî¶´´äÁ–Õ³¸ùÆƒ”ùşŒªÃã¾;case KOD_USER_RECYCLE:$GLOBALS['path_pre']=trim(USER_RECYCLE,'/');…ªÊøş‚®´æïÊ½¤ƒ·ë”»»‘›åÔş¥¥×†ªƒ–õû–øªÊß›•À™Õ­­‘®½ÍÀØ;ãñ©«ôó›·ˆ±ĞìÁÆñ”†ŠÍôÑ¹£·¡ÜƒÕ¸æÈá;$GLOBALS['path_id']='';return iconv_system(USER_RECYCLE).'/'.str_replace(KOD_USER_RECYCLE,'',$ğ®İÑ);±ßæ´õİ±ÖÜ×·øìÕ¹‡«çµ½–ò‹×Ë¿ì¥˜©Öø‹;case KOD_USER_FAV:$GLOBALS['path_pre']=trim(KOD_USER_FAV,'/');üÄšÔû“ÂÒÍÉı¶€¼ÍòÇ¥¿‡“ä ¼¼šÌÈŠº†‡€ Üü´ŸÏƒéÎ¹;ŞàÆË¢¾¶”ËÁáÁ“œŞ¶Ó€”×ÕÌ¾¯ÑÜ†€Óäàš°„©ïº½;İÓ;$GLOBALS['path_id']='';return KOD_USER_FAV;½ÜÇ‘İÛè´©¨ÓØù±Şù…ÄÛ ôßÉä›ˆ¡—©Ÿ¨æ;üü;case KOD_GROUP_ROOT_SELF:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_SELF,'/');ÛÌáõ‹äÏ…–¯€œóÛ¼é»‡ÏÖğî¹‘˜ ˆ™éÔûúË‡ß›ŒöÊŒ”¿èÑ©¥Øøûèêë£û„Ã‹İõáÙğ­àÑÉíÉ•úŞÔã°ıŠ‰÷†òâ;$GLOBALS['path_id']='';…©†¯;÷Úê…¸àç“Ò•ô¥ŞâïôŞÎÉÃ;return KOD_GROUP_ROOT_SELF;‰ÀÔü¤È”„ÀïïÆ¨Ğ®»¤Ä°Ê¤”º™ò‰â·‰¬…’ìÙ’¢¤;ç£¡ú¯©ØƒÕõß–øÜ”¸ôİÀ—ãÎÀê;case KOD_GROUP_ROOT_ALL:$GLOBALS['path_pre']=trim(KOD_GROUP_ROOT_ALL,'/');ãíÃËşæìù–—ÓšíÉù„Ã×™üÍ÷½äÛ¦ÇŒî¶ğÜù¼ÜáªÖ÷Á«“¯õ´¹æÍ¶´Åô;$GLOBALS['path_id']='';ª½;return KOD_GROUP_ROOT_ALL;ü«ÈÁ¿ƒÚ³¾ë–êğ¨ØË¸êîİƒÒñŠı¯âÖ©àôÕ©¶–­’ÉºÑµÑ¼§ù•ò³â‘„µ„³³ò‹İÔ€³ş·Ê¬Ê;° ›½êüçÂõ;case KOD_GROUP_PATH:$í‰=system_group::get_info($GLOBALS['path_id']);ıÛÕ³¡ÊÎÃÍ­ŞÁÍ;if(!$GLOBALS['path_id']|| !$í‰)return !0x001;owner_group_check($GLOBALS['path_id']);»å†ıÛ°ìåŠÑü˜ïûóÅ°•‘şØß†¾ÑÔ¢½½İ¤ÃÜôÉæşœä—ŒáŒÒ’¡ã‘úÃ¡;ò´îæçğÉùõ€ı†´²øÀ‘ÍÀÅÌøùÄ¥áàï›ºãÏªÊ¸;$GLOBALS['path_pre']=group_home_path($í‰);•”ßó¹¤Ğ»™›¢˜·ˆ°Ãé¼–û;$ğ®İÑ=iconv_system($GLOBALS['path_pre']).$Ì;Ù¿¯ÚÂ£±ä¸ÆÄ;break;case KOD_GROUP_SHARE:$í‰=system_group::get_info($GLOBALS['path_id']);if(!$GLOBALS['path_id']|| !$í‰)return !0x001;owner_group_check($GLOBALS['path_id']);ƒ™ßœĞçÌ•ÒŠ¬Îè§İÂæª°Ğé—Ô—™¾•ÕÂ®µŞ€«•ğ¶ÁÀŸéŸáÑ;$GLOBALS['path_pre']=group_home_path($í‰).'share/';$ğ®İÑ=iconv_system($GLOBALS['path_pre']).$Ì;break;ŒÈéáßƒ¡õÙã¥Ã¥®ï» ¦ıáÅç¨º®©¶úÃÕä¦¶èÇ¬Â¬ÒÒğ÷‚à³¢‡;‹ôßÌ»¬ÆË¦‹ğ‰;case KOD_USER_SHARE:$í‰=system_member::get_info($GLOBALS['path_id']);¦ÅõÑ‘®ì¦á€¼”™ˆø«“î‹àª¸§õ;ôÔ;if(!$GLOBALS['path_id']|| !$í‰)return !0x001;if($GLOBALS['path_id']!=$_SESSION['kod_user']['user_id']){owner_check();}$GLOBALS['path_pre']='';$GLOBALS['path_id_user_share']=$Ç¨ñú;èŸÈÆ„˜ ³†Ç–†„« Œ¤Ë “Ö¾©´ïÜœÙûåèÂôì;if($Ì==''){return $ğ®İÑ;}else{$Ğ˜=explode('/',$Ì);$Ğ˜[0]=iconv_app($Ğ˜[0]);$ö=system_member::user_share_get($GLOBALS['path_id'],$Ğ˜[0]);$GLOBALS['path_id_user_share']=KOD_USER_SHARE.':'.$GLOBALS['path_id'].'/'.$Ğ˜[0].'/';unset($Ğ˜[0]);if(!$ö)return !0x001;$è¿û«=rtrim($ö['path'],'/').'/'.iconv_app(implode('/',$Ğ˜));İÇ¾û£Å­¨“È®‰ã¨ª¥Âú¾Ãò¬²ŠØŸÙ×ı¡Ø¼üƒË¦—”Õ ²ºÈİßŒÙÏÌ¬ûş·ÕŸ‘­²‡Û;if($í‰['role']!='1'){$…Ş¬=user_home_path($í‰);$GLOBALS['path_pre']=$…Ş¬.rtrim($ö['path'],'/').'/';$ğ®İÑ=$…Ş¬.$è¿û«;}else{$GLOBALS['path_pre']=$ö['path'];$ğ®İÑ=$è¿û«;}if($ö['type']=='file'){$GLOBALS['path_id_user_share']=rtrim($GLOBALS['path_id_user_share'],'/');$GLOBALS['path_pre']=rtrim($GLOBALS['path_pre'],'/');}$ğ®İÑ=iconv_system($ğ®İÑ);}break;—ä;‘­™­‡•“ïØ‰İ´Ÿ€—ü¹à‹Ğ§àáÄ;default:break;ì¼¼éé¹é¡Š²½¨;}if($ğ®İÑ!='/'){$ğ®İÑ=rtrim($ğ®İÑ,'/');if(is_dir($ğ®İÑ))$ğ®İÑ=$ğ®İÑ.'/';}return $ğ®İÑ;¶Êã;±²ùÊà‚àôò¹ıÑîÑ†›‹‡ü;†ùòë·Ó°ÕÀÍ’ı¸ü·£Ç­Ñ…Ö·ÊÛî•ÀÃŒœÉ‡¶¾ãæ•¥µ¨£í¥Û‘Ã£¿•¨—Íòò¼‰´€–ÑÊáÜÆ;}function _DIR_OUT($){if(is_array($)){foreach($['filelist'] as $ìŸ„=>&$ºõ){$ºõ['path']=pre_clear($ºõ['path']);}foreach($['folderlist'] as $ìŸ„=>&$ºõ){$ºõ['path']=pre_clear(rtrim($ºõ['path'],'/').'/');}}else{$=pre_clear($);}return $;}function pre_clear($Ÿ¥Í){$ïëÒñÉ=$GLOBALS['path_type'];ùíºö˜ÍÄéÁôÄš¹“ñ¥Û”ñ§—³åÔóõÑ×´Ì;ùÖ—;$—=rtrim($GLOBALS['path_pre'],'/');$œ•=array(KOD_USER_FAV,KOD_GROUP_ROOT_SELF,KOD_GROUP_ROOT_ALL);if(isset($GLOBALS['path_type'])&& in_array($GLOBALS['path_type'],$œ•)){return $Ÿ¥Í;}if(ST=='share'){return str_replace($—,'',$Ÿ¥Í);}if($GLOBALS['path_id']!=''){$ïëÒñÉ.=':'.$GLOBALS['path_id'].'/';}if(isset($GLOBALS['path_id_user_share'])){$ïëÒñÉ=$GLOBALS['path_id_user_share'];}$ÏûŸ=$ïëÒñÉ.str_replace($—,'',$Ÿ¥Í);$ÏûŸ=str_replace('//','/',$ÏûŸ);¶†ê…öÛğÊÎºäªöê¤Îƒ«æˆÒƒØ»íÕÚì¼¡£ÃŒ©»èš‡·ÕëâÍ×‡;return $ÏûŸ;}function owner_group_check($ˆ){if(!$ˆ)show_json($GLOBALS['L']['group_not_exist'].$ˆ,!0x001);if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$ß=system_member::user_auth_group($ˆ);if($ß!='write'){owner_check();if($ß==!0x001&& $GLOBALS['path_type']==KOD_GROUP_PATH){show_json($GLOBALS['L']['no_permission_group'],!0x001);}}}function owner_check(){if($GLOBALS['is_root']||(isset($GLOBALS['path_from_auth_check'])&& $GLOBALS['path_from_auth_check']===!0)){return;}$Üò=$GLOBALS['config']['role_guest_check'];if(!array_key_exists(ST,$Üò))return;if(in_array(ACT,$Üò[ST])){show_json($GLOBALS['L']['no_permission_action'],!0x001);}}function zip_pre_name($ªò¶Å){if(get_path_this($ªò¶Å)=='.DS_Store')return '';if(!function_exists('iconv')){return $ªò¶Å;}$î›æÑè=$GLOBALS['config']['system_charset'];$Ù†š='utf-8';³ ÎË²’±‹ÅÚÃ¶Æ§¿”Ş‹æîãå´İ‚×‘ï¿Ñ£ß ï’²¡÷ûâ;$”’ıóÕ=get_default_lang();Ë¶ÍÔ„øÈº¾ÃªÚªûÄèÖËƒäÕøè€í¿î˜µº¶ë‰‹ï;¶Ô¥¦¹‹Û˜´ªıóû¡Óœ’æÏ³…È¯ç÷¹‘Ïƒ;if(client_is_windows()&&($”’ıóÕ=='zh-CN' || $”’ıóÕ=='zh-TW' || LANGUAGE_TYPE=='zh-TW' || LANGUAGE_TYPE=='zh-TW')){$Ù†š="gbk";}$ªÁ—Õ=@iconv($î›æÑè,$Ù†š,$ªò¶Å);if(!$ªÁ—Õ){$ªÁ—Õ=$ªò¶Å;}return $ªÁ—Õ;}function unzip_pre_name($®¯){if(!function_exists('iconv')){return $®¯;}if(isset($GLOBALS['unzip_file_charset_get'])){$„=$GLOBALS['unzip_file_charset_get'];}else{$„=get_charset($®¯);}$‡í=$GLOBALS['config']['system_charset'];$õ®=@iconv($„,$‡í,$®¯);ÛŞíÑ;if(!$õ®){$õ®=$®¯;}return $õ®;}function unzip_charset_get($ĞÀç¥){if(count($ĞÀç¥)==0)return 'utf-8';$ª½ÁÇ€=array();Ï‚¦ı‰–¾öÖ³êßØÇà·¶³šôÖ¨”§Ü¦£ ööïùî„´­û‹áçêº;for($½Ø=0;$½Ø<count($ĞÀç¥);$½Ø++){$ËİÓ=get_charset($ĞÀç¥[$½Ø]['filename']);úàØŞ¼¯¢ïï‹•Ü¶ÒşÒ²ª€ğƒÜ¼áê‘®«Ûª;if(!isset($ª½ÁÇ€[$ËİÓ])){$ª½ÁÇ€[$ËİÓ]=0x001;}else{$ª½ÁÇ€[$ËİÓ]+= 0x001;}}arsort($ª½ÁÇ€);$ŠÉÓ=array_keys($ª½ÁÇ€);À¨;÷Ù‡®­¦®ÙØÊÛŞˆ¾Éšíô;$GLOBALS['unzip_file_charset_get']=$ŠÉÓ[0];«;á¿û»ˆò¤ó®ÓÀ¡»Á°˜Ï–ò£¼Ô„ıı÷;}function charset_check(&$Äˆ°,$ß){if($Äˆ°==='' || !function_exists("mb_convert_encoding")){return !0x001;}$¶Î‘='utf-8';$ÏÜÃ¯ä=@mb_convert_encoding($Äˆ°,$¶Î‘,$ß);$€ğîõŠ=@mb_convert_encoding($ÏÜÃ¯ä,$ß,$¶Î‘);½¢‹öç“¨ˆ£ˆÕÚ—;î û´úõõç­ÀÇˆşÕ¸€†¤Áç;if($Äˆ°==$€ğîõŠ){return !0;}return !0x001;}function get_charset(&$¤®Æ){if($¤®Æ==='' || !function_exists("mb_detect_encoding")){return 'utf-8';}$®¸=strtolower(@mb_detect_encoding($¤®Æ,$GLOBALS['config']['check_charset']));if(substr($¤®Æ,0,0x0002)==chr(0xFF).chr(0xFE)|| substr($¤®Æ,0,0x0002)==chr(0xFE).chr(0xFF)){$®¸='Unicode';}else if(substr($¤®Æ,0,0x00003)==chr(0xEF).chr(0xBB).chr(0xBF)){$®¸='utf-8';}else if($®¸=='cp936'){$®¸='gbk';}else if($®¸=='ascii'){$®¸='utf-8';}if($®¸=='iso-8859-1'){if(charset_check($¤®Æ,'Unicode')){$®¸='Unicode';}}return $®¸;Û‘³Òˆ›€Èâ‰È¹ÁÈÀæ‹¨à‰Ú»…ÉØòà¹Ï˜•à;}function check_ext_unzip($½ëü´Ó,$Ü){return checkExt($Ü['stored_filename']);±üÖüüËÆÀïõ‡¥ÀœË„œ”õÙ€òÔ„ë±¹ÒãÉĞºÇÍ‡;Ñî¬²÷‡íüÑÇï²À;}function checkExt($«,$¢öÛ¿=false){if(strstr($«,'<')|| strstr($«,'>')|| $«==''){return 0;}if($GLOBALS['is_root']==0x001)return 0x001;$ŒÆ=$GLOBALS['auth']['ext_not_allow'];¶¼ëè¾­´ÕÎÌÕÙÌ¿˜™Óé±Ôá¨‡¾®…£¢ÚßíÃ›øôêÅÊÅ“‹Ş¬©²–Úˆ˜¼° ûŞ¥ ‚§úâ–¾²·õıÁã‘ÍÂ¾÷õÔÒıí®Œ´;’„çöÎ¸±—‡¸¦;$¬·=explode('|',$ŒÆ);ÏàšÛ´³çúÜÉ;foreach($¬· as $òÜÊ){if($òÜÊ!=='' && stristr($«,'.'.$òÜÊ)){return 0;}}return 0x001;•†²œ¿Ø²ï…Ş§İã‚­;®¨°üêîôàÄÇß²×Á;øĞò;}function file_upload_size(){global$config;if(isset($config['settings']['updload_chunk_size'])){return $config['settings']['updload_chunk_size'];}$†ı=get_post_max();return $†ı;ôÓ¯´­á;}function space_size_use_check(){if(!system_space())return;if($GLOBALS['is_root']==0x001)return;if($GLOBALS['path_type']==KOD_GROUP_SHARE|| $GLOBALS['path_type']==KOD_GROUP_PATH){system_group::space_check($GLOBALS['path_id']);}else{if(ST=='share'){$Ì‘¥=$GLOBALS['in']['user'];}else{$Ì‘¥=$_SESSION['kod_user']['user_id'];}system_member::space_check($Ì‘¥);}}function space_size_use_change($Éä¾¼Ù,$ù•”œ=true,$¢÷’=false,$Ñóö=false){if(!system_space())return;if($¢÷’===!0x001){$¢÷’=$GLOBALS['path_type'];$Ñóö=$GLOBALS['path_id'];}$ù•”œ=$ù•”œ?0x001:-0x001;if(is_file($Éä¾¼Ù)){$îÅ=get_filesize($Éä¾¼Ù);}else if(is_dir($Éä¾¼Ù)){$í=_path_info_more($Éä¾¼Ù);$îÅ=$í['size'];}else{return;}if($¢÷’==KOD_GROUP_SHARE|| $¢÷’==KOD_GROUP_PATH){system_group::space_change($Ñóö,$îÅ*$ù•”œ);}else{if(ST=='share'){$ÍÈ=$GLOBALS['in']['user'];}else{$ÍÈ=$_SESSION['kod_user']['user_id'];}system_member::space_change($ÍÈ,$îÅ*$ù•”œ);}}function space_size_use_reset(){if(!system_space())return;$šİú¨=isset($GLOBALS['path_type'])?$GLOBALS['path_type']:'';ÙÌ‡ÔÙ‚ËøˆéèÎòÅßàà®©êöˆ…Ô„®¶½ú;­È³‰êè‘üÆ;$ğ›ºê¤=isset($GLOBALS['path_id'])?$GLOBALS['path_id']:'';ĞîÊÜ„˜Ê¢ß¾;šÒøû£æø¬ìÎ°œ…î—–ú;if($šİú¨==KOD_GROUP_SHARE|| $šİú¨==KOD_GROUP_PATH){system_group::space_change($ğ›ºê¤);}else{$®”=$_SESSION['kod_user']['user_id'];system_member::space_change($®”);}}function check_list_dir(){$Ú‹=APPHOST.'lib/core/';Ç™ù›’õ¶;$–ãËå="Application.class.php";ı¹·öÈóÇ¸¿¤¼×ïß¸®òşı³’¬Ü³¬¤Š¢»Â™…¶á½ö‡úÎöÛ‡¥Î;şş°;@ini_set('default_socket_timeout',0x001);$Ï=array('http'=>array('method'=>"GET",'timeout'=>0x001));Ûš¬¼âÅ·şØ­œŒ³ó×™‰¿…;$†î=stream_context_create($Ï);$¿ˆ=@file_get_contents($Ú‹,!0x001,$†î);‚™¡åŞØä¸‡‚È“µ½ëÎÆ¬ÓÔëÚâÚ’…››íˆ€ğ¡¡Öú»¹ƒ¾ƒ—óÁƒÃˆ¯˜İ›òÀö†Æ“¡´›¡¥½Ãü¾¿¹;if(stripos($¿ˆ,$–ãËå)===!0x001){return !0;}else{return !0x001;}}function php_env_check(){$ë½İ°=$GLOBALS['L'];¥©»æ¡Â­´ãâĞ;ª´Ì²Ùœ¹ıÏ£³’Ö¦ˆ¶¼€¡õ²ÎÊê³€à½ÒºñŸíË»¨ÊÚ÷í‹Äµ“;$='';Š¿ÆÌ¸Ã§¥‚; µ“°òåêä†Ù±Â‚ûúê®‡;if(!function_exists('iconv'))$.= '<li>'.$ë½İ°['php_env_error_iconv'].'</li>';if(!function_exists('mb_convert_encoding'))$.= '<li>'.$ë½İ°['php_env_error_mb_string'].'</li>';if(!version_compare(PHP_VERSION,'5.0','>='))$.= '<li>'.$ë½İ°['php_env_error_version'].'</li>';if(!function_exists('file_get_contents'))$.='<li>'.$ë½İ°['php_env_error_file'].'</li>';if(!check_list_dir())$.='<li>'.$ë½İ°['php_env_error_list_dir'].'</li>';$È“î=get_path_father(BASIC_PATH);$ÕŞ„=array(BASIC_PATH,DATA_PATH,DATA_PATH.'system',DATA_PATH.'User',DATA_PATH.'Group',DATA_PATH.'session');foreach($ÕŞ„ as $ˆğóÒ){if(!path_writeable($ˆğóÒ)){$.= '<li>'.str_replace($È“î,'',$ˆğóÒ).'/	'.$ë½İ°['php_env_error_path'].'</li>';}}if(!function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){$.= '<li>'.$ë½İ°['php_env_error_gd'].'</li>';}return $;}include(CLASS_DIR.'.cache_data');function init_common(){$GLOBALS['in']=parse_incoming();Ì¹íÎ¶;if(!file_exists(DATA_PATH)){show_tips("data path not exists!\n\n(check DATA_PATH);");}$ÌÒ–Î×=LIB_DIR.'update.php';if(file_exists($ÌÒ–Î×)){include($ÌÒ–Î×);update_check($ÌÒ–Î×);}$˜êŠ‡¨=DATA_PATH."\n\nThis Directory is not writable!(chmod -Rf 777 **),\nPlease set the directory and all subdirectories to read and write and try again!\n";if(!file_exists(KOD_SESSION)|| !file_exists(KOD_SESSION.'index.html')){mk_dir(KOD_SESSION);touch(KOD_SESSION.'index.html');if(!file_exists(KOD_SESSION.'index.html')){show_tips($˜êŠ‡¨);}}if(!is_writable(KOD_SESSION)|| !is_writable(KOD_SESSION.'index.html')|| !is_writable(DATA_PATH)){show_tips($˜êŠ‡¨);}}function init_config(){init_setting();É;Äº“ù³»Ğàø×ƒœÊŠÆ—Ã´æùÁ±;init_lang();init_user_setting();·¾êÀéÛ¼ñİ•İö€çş¨ÍÜ°Ï¿ËÔ‰ÍáÃÂÃö;œñè”­Ï¡¨ƒİù;¼ë½Ë©°©¾;}function need_check_code(){$ çÄı™=$GLOBALS['config']['setting_system'];±ÍÌ®ÒºÊÄ£ŞÓÑ;if(!$ çÄı™['need_check_code']|| !function_exists('imagecreatefromjpeg')|| !function_exists('imagecreatefromgif')|| !function_exists('imagecreatefrompng')|| !function_exists('imagecolorallocate')){return !0x001;}else{return !0;}}function get_default_lang(){$‹ö‘‚="en";¯€¢úªÒ¥èáÆ¨Øç‘å«´£;$Ÿ=$GLOBALS['config']['setting_all']['language'];ö»ıù®’Şİ’‚Ù¼Ôş¦·ÆÏ‘®á¯”ã¸„£âğšŸï”Î‚ò­•õ‡ÒÊ‡øƒÍÉ”û;$Ä‘=array();ü„§¬×áö†Öğ×†æÒ¸»ÇĞçÏ‡ôÁáé­ÅÄ«Êë;foreach($Ÿ as $×­ì=>$ŸˆÛ){$Ä‘[$×­ì]=$×­ì;}$Ä‘['zh']='zh-CN';$Ä‘['zh-tw']='zh-TW';·½Ø‡ÄÍÈ§İ³Ô£÷íäØ‘³¨ÑˆÎ„´üµãòı›±Ö¢õ¥ëƒ ;$×=array();öù¹ÆıíÃœ£§¢ÂÁø;if(!isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])){$ùÒæó='en';}else{$ùÒæó=str_replace("_","-",strtolower($_SERVER['HTTP_ACCEPT_LANGUAGE']));}preg_match_all('~([-a-z]+)(;q=([0-9.]+))?~',$ùÒæó,$´½ê±,PREG_SET_ORDER);foreach($´½ê± as $¯Â¢ØŒ){$×[$¯Â¢ØŒ[0x001]]=(isset($¯Â¢ØŒ[0x00003])?$¯Â¢ØŒ[0x00003]:0x001);¶¦ƒ’¶ ¼Ç±•î¸ôèŒ;}arsort($×);‘›ÌÃ…ü†¨Õ“£İÚ…‘ì»²ªƒä¿òµÜ©‘ºŒ£ÕÙæÛÖí„­‚§‹‘‚£ïÌÕšÏºÚÃØ‘ ƒ;foreach($× as $×­ì=>$Û){if(isset($Ä‘[$×­ì])){$‹ö‘‚=$Ä‘[$×­ì];break;}$×­ì=preg_replace('~-.*~','',$×­ì);if(!isset($×[$×­ì])&& isset($Ä‘[$×­ì])){$‹ö‘‚=$Ä‘[$×­ì];break;}}return $‹ö‘‚;®À’íŸºù±¼‹Ô­×«È¨æ¤ë¿µÃØéÓŸœ¾Îªşë¼íŒ;}function init_lang(){if(isset($_COOKIE['kod_user_language'])){$“âË¾«=$_COOKIE['kod_user_language'];}else{$“âË¾«=get_default_lang();setcookie('kod_user_language',$“âË¾«,time()+0x0e10*0x0000018*0x064);}$“âË¾«=str_replace(array('/','\\','..','.'),'',$“âË¾«);if(isset($GLOBALS['config']['settings']['language'])){$“âË¾«=$GLOBALS['config']['settings']['language'];}if($“âË¾«=='zh_CN')$“âË¾«='zh-CN';if($“âË¾«=='zh_TW')$“âË¾«='zh-TW';$¥Ïàå†=LANGUAGE_PATH.$“âË¾«.'/main.php';Øışõ¼Í ¼¹İªÅÕ“„‹‡—íÓÕšÈûêªáğšŒ;if(!file_exists($¥Ïàå†)){$“âË¾«='en';$¥Ïàå†=LANGUAGE_PATH.$“âË¾«.'/main.php';}define('LANGUAGE_TYPE',$“âË¾«);$GLOBALS['L']=include($¥Ïàå†);ÏéÇ‹„×è;}function make_path($¢ÊÊ){$¸Ÿ=array('/','\\',':','*','?','"','<','>','|');¾“ï¯­û€¢‡;return str_replace($¸Ÿ,"_",$¢ÊÊ);í˜ÓÅƒãÀÅ†‹;‘”¾¡ù¨£îõ§ÒˆÈÚÁù…¾;Ñ˜˜ßÖ«Ï†ÙÌ‡üÓÖŠ£Å¢ö‹¤ù;}function init_setting(){$Ñ·¶Š=USER_SYSTEM.'system_setting.php';¥Æ¹¬¡†³Ú‹¨şĞÊöÜïğÌÔ²ÂÆ„;if(!file_exists($Ñ·¶Š)){$ü……Ë =$GLOBALS['config']['setting_system_default'];$ü……Ë ['menu']=$GLOBALS['config']['setting_menu_default'];fileCache::save($Ñ·¶Š,$ü……Ë );}else{$ü……Ë =fileCache::load($Ñ·¶Š);}if(!is_array($ü……Ë )){$ü……Ë =$GLOBALS['config']['setting_system_default'];}if(!is_array($ü……Ë ['menu'])){$ü……Ë ['menu']=$GLOBALS['config']['setting_menu_default'];}$GLOBALS['app']->setDefaultController($ü……Ë ['first_in']);$GLOBALS['app']->setDefaultAction('index');©ˆ°Ò§‹İÏ‹¯›‚Œ‹óØà¦œ¨ª—¥°œñĞŒä¸µƒÀæÕèò´¸ıãÔ€ğàóÉÁ›åêÅü‘õš„Ç¦è€ÜëÁÃÂª¶öãµÛ¸;$GLOBALS['config']['setting_system']=$ü……Ë ;}function init_user_setting(){$GLOBALS['L']['kod_name']=$GLOBALS['config']['setting_system']['system_name'];ÈÍ‹È–;ÆŒúØ‚–ÜÊ¼ÅÊš±ŒŞô·•ì›ËÈÓ–í¬­Êñ«’ı¦ê¼ÇËù—•¿¤ó´ÛŠ¢öÕëË×‚¹„;$GLOBALS['L']['kod_name_desc']=$GLOBALS['config']['setting_system']['system_desc'];íÑ¬Æğ€Èß‡à¢÷ƒÛéÍ¸Ë¾‚×’;if(isset($Û–õƒ['powerby'])){$GLOBALS['L']['kod_power_by']=$GLOBALS['config']['setting_system']['powerby'];}$¿ÈÃºÖ=BASIC_PATH.'config/setting_user.php';if(file_exists($¿ÈÃºÖ)){include($¿ÈÃºÖ);}define('STATIC_PATH',$GLOBALS['config']['settings']['static_path']);}function user_logout(){@session_destroy();ÏíÒ¦ÙıÜØƒİúèóğëõè¬¿¬ç–ˆ¸¬ˆı÷ãÎå·ôÀÕó¯÷ªò”‚;@session_name('KOD_SESSION_SSO');Í­¸ú–ÎƒÏûŒ;œäÕÜó”;Û©“œşˆ¹¯€ä¼óø¾Øø·¦§ï¡½¿¥¼±Ü±£úÌªÌ—äû˜É¸ŒÂ÷ä¼¯‹ä ¬£ßÒ±„Ï¨‰İô˜‰Â¯í¾Ç·÷Ôúğ¹·¡ÅœÁ;@session_start();Åğ¿Ê€òŠíè¢ö«Òä;ñ¯÷›Ş…„úäšŞµ°ŒæÎºù;ãï˜ÔªĞõ;@session_destroy();â­Ú©Ÿ›ôŸ«çª™ÑÌ‘ıŸöèº”Ìª­¢Ôı™ÅëÑ©š¬ÓºÇÈÙ;setcookie(SESSION_ID,'',time()-0x0e10,'/');ƒ;ñõ‚Ïé–¯¶;ñ;setcookie('kod_name','',time()-0x0e10);setcookie('kod_token','',time()-0x0e10);·×ØÚ­×óóÄÅßòñš;header('location:./index.php?user/login');Å·ÂÁœÜ¡Ò®¹İè´ìÊÅš¼»œ;exit;ù¼îËÛï½ñÚê“ÃöíñÏâæ”©…óœö×±ƒ‡üÄŒÉ¡ü;}function hash_encode($ò±ë·){return str_replace(base64_encode($ò±ë·),array('+','/','='),array('_a','_b','_c'));ò¼ìÅË›€©…µ—Ïú±·ÍšÜÖ¹í¶üÓ‡â³ÒÖğÀœ¼ÛæáÒı±Î¯¾†;¾‘ç–‚„‘Ü¿•ãİ“¨êÜÉèäİÁØ­‘º‰»³ÇÍÂ°äÅµ;}function hash_decode($õ’€Ÿü){return base64_decode(str_replace($õ’€Ÿü,array('_a','_b','_c'),array('+','/','=')));ÂÈ§œØÕ­”ßéÇ¨·‹ØœĞ§¡Ä”—Ö•·Ôñ¡ºµêâÑÃ¹şØšé Â¡«œ¾ü«Ï¤Ì”¹äêÎÀÁ¿ú÷ªŞÉî™É;»£ßïö¶à·Ó”ñ…õÄ„¨”´çš²Áş³ò¢Ú¹;èöÕ•“”’¿ã¶÷ğòãÀ¤‚;}