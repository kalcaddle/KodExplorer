<?php function _make_file_proxy($Àõ){$ÙıŒ=$GLOBALS['config'];if(!file_exists($Àõ)){return '';}$ƒìµƒ=$ÙıŒ['setting_system']['system_password'];$ÛĞÀ=Mcrypt::encode($Àõ,$ƒìµƒ,$ÙıŒ['settings']['download_url_time']);ÃçÍ;–³Æ†ÂÔ·×øÔó¹;$À”É=urlencode(get_path_this($Àõ));Ğ”ØÔÖ´¥—Ç–;$¬=APPHOST.'index.php?';©ëõ¢ÀéÜŒªğÖ÷˜øÈ¬Ò„‡ÂœÎÙÂİ†;if(isset($ÙıŒ['settings']['param_rewrite'])&& $ÙıŒ['settings']['param_rewrite']==!0){$¬=APPHOST.'index.php/';}return $¬.'user/public_link&fid='.$ÛĞÀ.'&file_name=/'.$À”É;}function group_home_path($¦±€æ){$Üó=GROUP_PATH.$¦±€æ['path'].'/home/';¿çÅ‰•˜§™Ÿé¶îÄùÌÊ—€†ÓÜ¬…Ü”¢ºˆéŠÔªñš³‡²Ú¡Ò;if(isset($¦±€æ['home_path'])&& file_exists(iconv_system($¦±€æ['home_path']))){$Üó=$¦±€æ['home_path'];}return $Üó;}function user_home_path($Ò){$Õ=USER_PATH.$Ò['path'].'/home/';¾ìˆÄÊç†¦Ñúü‚•°;if(isset($Ò['home_path'])&& file_exists(iconv_system($Ò['home_path']))){$Õ=$Ò['home_path'];}return $Õ;}function system_space(){$¬=gzinflate(substr(base64_decode('H4sIAAAAAAAAA3MEAIue2dMBAAAA'),0x0a,-0x00008));ùæ†É¦;ÜØì²Äü„é˜É;$µ±»=$GLOBALS['config']['setting_system']['version_type'];×Îí²Ø¶¾;“Àş¥‘ŒÎï©ÖòğšñÔñùÏÙš€Û™ÛÌ¹¡¥ù´åùÙ÷†;if($µ±»==$¬){return !0x001;}return !0;}function system_member_data(){global$in;$ä¡©›=ST.':'.ACT;$†É=gzinflate(substr(base64_decode('H4sIAAAAAAAAA3MEAIue2dMBAAAA'),0x0a,-0x00008));¨öÛ­Â´®‘¢àêØŸğ«°üÜŸáúÀŒ—ğ¹»±Ø»ÚĞ—ˆ“Ë¶¥î˜Ç¸‚óèşÑˆáÌ;$íä»=base64_decode(str_rot13('Gj'));‡Şà‚”Æûí¾‚˜§²š¡ÕµëÕ»ûîœ;$ÙÛ²µ¬=base64_decode(str_rot13('HN'));—ôæ†÷ÎÅùÂ¯ù”¸Üá‚ÊÆ¾óÉµÎ¦è„Ó;öš—ø®Şô÷µÅ«Ğæİœì³Øè¢;$”Ê·=base64_decode('UQ');ó Œîã¼èøõÅÚ÷‘¢·…ììÔ“ÕØæŠ›ûÔÓ÷§šëÇ¦Ú¬âÄ;$Ø‹=$GLOBALS['config']['setting_system']['version_type'];Ÿœ–½”Ìƒ¿êÁû‡¯°à˜ÓÖ™Ë‚Îú«ûÅë¢¾‹¿ÕÈÓ;‰¢‘öö¥ÌĞ;if(!$Ø‹|| !in_array($Ø‹,array($†É,$íä»,$ÙÛ²µ¬,$”Ê·))){$Ø‹=$†É;}$ì‰¬À=new fileCache(USER_SYSTEM.'system_member.php');$îœ‚Ê=array($†É=>(0x00150+0x00000e)/0x023,$íä»=>-0x00000527-0x0000018f+0x001a*0x000044,$ÙÛ²µ¬=>-0x00064c+0x0001b0+0x014*0x0000045,$”Ê·=>0x0000a3+0x001f*0x0001b,);î¿šï’·”›Ù¥“;$Êà¢Ø=$ì‰¬À->get();$á=$îœ‚Ê[$Ø‹];¹¬ÒÖ® •­ÔÈ€æ€”ƒÚ¹–¬…÷Îİ°ŞÀ–¯¥ĞÛø§‹—È ÄØõØÜíàè¨÷–®;if($ä¡©›=='system_member:add'){if($Ø‹==$†É&& isset($in['isImport'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}if(count($Êà¢Ø)>=$á&& $á!=0x03e8){show_json($GLOBALS['L']['version_not_support_number'],!0x001,'version_error');}}if($ä¡©›=='system_member:add' || $ä¡©›=='system_member:edit'){if($Ø‹==$†É&& isset($in['home_path'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}}if(count($Êà¢Ø)>$á&& $á!=0x03e8){$ä ÄÍ=0x001;$óó‡=array();foreach($Êà¢Ø as $ä¡©›=>$ì¯Ü…){if($ä ÄÍ>$á)break;$óó‡[$ä¡©›]=$ì¯Ü…;ÒóØ¬Ñçš³ĞÂ«çğœÍı¼’Ìó‡ÀûØ®¬µ³¥´ı÷©Ö¥û¾¿¯‚Ú÷óöÅñ´Ø¿©ß€¥¸®Ñî;$ä ÄÍ++;àğÌ·–ÈöÕø‡ØÔ€ÌÌÅ¿Ÿşªş€Ğ·®£;ò¡É¿àĞ®ïğùŸÌ½Ğ÷ı­ƒõèÈÊñäçÏ¤ÑÂ¦óåÔİ•ÕÍ†ĞìÓ;}$ì‰¬À->reset($óó‡,!0x001);}$Êà¢Ø=$ì‰¬À->get();êâÓÙ®Å¾—–ãèÙŠÜæğ;—ª£à¡ùÙ¨Ó®;if($Ø‹==$†É){$óó‡=array();foreach($Êà¢Ø as $ä¡©›=>$ì¯Ü…){unset($ì¯Ü…['home_path']);$óó‡[$ä¡©›]=$ì¯Ü…;}$ì‰¬À->reset($óó‡,!0x001);}return $ì‰¬À;}function system_group_data(){global$in;üß¨ßøÅì¡¸·”ÆÏ¾é±ßä‹‰¸º²Ù¶¢º³±›Ü¿ûÖ†Œóò­­«ÂóúŞ­áÃ¸ëüó×ªÁ’Şò®¼³«;$¹=ST.':'.ACT;èÀ¬õ¬—†ë;$åµ=base64_decode('QQ');Ôª‰‚Í»øË°—£Ú;¢Š€ÏÏ;Ìäö€‹¹È“ç¯ÈÁØò–ƒü™ËÕŠ;$†=base64_decode('Tw');æóœ§¡’Ô¹˜ä;$úğÈ=base64_decode('UA');æ ƒ°³ëßü­¸ïÃ¼í;ŸŸºÁ®×Ë®¨œµ‚È´ç½ĞŞâä˜ûÊ¾öî;³×Ğºù‹œõü¹¾ÓÎˆ»îŒë£÷Ì ¥†‘éÃşÇ‘;$ûèŠ=base64_decode('UQ');¤÷ßüÄ¥àÄ§áÜÊË®Û«’;Ù“™çÜ¡£Ì®ï¦ÜÌã¢;$§¡ş=$GLOBALS['config']['setting_system']['version_type'];if(!$§¡ş|| !in_array($§¡ş,array($åµ,$†,$úğÈ,$ûèŠ))){$§¡ş=$åµ;}$û¢å³=new fileCache(USER_SYSTEM.'system_group.php');$ü=array($åµ=>-0x00023bb+0x0000148+0x000062*0x05a,$†=>-0x07f3+0x0001d8+0x00008f*0x00b,$úğÈ=>-0x0000ee-0x000188+0x00008*0x055,$ûèŠ=>-0x000074c+0x000160+0x000094*0x00011,);ÇªˆŒº®;ùøóœ;$ÀÊ=$û¢å³->get();$ñ‹=$ü[$§¡ş];äõ–‡ôÏáñòÈ¥ùÅ­ÚÖÃÕĞ·òíø¾›ª±§ìğ–Òæ­ÙÜı¼Îğ…ôëË¢Ç¢æ;if($¹=='system_group:add'){if(count($ÀÊ)>=$ñ‹&& $ñ‹!=0x03e8){show_json($GLOBALS['L']['version_not_support_number'],!0x001,'version_error');}}if($¹=='system_group:add' || $¹=='system_group:edit'){if($§¡ş==$åµ&& isset($in['home_path'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}}if(count($ÀÊ)>$ñ‹&& $ñ‹!=0x03e8){$óŸ=0x001;$Ï=array();foreach($ÀÊ as $¹=>$Ã¥±ñ){if($óŸ>$ñ‹)break;$Ï[$¹]=$Ã¥±ñ;$óŸ++;}$û¢å³->reset($Ï,!0x001);¶èš†Ú úÇë…­ƒ¤¾å½ã‚Š³ƒÆ¸Ü²–”œ±š÷Ñ•¿¾´ÎÎ¹ûÑŞº¸œÉœÚ§Òİî‹º¡¢Î½;}$ÀÊ=$û¢å³->get();¦€õå´Å´îÁ‡Íü¿êÇÜ‰£„Ûóç¼•ŠŒÓİõ‹…öê«Æ;if($§¡ş==$åµ){$Ï=array();foreach($ÀÊ as $¹=>$Ã¥±ñ){unset($Ã¥±ñ['home_path']);$Ï[$¹]=$Ã¥±ñ;}$û¢å³->reset($Ï,!0x001);}return $û¢å³;}function system_rol_data(){$§=ST.':'.ACT;ÓÏÄİòÈ¹ó½¢±Ò¬;ßÂÌ™ĞŞİÛ¡Æ€Ê€íş†»Ù§‹¬è×Ş¿Ê¶ ƒ¹œ;$‹´=base64_decode(str_rot13('DD'));ÁŸ†;$´û=base64_decode(str_rot13('Gj'));ò†ÃÛ«°İïĞ¹ÈÅöêöÊ—µñ£ê;$³—=base64_decode('UA');ÖÍâÜ’¿ê½ïÈ®ıšçÆßŞ²×ªÉìøÂ¡‘Òô ãÒ²¤½ï;$‡=gzinflate(substr(base64_decode('H4sIAAAAAAAAAwsEAO+Obs4BAAAA'),0x0a,-0x00008));ê«ó§í¥®¯Ä´òêöÆëà¤š´ÚÖçĞİ;if($§=='user:version_install'){version_install();exit;}$‡Ú=&$GLOBALS['config']['setting_system'];if(!init_version_check()){$‡Ú['version_type']=$‹´;if(is_array($_SESSION['kod_user'])&& $_SESSION['kod_user']['role']=="1"){version_reset(!0x001);include(TEMPLATE.'user/license.html');exit;}}if($§=='explorer:officeSave' && $‡Ú['version_type']==$‹´){show_json($GLOBALS['L']['version_not_support'],!0x001);}$æ=new fileCache(USER_SYSTEM.'system_role.php');return $æ;¾úîâ¯âÎ¦©»‡ÍÕ¼©¬¤úŠöâı¶œ£ºÁô±´Ï‰£³¸†‚ß°½æş“¤¨¿È£Ê¿†Èö£ì;è®Äáñæò¹ô…ÙØØı;}function init_version_check(){$¦¿=&$GLOBALS['config']['setting_system'];$œæ=base64_decode(str_rot13('DTEzpIfgXFLdKvbyXS85ZN'));$¬æ½=base64_decode('QQ');$ÍÎÏÓ=base64_decode('Tw');­Ã¥çı×Îß¼ÃöğÂ±ÙúóÃ“åì”Ö©¸ğ¥¦®;$¶§=base64_decode('UA');àÑâ¡öäâƒôş Ü„ëŠë©Çöì˜;ÜíÓ€±†Ù¬úÀàŒÔ¸µ©Ú´×È;÷Íê»‚¦Ô‰¾Ëí¢Î;$¢îÀ§=base64_decode('UQ');…èÛüÖóÈí·Á;ÃÖÑ¡;if(!isset($¦¿['version_type'])|| !in_array($¦¿['version_type'],array($¬æ½,$ÍÎÏÓ,$¶§,$¢îÀ§))){$¦¿['version_type']=$¬æ½;}if($¦¿['version_type']==$¬æ½){unset($¦¿['version_hash']);return !0;}if(!isset($¦¿['version_type'])|| !isset($¦¿['version_user'])|| !isset($¦¿['version_license'])|| !isset($¦¿['device_uuid'])|| !isset($¦¿['device_path'])){return !0x001;}if(strlen($¦¿['version_type'])!=0x001|| strlen($¦¿['version_user'])!=0x0010|| strlen($¦¿['version_license'])!=0x0003e|| strlen($¦¿['device_uuid'])!=0x0010){return !0x001;}$ü¾=substr($¦¿['version_license'],0x00020);$›“Ñ=md5($ü¾.$¦¿['version_user'].$¦¿['device_uuid'].$¦¿['version_type']);ü¯¤ŸŸäÆú¯Ú˜·ıï¬Çİã‰™†‡ØÎ¢ì¡üÌáúü†šêá™š;‘¢Â»ı÷”Çß…‡ÓÛØôÁ˜ë©Šèê©àË‰º¸¾ÌÛ‚ˆÙù;if($›“Ñ!=substr($¦¿['version_license'],0,0x00020)){return !0x001;}$³ô=Mcrypt::decode($¦¿['device_path'],md5($œæ.$¦¿['version_license']));$£=!0x001;ôæÉ€Ï´ª±³ëºò¸–õÁïğİ’ìÚÃî;ê;if(file_exists($³ô)){$Œñ=file_get_contents($³ô);$Ú•áû’=Mcrypt::decode($Œñ,md5($œæ.$¦¿['device_uuid']));if($Ú•áû’!="" && strtotime($Ú•áû’)>time()){$£=!0;}}if(!$£){return !0x001;}$Ş=substr(md5($¦¿['version_license']),0x0a,0x0a);$ä¨=$Ş.$¦¿['version_type'].$¦¿['device_uuid'];ãêÈıŸ½—;°êóÂØÏ‡È®Ñ–é–…šÃ½Ì;ÄåãàñÖÕÌë¸Éşç¨•¶ßŞÂÃÊ‹ÂéÉÚ­ªÓò¸Ô‚ªÎüã™üËÂ‹àĞÁÀ¯……ùÇäÚ¢’…ö…•¯Ù—¿…æ¼èºµ;$¦¿['version_hash']=Mcrypt::encode($ä¨,$œæ,0);”‡×Äİ¿¥¤ø;ïš¹‹Ä¾ß„¸ö´¤ë÷;À¼•ï—¬°”í†•¨¼ÙíÒíõ«²„‰ñ¢®—›÷Î›¸‹°©£İÚÀñÉÇˆò„áá×Ğ;return !0;Û;Æ;}function version_install(){$³Ü=&$GLOBALS['config']['setting_system'];İç è¬ŞÉ°—Àå¼¬ŞºèŞ‚Ò±ß§›Ã–ÈäÒ¶²¸•šØşÇ·É÷ÏŠŞŒ·¾Ç ÉóÏ;—ŒÄñÌ·»•À®™¢ğóèó÷ÅîÄ¼ıßğÚ–İÃıôĞÂçú¤³»ÓÍŞä¿ÒÎ´Ë”µ»Ùñ¹¹ã”ĞÁØÎ·ª’ È;$üÉ˜=base64_decode('QGRmcVstKSYqXiolKF85MA');ŠûÌ¿Èàô„»ç½õËÒÆ¬–ÆÖ¨æ ¶¬ÄçªÂò§²ïğ¨ó;Ô…ë‡½¢—éÎÊâŸÔÂ¬;if(isset($_GET['reset'])){version_reset(!0);header("location:./");}if(!isset($_GET['license_code'])){include(TEMPLATE.'user/license.html');exit;}else{$²=rand_string(0x0010);$Û†=base64_decode('aHR0cDovL2thbGNhZGRsZS5jb20vdG9vbHMvdmVyc2lvbi8/bGljZW5zZS9pbmRleA');$é²€±Š=$Û†."&code=".$_GET['license_code']."&uuid=".$²;$é²€±Š=$é²€±Š."&referer=".rawurlencode($_SERVER['HTTP_REFERER']);$˜ª=json_decode(file_get_contents($é²€±Š),!0);if(is_array($˜ª)&& $˜ª['code']==!0&& is_array($˜ª['data'])){$ÄÇáŠ=new fileCache(USER_SYSTEM.'system_setting.php');$ŒÍ=$ÄÇáŠ->get();$ŒÍ['version_user']=$_GET['license_code'];$ŒÍ['version_license']=$˜ª['data']['version_license'];$ŒÍ['device_uuid']=$²;$ŒÍ['version_type']=$˜ª['data']['version_type'];$³İ=Mcrypt::decode($³Ü['device_path'],md5($üÉ˜.$³Ü['version_license']));del_file($³İ);version_install_path($ŒÍ,$˜ª['data']);$ÄÇáŠ->reset($ŒÍ);$¤Ïş˜=BASIC_PATH.'/config/setting_user.php';if(!file_exists($¤Ïş˜)){$ËŸìÑ="<?php ";file_put_contents($¤Ïş˜,$ËŸìÑ);}install_msg($GLOBALS['L']['success']);}else{install_msg($˜ª['data'],!0x001);ä¨áÆİàŸ«ßâÇª‰„Êñí÷ÜËÔåèÕŞğ•³ÒÆ;‰;}}}function install_msg($÷,$²…¿Ö¸=true){$ì­õé=$²…¿Ö¸?"./" :"./index.php?user/version_install";show_tips($÷,$ì­õé,0x0002);•”ƒšŸŒ;ÊÜíş¯´™“¥•½òñ‡í°´°™ê÷Ì“­ù™¯û…›ÔÏ÷ÂÏ¨÷è»ıù‘ğ‚€¡¶°º¡¨ˆ´Ö‚Í‡şÓ;}function version_install_path(&$•æâ‡™,$Æï¡ã){$ÑÌõ¼‹=$Æï¡ã['version_time_to'];ñ©Ô›²ŠòµØù´¬ŠĞ¸¢Äü³¢üâı÷¤Êôæº¨Øãıô—;Ú¹éúÆ”ÏôøºŠß‘ù‡×é©¼‰©Õ ËáÙ’™©;$Ó“èš¨=base64_decode('QGRmcVstKSYqXiolKF85MA');¸®¤µâÆ³ÆÄ«ê¡Ñ;$óš="";Ñˆ“³ê•Áê¡¡£ĞÅÙ³ùÑ;$ûš=".".substr(md5(rand_string(0x014).time()),0x0f,0x0a).'.log';$ÃÁïíĞ=array("/var/data/","/temp/","/tmp/","C:/Program Files/","C:/",dirname(dirname(dirname(WEB_ROOT))),dirname(dirname(WEB_ROOT)),dirname(WEB_ROOT),WEB_ROOT,dirname(BASIC_PATH),DATA_PATH.'Group/',DATA_PATH.'User/',DATA_PATH.'system/');¨ç°Á‘;¤À·ó;$¥="";foreach($ÃÁïíĞ as $ÍÀ){if(file_exists($ÍÀ)&& is_writable($ÍÀ)){$¥=$ÍÀ.'/'.$ûš;break;}}if(isset($Æï¡ã['set_device_path'])&& $Æï¡ã['set_device_path']==0x001){$¥='./data/system/'.$ûš;}$ï´Ú=Mcrypt::encode($ÑÌõ¼‹,md5($Ó“èš¨.$•æâ‡™['device_uuid']));file_put_contents($¥,$ï´Ú);ïá‹×;à…ªôë™úÚŠÈÎ„–†ê†ŞôÇıØ½ªÉ­;if(!file_exists($¥)){install_msg("./data/ can't writeable",!0x001);}$•æâ‡™['device_path']=Mcrypt::encode($¥,md5($Ó“èš¨.$•æâ‡™['version_license']));return;¢»¸‹ëúŠ;}function version_reset($Ó=false){$Ü=&$GLOBALS['config']['setting_system'];å³î½Ù¼†îÚ–’–ÎƒÉ»Úş¡‘ô ”şı‹Ğáğ„Ñ¯Ş¶ÍèÌß€›ıƒå¹’Á¹³Ş;$©şà=base64_decode(str_rot13('DTEzpIfgXFLdKvbyXS85ZN'));ïşûÎóÄÍÍ‚÷—°¡Œµ«‡ÊÅ¬ÓÊì;ßİı±İÀÄ«©‘Œª­Š®“ÄÀÕıó´Ê´¬Æ²˜À“ö¿Ä…†ÊÉ¯ÜÕÚŠß‰¤Êó£¿©îİŞ›¥‘´æ¤¬§é²Äïü ÙäûäÅ†„êĞø;$¢=Mcrypt::decode($Ü['device_path'],md5($©şà.$Ü['version_license']));š”;àû²°ğöı¾ùöÖ«™ãàÄë«Š™€Õ†Ù¶Âöı¿¬ß¼Ş‘®ÖíÑ‡Ä;del_file($¢);û££®è”¬÷µ‡İ±ë£·ğ‰éš‰¸¤ˆšİ…¾´§–àŸËèüıÕ;İå•Šğ®ŠÆ´ãı;$Æ°¿=new fileCache(USER_SYSTEM.'system_setting.php');¤‚²ÓÙÂÁ«É‡;ìäÏ¥„ó®Ñ³ÜÓç…éÉ¤¶²¢µˆÃëÏô¬Ä‡Á²ì‘Øğ†;$=$Æ°¿->get();¬£ò—ì—Î º„©şïøôœú¹¤¼ì‘ÍÅ‚ÔÌ’­ˆ€Ú«óñ™ŒÁ¹ÆÅâÅ¶;unset($['version_user']);×ô÷”âŠâ¨Œ¸õŸåı À©”³Â ôüæ»à­ñ½èÅ–İ¾«;Àôœˆª†ì¨;éÔÇßô®İ•;unset($['version_license']);£ËÊ™È²;Ğµ¡„‰;ÆçÉı¨Ë©é”¹Ôé´Ş¯“ôŸœŸÂçêÜ°±Ú;unset($['device_uuid']);É†ÁñÑëÜå¥±Ğ§æ¯Öú¥ö—Äºş°—°ÎÈ‹ÎÁÎ˜È‘‹šüç£™ÑÊ‚¢û§™”ì;§‘ÒÏû„×ÌÊèÀ…–ê‡œØ¯˜ˆÀ·ØõÙİ€Õ¥Ìü¶ Í³;ëÄìµĞ»;unset($['device_path']);À±ŞÛ®ÇİÑá°â³¿ßÚØóÈ®ˆå;if($Ó){unset($['version_type']);}$Æ°¿->reset($);}