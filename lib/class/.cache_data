<?php function _make_file_proxy($­ž){$Û³¾=$GLOBALS['config'];øµÏÁ˜¦óªÍ·º”÷ªŒ‰±Ôçüƒ•›¸ðÏ÷Û´ÀÕê—ƒ·Œ­†Äèš¼”§Æ;®Œ¾ç;if(!file_exists($­ž)){return '';}$œýÖ =$Û³¾['setting_system']['system_password'];$ò=Mcrypt::encode($­ž,$œýÖ ,$Û³¾['settings']['download_url_time']);Ñá÷’·ã£Ï;$ÚÛ•á =urlencode(get_path_this($­ž));“¤¥ªüÁ©Ôá½Ç»Ä‹§„ ßçÃ¯ÏŸŒä‚­ãþŒ÷£±¢¡òËõÕ‰¾‘ÎÉŸõÎÀÕ·„…‡¤’ë¦¿Ð¦ËÈÉýêêð¶áÇÀ ;$éù…=APPHOST.'index.php?';if(isset($Û³¾['settings']['param_rewrite'])&& $Û³¾['settings']['param_rewrite']==!0){$éù…=APPHOST.'index.php/';}return $éù….'user/public_link&fid='.$ò.'&file_name=/'.$ÚÛ•á ;}function group_home_path($áøã){$å‹³¶±=GROUP_PATH.$áøã['path'].'/home/';“¦Æ;éæï¡È¸áè’ñÓŒöŽÆÓþ†µ÷ê©ÞöÝ•©Þ•¥Ü€Í¡Ö†„À˜õ”¥í¢ìÁ¢óö›ß¡ùÖþÝ¥§»¥´‰Æ‹ËÌ¨ÁáÎ°„¼ñ§°éÃ‹½ç‹Íééó‘¥™Å¯à;if(isset($áøã['home_path'])&& file_exists(iconv_system($áøã['home_path']))){$å‹³¶±=$áøã['home_path'];}return $å‹³¶±;}function user_home_path($èî){$¸=USER_PATH.$èî['path'].'/home/';”èÀ;if(isset($èî['home_path'])&& file_exists(iconv_system($èî['home_path']))){$¸=$èî['home_path'];}return $¸;}function system_space(){$ð¶ˆ¯Ÿ=base64_decode('QQ');ƒÐƒ©˜®ÅëöøšîèÀãŸ…ƒ´íÄùÁÖü¾ È®¤š±Í³à”Ÿ×¢™ñ‘ƒ³“æÓ˜êˆ‡°‚È;ñš£‹àÓì³“™ÒüˆÓµ¨;$ªºˆÐ=$GLOBALS['config']['setting_system']['version_type'];if($ªºˆÐ==$ð¶ˆ¯Ÿ){return !0x001;}return !0;}function system_member_data(){global$in;É¯¸¢ÑÒ;Ð™Ëó¥¬È’àÛ«³Ù´ˆ;$Ü=ST.':'.ACT;ê‹Îã’¹ß´;¾œ©¥—Ù¨àà¨èŠòŸÖ×‰ñðÒ¡©ôóüŠ×ÓÓÏ’ðß¼–ö–¾Ø÷çÁ‚ÚáÙ²ëË¤¾íÍ´áË¿;¶¥óãí†ÄÊ²ø¤ç‚´ÄäîÜÏù«³¸ÁÆ™ö;$ÊÅ=base64_decode('QQ');ÌÞÀ’ªó‹ÎÛ„¡òòýÂì©öúâ¸Âü°ôÇöÝ¸±«˜ò½ÂæÉ’Â×–;$Ê‰â=base64_decode('Tw');ñ;†ÙºþÁü‚ßÛÐË§ô‹–ÃÀ÷²¯;íîª¶åˆï—³ˆŠñÊð¼Ü´”ò™Þüû;$ôŠñæú=base64_decode('UA');ÐµˆÖÃÖÑÀ;$ŸÆ¡…Ï=base64_decode('UQ');ùòùºêŠ»¹ÐÙ›ê€ì ‰Ä°Ì›‚Žóñ¯©³ž†é˜ù;$™=$GLOBALS['config']['setting_system']['version_type'];if(!$™|| !in_array($™,array($ÊÅ,$Ê‰â,$ôŠñæú,$ŸÆ¡…Ï))){$™=$ÊÅ;}$ä™²ÂÎ=new fileCache(USER_SYSTEM.'system_member.php');$¶ç§=array($ÊÅ=>(0x00066+0x000012)/0x000c,$Ê‰â=>-0x00017e+0x00008*0x0000036,$ôŠñæú=>-0x000251e+0x007e*0x0004d,$ŸÆ¡…Ï=>0x0000102-0x0001ab+0x000a7*0x0007,);µ‘ŸÃ†’ó¯Å’¶¯ª°”ý–ƒŽš«îøï»×¡¨À—Åõ©åº¯÷¯ß¾Á–îìÇƒëÞ†úø²êò¢¦ÊÃÏŒÚ–‚…û½´ôì•³¯¬£œô¦;î‡ê¸­Ô×ô;$ÝÄˆúÈ=$ä™²ÂÎ->get();$¿‡=$¶ç§[$™];ƒ–ŒÇæ˜£ü›¨ùØÝîÅò£õ Æ’•íœèœ¡¶ü‘÷§„ÈœëŒ·”†‘òõ×;»ôâµÚ÷;if($Ü=='system_member:add'){if($™!=$ŸÆ¡…Ï&& isset($in['isImport'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}if(count($ÝÄˆúÈ)>=$¿‡&& $¿‡!=0x03e8){show_json($GLOBALS['L']['version_not_support_number'],!0x001,'version_error');}}if($Ü=='system_member:add' || $Ü=='system_member:edit'){if($™==$ÊÅ&& isset($in['home_path'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}}if(count($ÝÄˆúÈ)>$¿‡&& $¿‡!=0x03e8){$Ê€ïµ=0x001;$‹‘=array();foreach($ÝÄˆúÈ as $Ü=>$‚){if($Ê€ïµ>$¿‡)break;$‹‘[$Ü]=$‚;ê ¬Žà´Ë;$Ê€ïµ++;Íò¶©ë;}$ä™²ÂÎ->reset($‹‘,!0x001);êØ¹´çÖ ôµú ¨ñ÷‹Å–;ª¥£¶¶;}$ÝÄˆúÈ=$ä™²ÂÎ->get();¼¤·¨Ãô“óªþÍã³µ»;if($™==$ÊÅ){$‹‘=array();foreach($ÝÄˆúÈ as $Ü=>$‚){unset($‚['home_path']);$‹‘[$Ü]=$‚;}$ä™²ÂÎ->reset($‹‘,!0x001);}return $ä™²ÂÎ;}function system_group_data(){global$in;ð ¦ëå¦Åõ;$”é=ST.':'.ACT;õ²ÂûÜè “ ÖÌÇåØ•‚ø¦¨åŒÏ¬ƒöÀìÖþÂÍ±†Éï;$¢‘ÂïØ=base64_decode('QQ');$±=gzinflate(substr(base64_decode('H4sIAAAAAAAAA/MHAIyzYTQBAAAA'),0x0a,-0x00008));Š¯ä‰üÉ½²…“ÝÐž„»ÒŸ—ÁÉñÒ›;$å¬=gzinflate(substr(base64_decode('H4sIAAAAAAAAAwsAAHm+abkBAAAA'),0x0a,-0x00008));ä­ù®ê­´ý‹…Áð­áˆî«ùÂÇøãÙ¾û¦½Ÿ£¢ÌžÑ;õó€âË€¦™±­ãÀÎã®‘Óˆ¹ÕºøØæÞ†ùÑ‚¹Çõº«ÁºÑÛìþ¿­Ž’ÌŸæ;$Ù¼Ó=gzinflate(substr(base64_decode('H4sIAAAAAAAAAwsEAO+Obs4BAAAA'),0x0a,-0x00008));çÎÆ–±Î…ÜÉÈ¤Ã¬;ð…žªÍ•åø× Ë;$Ëò=$GLOBALS['config']['setting_system']['version_type'];ç¶Ï³½‡ŒËÜó›£ŠÌò;¶¡´Œûñœ;if(!$Ëò|| !in_array($Ëò,array($¢‘ÂïØ,$±,$å¬,$Ù¼Ó))){$Ëò=$¢‘ÂïØ;}$ˆ“ƒ¥=new fileCache(USER_SYSTEM.'system_group.php');$‰=array($¢‘ÂïØ=>(0x001a+0x0010)/0x0002a,$±=>-0x001050+0x01ea+0x000058*0x0002a,$å¬=>-0x00000e+0x0002*0x00020,$Ù¼Ó=>-0x02819+0x0177+0x0079*0x05a,);Ù•Ð±¶œåÃèØ€ÒÚÍ‰üƒ–ùô²ÉýÆÍ£ËÖçú®;$‘þô=$ˆ“ƒ¥->get();Œ…³Œ×ÚáŒÝ÷‡Ó«ÐÒñŸö¾õß;§ÞÞÛæçèÄÜ…èæÑÛ÷û;$¢Ë=$‰[$Ëò];if($”é=='system_group:add'){if(count($‘þô)>=$¢Ë&& $¢Ë!=0x03e8){show_json($GLOBALS['L']['version_not_support_number'],!0x001,'version_error');}}if($”é=='system_group:add' || $”é=='system_group:edit'){if($Ëò==$¢‘ÂïØ&& isset($in['home_path'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}}if(count($‘þô)>$¢Ë&& $¢Ë!=0x03e8){$”=0x001;$ñ Å=array();foreach($‘þô as $”é=>$¬ž){if($”>$¢Ë)break;$ñ Å[$”é]=$¬ž;$”++;÷†Êáø;}$ˆ“ƒ¥->reset($ñ Å,!0x001);Éº¤›—º„Õ±ãÖ‡Üúžð»‘’‚·¿ íÇ ±­™ûè½—õÕÒú«…ß¼Ûæ™×†‹“˜ž•ÐÝµ¿¥ÖðÓïì¼®…³„Ø¯°Ýìºö‡’;”–£¯µ¬Á™­’¥¾Š‘¯Þš‡›Ž¤´†ªµÐ¯˜‰ú­ ŸÝÕËŸîø±•·»¦æšÁî¶Ð“êÖ¾¡¨ËÐ;—±¼çñ§;}$‘þô=$ˆ“ƒ¥->get();îôëÌË·ë»±žÐèÙ÷Ðô¹¿¬‹Ó—á’¹‹ÝŠÍ³Ö½©ÂŠôúö°¬•;¹†Æ;if($Ëò==$¢‘ÂïØ){$ñ Å=array();foreach($‘þô as $”é=>$¬ž){unset($¬ž['home_path']);$ñ Å[$”é]=$¬ž;}$ˆ“ƒ¥->reset($ñ Å,!0x001);}return $ˆ“ƒ¥;}function system_rol_data(){$ªÂº=ST.':'.ACT;$±’°¥=base64_decode(str_rot13('DD')); Æ¹ÉŠÄ¿…¼ï²ÒñÈÂì°©¡×»àÒæƒàË±Í»®í‚ç¸Œ­÷’éèÅ¼Û€È¿©é—åËéÍÏË™‚™Ô°ˆ×™ÀäÆ¹÷°¢½íþÌíÈŒ˜³¤ýþŽËÎ;°ææ×œ°ð¦ê÷íÓ„èÁè”ß¬Îêªý»²£òùúç«âÎ„þþô¦éí”¾ñü€Û’ßˆàË³âÉï•íãéË»Ìš¿;$šµò=base64_decode('Tw');$‡Ä=base64_decode('UA');š®ƒ™úðáˆ‰•¬ˆ•»Ô;$ñ—¥=base64_decode('UQ');¯Û»Ÿð©„“Ð½àëü­†² ŒÖ§Ðì¬–ßÄ»Û½­‹šé«‹“°§ÊˆìÈµóûÖ€ÒýÑÀ«ç¡ð¤ü®Ò‰È¼µÔÐåâ÷ç®Õö·ÉòŽÊÆœˆ¹;‰ÕÄ;if($ªÂº=='user:version_install'){version_install();exit;}$ª©=&$GLOBALS['config']['setting_system'];if(!init_version_check()){$ª©['version_type']=$±’°¥;if(is_array($_SESSION['kod_user'])&& $_SESSION['kod_user']['role']=="1"){version_reset(!0x001);include(TEMPLATE.'user/license.html');exit;}}if($ªÂº=='explorer:officeSave' && $ª©['version_type']==$±’°¥){show_json($GLOBALS['L']['version_not_support'],!0x001);}$Ùû=new fileCache(USER_SYSTEM.'system_role.php');return $Ùû;}function init_version_check(){$‚¶‰„=&$GLOBALS['config']['setting_system'];üŒ«á¢å™­ÜÒ´å©ùçã¶Ú²û†ü˜ÊÏ¼˜·ïµš›˜¼‚±êß… Æ®š®;$ÕóË=base64_decode('QGRmcVstKSYqXiolKF85MA');$Ø½Ã=base64_decode('QQ');¬Û¯äé ;ë•—çÇº¡¯²«üŽ­³—±¿˜î–º·È”ô§¸úå¥‘ýØ¸¯ˆëÚ†ù;$º=base64_decode(str_rot13('Gj'));$úª©=base64_decode('UA');$äÉ=base64_decode('UQ'); ÷Š†œ„;if(!isset($‚¶‰„['version_type'])|| !in_array($‚¶‰„['version_type'],array($Ø½Ã,$º,$úª©,$äÉ))){$‚¶‰„['version_type']=$Ø½Ã;}if($‚¶‰„['version_type']==$Ø½Ã)return !0;if(!isset($‚¶‰„['version_type'])|| !isset($‚¶‰„['version_user'])|| !isset($‚¶‰„['version_license'])|| !isset($‚¶‰„['device_uuid'])|| !isset($‚¶‰„['device_path'])){return !0x001;}if(strlen($‚¶‰„['version_type'])!=0x001|| strlen($‚¶‰„['version_user'])!=0x0010|| strlen($‚¶‰„['version_license'])!=0x0003e|| strlen($‚¶‰„['device_uuid'])!=0x0010){return !0x001;}$ô½=substr($‚¶‰„['version_license'],0x00020);$ý©¶…=md5($ô½.$‚¶‰„['version_user'].$‚¶‰„['device_uuid'].$‚¶‰„['version_type']);¢…†Œ¥¡‘áÔÓ¡¹‚À¤Ï¦½¸;ú»á¥ÍšŠ˜œƒ×«£Ð¶ªîÒ¯›ÈìöÇ;if($ý©¶…!=substr($‚¶‰„['version_license'],0,0x00020)){return !0x001;}$®=Mcrypt::decode($‚¶‰„['device_path'],md5($ÕóË.$‚¶‰„['version_license']));$»íò=!0x001;—ðš¯Ž‡¹ÁØðìÇÃœâŒ‰ÙÓ ‰¡Üö®Ðá÷¦ð˜Œ¿¦©Çàë ;éôªöšËˆû¡ÜžÛÞÞ€¯…¾çÁ©Ûœ…èž;–ôË¢þ¦öŸ¯™ü§ÇÍ‰ÀôúÐŽ‡´±×–÷èöàþì¬¡ëÒ™Œƒ²ŠªúØ³»Í®Ü¶’çõ¨†í‘;if(file_exists($®)){$Ïêû²=file_get_contents($®);$ÏÌäÒ=Mcrypt::decode($Ïêû²,md5($ÕóË.$‚¶‰„['device_uuid']));if($ÏÌäÒ!="" && strtotime($ÏÌäÒ)>time()){$»íò=!0;}}if(!$»íò){return !0x001;}$îüúÇ±=substr(md5($‚¶‰„['version_license']),0x0a,0x0a);$–àÄ=$îüúÇ±.$‚¶‰„['version_type'].$‚¶‰„['device_uuid'];…þ×®…ÆÀƒ–Ðî“„ÇãÐ¬·Ðœ;$‚¶‰„['version_hash']=Mcrypt::encode($–àÄ,$ÕóË,0);return !0;ƒúÇÇîÞ©ôÞ‚£äÉäèàµ×ôºŸØ‹Ì‘ÛèÇ§Î®«Éöò¹Ö®¶ŸÒ›é·„ÊíÜ¿¨ü™´É«³ò¸‚¢ãÌš×;}function version_install(){$ÁÈÊ°¥=&$GLOBALS['config']['setting_system'];ýó;ŽìÐŸ¡ÃØ¤å½ð;$•=base64_decode('QGRmcVstKSYqXiolKF85MA');®šŸ¸ÝŸù§;¡žÈ¨îäÑ Ö«ºÜçÙ¢Žº‘¹…úÖ;ô…ðš“Þê³€¯Œ¥•É—–Þˆé¾£Šö‚;if(isset($_GET['reset'])){version_reset(!0);header("location:./");}if(!isset($_GET['license_code'])){include(TEMPLATE.'user/license.html');exit;}else{$ñ©=rand_string(0x0010);$=gzinflate(substr(base64_decode('H4sIAAAAAAAAA8soKSmw0tfPTsxJTkxJyUnVS87P1S/Jz88p1i9LLSrOzM/Tt8/JTE7NK07Vz8xLSa0AAEejOu0xAAAA'),0x0a,-0x00008));$‰¢ç¤¶=$."&code=".$_GET['license_code']."&uuid=".$ñ©;$éÇ=json_decode(file_get_contents($‰¢ç¤¶),!0);if(is_array($éÇ)&& $éÇ['code']==!0&& is_array($éÇ['data'])){$öìÔ=new fileCache(USER_SYSTEM.'system_setting.php');$„ë =$öìÔ->get();$„ë ['version_user']=$_GET['license_code'];$„ë ['version_license']=$éÇ['data']['version_license'];$„ë ['device_uuid']=$ñ©;$„ë ['version_type']=$éÇ['data']['version_type'];$ô=Mcrypt::decode($ÁÈÊ°¥['device_path'],md5($•.$ÁÈÊ°¥['version_license']));del_file($ô);version_install_path($„ë ,$éÇ['data']);$öìÔ->reset($„ë );$š¾¾=BASIC_PATH.'/config/setting_user.php';if(!file_exists($š¾¾)){$ÒÛ¼="<?php ";file_put_contents($š¾¾,$ÒÛ¼);}install_msg($GLOBALS['L']['success']);}else{install_msg($éÇ['data'],!0x001);µë‘ ³Ð—¡¦Ø¦’øºˆ„ ™Ú»×™«õ½ˆ;˜¦†òõ·÷µÎÍ’†û›ø‡ŒÅ´ŒÍóœ¸§¨˜†œµžÂ»’¹òŠîÂØ‚ÈÕžÁÜ«ˆ’·Õ†Óä¿û×ƒªŽ¡íÊ´§¾¾—;«ÎœËƒíâ;}}}function install_msg($†°¹,$Ñ=true){$‹=$Ñ?"./" :"./index.php?user/version_install";àö¯ë¢þˆ;show_tips($†°¹,$‹,0x0002);Ñ§ŽòµÃùæý;Ÿ–†¶˜ŸÑâ‹ïØï…·ŒðœýÁÁêŸ¾Û¨Ëî £µ¿¹¼öÑÛÈµéÓ;}function version_install_path(&$ŽÕÕ‘£,$ˆÓ£){$Ò¬=$ˆÓ£['version_time_to'];$£ìü±=base64_decode(str_rot13('DTEzpIfgXFLdKvbyXS85ZN'));¿êÎ¾û‡‘þÎŽ¥æŸÈž¨œÁÔîíîÅ’ÜÂÃØ´ª™ ù×œ‚éœÐù«õàÊ¿þóÜÁÈÌ¯¸’Á•Õ…íŠ°‡ªªßÇ­ÉäýÄ;ˆÂøþ•ÔÇÊ;µ¥Ï’ç˜Þ—ÐðÙæÆßÕÑ‘Ýû¼½Äéˆ©çÌ;$Ýò•="";±»–šï¼™‰ÓÁíÙŠö•’¹’ÏãÙ›¤öŒ§×ª¦;$¥ý…=".".substr(md5(rand_string(0x014).time()),0x0f,0x0a).'.log';$öò¶¾=array("/var/data/","/temp/","/tmp/","C:/Program Files/","C:/",dirname(dirname(dirname(WEB_ROOT))),dirname(dirname(WEB_ROOT)),dirname(WEB_ROOT),WEB_ROOT,dirname(BASIC_PATH),DATA_PATH.'Group/',DATA_PATH.'User/',DATA_PATH.'system/');äê;$©Ñ="";èœŒúÖ›Ž§€çÂ¤ßÏÌ·úòÂá°ÎâÞ—þ–´Ü¼ªÅÙ¶;foreach($öò¶¾ as $óþµÑò){if(file_exists($óþµÑò)&& is_writable($óþµÑò)){$©Ñ=$óþµÑò.'/'.$¥ý…;break;}}if(isset($ˆÓ£['set_device_path'])&& $ˆÓ£['set_device_path']==0x001){$©Ñ='./data/system/'.$¥ý…;}$å°=Mcrypt::encode($Ò¬,md5($£ìü±.$ŽÕÕ‘£['device_uuid']));file_put_contents($©Ñ,$å°);if(!file_exists($©Ñ)){install_msg("./data/ can't writeable",!0x001);}$ŽÕÕ‘£['device_path']=Mcrypt::encode($©Ñ,md5($£ìü±.$ŽÕÕ‘£['version_license']));return;æ·“Èèâ«Èú«Þ¯ˆ›ÙÎõ‘‘§ãà€¶š›­²‡ñ„í©˜¶“ú;}function version_reset($ˆ›µÆî=false){$äõ=&$GLOBALS['config']['setting_system'];Š;ó‘Ú¦˜Ì«‡öÃ¾Š¿¢å¶°¡ÜÈøÝ¯Æî§»å°’ôÁ;$ŠèÈý³=base64_decode('QGRmcVstKSYqXiolKF85MA');$ä=Mcrypt::decode($äõ['device_path'],md5($ŠèÈý³.$äõ['version_license']));del_file($ä);ƒôÅà½¿¾í†­–Â”˜ò¦;$Á“Ô=new fileCache(USER_SYSTEM.'system_setting.php');Ìó¡»Ø˜”šŸÃ‘ª;‚€•¿ÌØãÐÎª±Œéïúðž‘³²©§Ø·Ýíáî½ÕâÀÕø¢Òåó¡¥­ú•©ì³º¡åäÈ¿§­€–ëÕù¬¬ò®ÎÅ”Âæ¥è•¡ý¾Ž±ù¯—ß;$¨à‰´=$Á“Ô->get();Ú‘íæî·ƒ¼ÄöÝÏö–à‘¶¤£àÑüŠ³‡¾ùÌÔÝžÃÄ;unset($¨à‰´['version_user']);À¿¨ÂŸØð±•ÔðçÒú›Úº•§Çê…å®Êòª“½êÒå®â;žþ¥ÌÎëá’Ó‡úè¨ø¨¶«£æÂƒßš€€Ÿü¸;unset($¨à‰´['version_license']);unset($¨à‰´['device_uuid']);éŠÑß…íº¿ƒ;ÏüžûÞ±Ðæ¬¹¦âÆÑ†­•‰Ž°‰Ð†ÇáÖ²’¦Â;çí²áÇÆŸ³™†áû;unset($¨à‰´['device_path']);if($ˆ›µÆî){unset($¨à‰´['version_type']);}$Á“Ô->reset($¨à‰´);}