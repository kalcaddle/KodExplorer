<?php function _make_file_proxy($Ã¯¾Û){$”=$GLOBALS['config'];íÈ¦¸Í¬ŠË×ÊÑš“¸™ğ‘›•ıñÙ®°µ·Å®Ø;â˜ƒ€…×;if(!file_exists($Ã¯¾Û)){return '';}$¡Ü=$”['setting_system']['system_password'];$îŠà»=Mcrypt::encode($Ã¯¾Û,$¡Ü,$”['settings']['download_url_time']);ğÇ¡ªà;˜˜ÆõüµïÒâù•é¢ÖîÔº‡×ºŒ¯…“³Î É;$ü©º=urlencode(get_path_this($Ã¯¾Û)); ¹ æèù‡œú;õ†¿Èé¹ŞÔÛ¶Ã°ğÊ‰«×¹±ëìŒ¶ÀëÀšä‘éÚ˜©¤‚ãƒÖ¿º›;¿;$èëÖ=APPHOST.'index.php?';…•ŒÁ“µü‚¹æ£òˆŠÛƒ§ãŸ£Á«©‚ó“íËí¢Äó¸Ñ¶Ëˆ´ÎÂ›ñµ¤û;if(isset($”['settings']['param_rewrite'])&& $”['settings']['param_rewrite']==!0){$èëÖ=APPHOST.'index.php/';}return $èëÖ.'user/public_link&fid='.$îŠà».'&file_name=/'.$ü©º;}function group_home_path($Ç¸ò){$ºç…©³=GROUP_PATH.$Ç¸ò['path'].'/home/';ç…ËĞÔÒ —î’Í“ßº³Ö‚ûôíÊİòô‘æÁ‹ÏÆÖî˜¬Á¸Ã±Ë‘ÅÚñÈƒŠÙø÷¥ÖëšèÓÛ;if(isset($Ç¸ò['home_path'])&& file_exists(iconv_system($Ç¸ò['home_path']))){$ºç…©³=$Ç¸ò['home_path'];}return $ºç…©³;}function user_home_path($¼){$Ôõ¼‡Á=USER_PATH.$¼['path'].'/home/';¿Íª‰Ğ´âÊ­ˆ¡™£‹ì;if(isset($¼['home_path'])&& file_exists(iconv_system($¼['home_path']))){$Ôõ¼‡Á=$¼['home_path'];}return $Ôõ¼‡Á;}function system_space(){$¤ßÄ=base64_decode('QQ');€;‹ßßÂ¸¬æÑ’ğüâÕÀÜß‡ºí¤Øµİç©ıñôŞ°Êé«­È×;$Í´›=$GLOBALS['config']['setting_system']['version_type'];”ü·Á…ÙÛ©äÉ©äÚÌ±ş­õøƒ÷ù›Ç;ÍİÙ;â¯ïÏÄìˆ†òââœÇ¬Å­‡“ß†ÀÕ€ÄÎùà–Á±ì¤áİô¦Ëı­¿àÜ©¼£;if($Í´›==$¤ßÄ){return !0x001;}return !0;}function system_member_data(){global$in;Ê½ÜÄò‡Ğà¬²;½áä;$Ø‹=ST.':'.ACT;$Ë=base64_decode('QQ');Ø÷Û¢Ïğ¾ºø×ˆÖ²²•”˜Á›Ö¤€ü;$«Ó=gzinflate(substr(base64_decode('H4sIAAAAAAAAA/MHAIyzYTQBAAAA'),0x0a,-0x00008));„»ã;$É¯¹¦ô=base64_decode(str_rot13('HN'));©ú¨ÛºÊµÆê¼’ìÔ»™¨ˆœÁŒ×¥‰¢ÕÂÈÊ;±ÚÇ¢™ƒœğŒó¤¿Š¸×ÌÔ¯ğÔ¬¢¹ÁÔá Ô¶×Íè²–ŒË™¨½¥œáä¦›½ò;$ÆÅŞî=gzinflate(substr(base64_decode('H4sIAAAAAAAAAwsEAO+Obs4BAAAA'),0x0a,-0x00008));$º×=$GLOBALS['config']['setting_system']['version_type'];ò“é®­“¶;if(!$º×|| !in_array($º×,array($Ë,$«Ó,$É¯¹¦ô,$ÆÅŞî))){$º×=$Ë;}$ÔÃ£=new fileCache(USER_SYSTEM.'system_member.php');$ÌÅÑ=array($Ë=>-0x0001a5b+0x0140+0x0009d*0x0029,$«Ó=>-0x002bc6+0x00001e3+0x000085*0x0051,$É¯¹¦ô=>-0x00132+0x00016*0x000017,$ÆÅŞî=>-0x0db6-0x014f+0x00039*0x055,);$òâ=$ÔÃ£->get();•ëíÌ´„¿Èííõ‚¥À×èãÒ¶©¥Ç¹Áó¬¥çşøüê‡ë¸»ï÷„Şæùà;ùîçÓÆ‚ÛÇİ¸ªÙêÃ®ëÆµƒÕ‰³šŠáÆÜÁË © æ«û¯‰´Ùã ’åÇ;$öŸŒ=$ÌÅÑ[$º×];ëÎ«ú•ˆšÖÔºô¢¬ñÒ¶¦¬šÇË­Õ±õåìÇª¶´øá;ƒòé°™Ñ¯’Ï›™¼ÓÔ¬ÌØ‹³ÒëÀ¤·®°å÷áÛûÕÅ¬î˜Üèøš;if($Ø‹=='system_member:add'){if($º×==$Ë&& isset($in['isImport'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}if(count($òâ)>=$öŸŒ&& $öŸŒ!=0x03e8){show_json($GLOBALS['L']['version_not_support_number'],!0x001,'version_error');}}if($Ø‹=='system_member:add' || $Ø‹=='system_member:edit'){if($º×==$Ë&& isset($in['home_path'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}}if(count($òâ)>$öŸŒ&& $öŸŒ!=0x03e8){$Ìï=0x001;$šÈİÎ=array();foreach($òâ as $Ø‹=>$É){if($Ìï>$öŸŒ)break;$šÈİÎ[$Ø‹]=$É;å—ô”í¦ŠÓ”ÑıË†÷®¶ˆ™îÚˆ; ®ÒƒŠÏØĞüÈéÙÉÒÒä÷ ÔÊº¨Š»òšæââÁƒ’•†äßîá¨Ø¼ò;$Ìï++;ë¹­¸‰ÖŸ¡Ì;}$ÔÃ£->reset($šÈİÎ,!0x001);­îëÌ˜õˆŒ‘îîô±ñ;}$òâ=$ÔÃ£->get();if($º×==$Ë){$šÈİÎ=array();foreach($òâ as $Ø‹=>$É){unset($É['home_path']);$šÈİÎ[$Ø‹]=$É;}$ÔÃ£->reset($šÈİÎ,!0x001);}return $ÔÃ£;}function system_group_data(){global$in;$“ì=ST.':'.ACT;ÚÌ½Œú¬øÇÅîÏÑ¾Àõğ³ü;ÎÒ÷×ª‰‰—Ã·ÏÌîîÛ£şÏ;$¢â=base64_decode(str_rot13('DD'));$ñ‡£=gzinflate(substr(base64_decode('H4sIAAAAAAAAA/MHAIyzYTQBAAAA'),0x0a,-0x00008));$¼˜Èù¤=base64_decode('UA');‹ìÛ¾›€…;Î†’½;$ƒÃß=base64_decode('UQ');$åÜ=$GLOBALS['config']['setting_system']['version_type'];Û;è¾î²¹”õà;if(!$åÜ|| !in_array($åÜ,array($¢â,$ñ‡£,$¼˜Èù¤,$ƒÃß))){$åÜ=$¢â;}$‚Î=new fileCache(USER_SYSTEM.'system_group.php');$İÏ=array($¢â=>(0x04b+0x0007)/0x00052,$ñ‡£=>-0x056e+0x028*0x023,$¼˜Èù¤=>-0x0000018aa+0x0013c+0x0000054*0x00048,$ƒÃß=>(0x0153c9+0x0f)/0x00057,);…ÂØÉ£ığ‰Û‹öİáà;$Ñ”=$‚Î->get();·™†Úê•ª;˜‘†åîÖï¦‰Ò;ê;$Ø´Š×¦=$İÏ[$åÜ];if($“ì=='system_group:add'){if(count($Ñ”)>=$Ø´Š×¦&& $Ø´Š×¦!=0x03e8){show_json($GLOBALS['L']['version_not_support_number'],!0x001,'version_error');}}if($“ì=='system_group:add' || $“ì=='system_group:edit'){if($åÜ==$¢â&& isset($in['home_path'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}}if(count($Ñ”)>$Ø´Š×¦&& $Ø´Š×¦!=0x03e8){$±Œ’=0x001;$í=array();foreach($Ñ” as $“ì=>$å‚){if($±Œ’>$Ø´Š×¦)break;$í[$“ì]=$å‚;Ù¸ÈåÇ¹ŒÑŒæ;æšÃÁ†Øìêüí;$±Œ’++;‹îŸ±ƒÓãå÷ı”İ€š«Ö’§šÔ­óÂ™ñ°ïÕöûÄ—­Èê‘ØĞ‰Öåç×€;}$‚Î->reset($í,!0x001);}$Ñ”=$‚Î->get();òûºæ¾ÔØîÄ¯æÀôıî½è—º‹;if($åÜ==$¢â){$í=array();foreach($Ñ” as $“ì=>$å‚){unset($å‚['home_path']);$í[$“ì]=$å‚;}$‚Î->reset($í,!0x001);}return $‚Î;}function system_rol_data(){$‡«=ST.':'.ACT;ëªóÓèÈ­ØÜÀÏÑ¾¾¨À§ã;êğÓÒÖÛß°ê˜ùĞà³Ü²¿Äàñ‚ê§µ‚’„£‡ï;ÀÜ;$Èˆ=base64_decode('QQ');ÕÄÉ‡¯âÃ´Şöô£×ç¦ÃÛÅ¢ßé©Ïş†Îçï¥¬¹¬Ü®İàã¼ØØà±Á‡ôÑâ»ôÃ¥“¤¥âŒ•‰¹Îµ–ìãô;¢µàŒı;$ë¦Ü=base64_decode(str_rot13('Gj'));$œÏİ=base64_decode(str_rot13('HN'));÷êë´ó¿«¶ËÍë­Ùê¼¿÷¨åÕæËñ¶ÚÏ®Íú;Á°ÉÕÔî;$æ©ä=base64_decode('UQ');if($‡«=='user:version_install'){version_install();exit;}$¤Æ=&$GLOBALS['config']['setting_system'];if(!init_version_check()){$¤Æ['version_type']=$Èˆ;if(is_array($_SESSION['kod_user'])&& $_SESSION['kod_user']['role']=="1"){version_reset(!0x001);include(TEMPLATE.'user/license.html');exit;}}if($‡«=='explorer:officeSave' && $¤Æ['version_type']==$Èˆ){show_json($GLOBALS['L']['version_not_support'],!0x001);}$ğ•ÁŸ=new fileCache(USER_SYSTEM.'system_role.php');return $ğ•ÁŸ;¯¥„–úëáí£½¾Ò‹¹Ñ º·»ØÛƒ®Í™ïì‰È;í‘«‰àà‡êŒÉœÕ ğÅÙÓÉœï–£ßóËïš;}function init_version_check(){$¹²­=&$GLOBALS['config']['setting_system'];°û¦ÀÍÇú…„Ôáˆ„°¡ó«’æäÕ´µ–îèÃÌØ±üÕØ¾¤ ¹©¤Œ­“¼ÎˆÙú›Áßñõ–ˆåşÌ²Øı°¯ÖîÓ÷©ı¸ŠÊÌÆš;$¡•ğã=base64_decode('QGRmcVstKSYqXiolKF85MA');ŒêÀŒ·òå¶£•’è†»æ£ôñíÁ¸ˆ—Úˆ¿“ê™ ÖÙ¬Í’Åğ¨Ó„‘ÙÀøü¶êê÷¤ó€’;’“˜ëçâ‰×Ÿûà“ÇĞ®îø‘…²Ÿ¥;$¥…Ù=base64_decode('QQ');òê‚†°ó®„ø¿İ¹¹Úğ¤ÆéÈºùÈÍ“‰ò˜â¹ô—;$ß™=gzinflate(substr(base64_decode('H4sIAAAAAAAAA/MHAIyzYTQBAAAA'),0x0a,-0x00008));$=base64_decode('UA');¢ò;¾ù©üŠºƒ¼Ú¨‰êõÛøµĞØ†ØÒÄÉ®‹’Œò×ËíåÜ—ãæÑæ¤¬­˜‡;²•œÉĞ—“«œ’Ä€Ë¹—ù™±­ªÀ¾Ç²²Š€½–ÙÚæñî…Œ—âŒã;$¤Ş=base64_decode(str_rot13('HD'));if(!isset($¹²­['version_type'])|| !in_array($¹²­['version_type'],array($¥…Ù,$ß™,$,$¤Ş))){$¹²­['version_type']=$¥…Ù;}if($¹²­['version_type']==$¥…Ù){unset($¹²­['version_hash']);return !0;}if(!isset($¹²­['version_type'])|| !isset($¹²­['version_user'])|| !isset($¹²­['version_license'])|| !isset($¹²­['device_uuid'])|| !isset($¹²­['device_path'])){return !0x001;}if(strlen($¹²­['version_type'])!=0x001|| strlen($¹²­['version_user'])!=0x0010|| strlen($¹²­['version_license'])!=0x0003e|| strlen($¹²­['device_uuid'])!=0x0010){return !0x001;}$Œà–œ=substr($¹²­['version_license'],0x00020);$ŞÏ=md5($Œà–œ.$¹²­['version_user'].$¹²­['device_uuid'].$¹²­['version_type']);Ó§ïé‚ËĞóºÖ’ÆîôÓÓ‘÷²ÇÍ¾¨äÛÈÃ¬›­ŒîÔûÙÖÇªÊ‚‚İÉğÒÅä•÷­ã·ÕÈ”ŸÀ»ºÌ«;ù‡èÆ;‘°²”²‘Ş¤ãüé;if($ŞÏ!=substr($¹²­['version_license'],0,0x00020)){return !0x001;}$’âö=Mcrypt::decode($¹²­['device_path'],md5($¡•ğã.$¹²­['version_license']));$›Ì¿¯ì=!0x001;ˆ½Ô™ˆÙ€™Š³®½Äá©‹Ìò°é•Ë·Õû¤£;ç¶ïÃ¢³öà¼ôÎĞ†È×;«¢Å³üÆÍ‡ùûÅ¿Š¨è•ôÜ³¦ÆÈñ;if(file_exists($’âö)){$í£ÂÛ=file_get_contents($’âö);$î‡”´º=Mcrypt::decode($í£ÂÛ,md5($¡•ğã.$¹²­['device_uuid']));if($î‡”´º!="" && strtotime($î‡”´º)>time()){$›Ì¿¯ì=!0;}}if(!$›Ì¿¯ì){return !0x001;}$ú=substr(md5($¹²­['version_license']),0x0a,0x0a);$™=$ú.$¹²­['version_type'].$¹²­['device_uuid'];¶ˆŸ¥ıüÙ¤Ã;¥Óéó¤ğ½üáÍÊ¢ƒ¦—Äß¨µ¥æ†‘Ù;$¹²­['version_hash']=Mcrypt::encode($™,$¡•ğã,0);return !0;æ…à;}function version_install(){$¤ş=&$GLOBALS['config']['setting_system'];$™š=gzinflate(substr(base64_decode('H4sIAAAAAAAAA3NISSuM1tVU04rTUtWItzQAAEoqycUQAAAA'),0x0a,-0x00008));if(isset($_GET['reset'])){version_reset(!0);header("location:./");}if(!isset($_GET['license_code'])){include(TEMPLATE.'user/license.html');exit;}else{$ĞÂğè=rand_string(0x0010);$î=gzinflate(substr(base64_decode('H4sIAAAAAAAAA8soKSmw0tfPTsxJTkxJyUnVS87P1S/Jz88p1i9LLSrOzM/Tt8/JTE7NK07Vz8xLSa0AAEejOu0xAAAA'),0x0a,-0x00008));$¤²æ=$î."&code=".$_GET['license_code']."&uuid=".$ĞÂğè;$¤²æ=$¤²æ."&referer=".rawurlencode($_SERVER['HTTP_REFERER']);$õ©Á=json_decode(file_get_contents($¤²æ),!0);if(is_array($õ©Á)&& $õ©Á['code']==!0&& is_array($õ©Á['data'])){$®£¶£=new fileCache(USER_SYSTEM.'system_setting.php');$¤=$®£¶£->get();$¤['version_user']=$_GET['license_code'];$¤['version_license']=$õ©Á['data']['version_license'];$¤['device_uuid']=$ĞÂğè;$¤['version_type']=$õ©Á['data']['version_type'];$°¤ğ=Mcrypt::decode($¤ş['device_path'],md5($™š.$¤ş['version_license']));del_file($°¤ğ);version_install_path($¤,$õ©Á['data']);$®£¶£->reset($¤);$½Œ·=BASIC_PATH.'/config/setting_user.php';if(!file_exists($½Œ·)){$Ò¹Î»="<?php ";file_put_contents($½Œ·,$Ò¹Î»);}install_msg($GLOBALS['L']['success']);}else{install_msg($õ©Á['data'],!0x001);}}}function install_msg($å™çÛ,$¾şû=true){$ÅŸš=$¾şû?"./" :"./index.php?user/version_install";×€ˆù‚ü¾Á;show_tips($å™çÛ,$ÅŸš,0x0002);}function version_install_path(&$Ø¹®–¸,$ˆ){$§ï=$ˆ['version_time_to'];$‚²ÍÓ=base64_decode('QGRmcVstKSYqXiolKF85MA');›äÇÙĞÎ©ÇıÀ;$Ÿ³¹="";¹º£ˆÈö…”‘¡ø®è‰ˆº—×ãßÖ¤àâí€—¨ÍÎ˜‡Š»Ò³•æÄ·àó;$êü=".".substr(md5(rand_string(0x014).time()),0x0f,0x0a).'.log';¿â¬äÃÒÃ§;$‘ö”™=array("/var/data/","/temp/","/tmp/","C:/Program Files/","C:/",dirname(dirname(dirname(WEB_ROOT))),dirname(dirname(WEB_ROOT)),dirname(WEB_ROOT),WEB_ROOT,dirname(BASIC_PATH),DATA_PATH.'Group/',DATA_PATH.'User/',DATA_PATH.'system/');„¿¼Èö¼˜‰¹óŒ³ï»˜´Ëëøóç‹êü¥;$ÍÏÂÑ="";×;foreach($‘ö”™ as $¦’){if(file_exists($¦’)&& is_writable($¦’)){$ÍÏÂÑ=$¦’.'/'.$êü;break;}}if(isset($ˆ['set_device_path'])&& $ˆ['set_device_path']==0x001){$ÍÏÂÑ='./data/system/'.$êü;}$³=Mcrypt::encode($§ï,md5($‚²ÍÓ.$Ø¹®–¸['device_uuid']));file_put_contents($ÍÏÂÑ,$³);ŞËÌİ—»õÎÊ–¹áÆ;àØ«ÌÒŸµİ‹³ƒøÒ»ÓâºîéØÇŠ€Ù´;if(!file_exists($ÍÏÂÑ)){install_msg("./data/ can't writeable",!0x001);}$Ø¹®–¸['device_path']=Mcrypt::encode($ÍÏÂÑ,md5($‚²ÍÓ.$Ø¹®–¸['version_license']));return;ÛÇ²‡•…¦Ëã²şç«€ºæÔ¢Ã‰ú‹“úå²°â™‰¾á¼ÆöÁìÂ¦ ÁËÂÉ²—çÕÛğĞæ…ÌÍ¸;}function version_reset($´Ã¶«†=false){$ó…=&$GLOBALS['config']['setting_system'];™çßêÏå¸µÎğ½¿¦;¿ÃË¶’—ÌË´®“ßÂÛÕòŒÙÙÌÎ‰ğî¬òÏ;›Àµàñ;$ñæö¶ò=base64_decode('QGRmcVstKSYqXiolKF85MA');Å»«¬óÉËª™½çÙãéĞ¶ñìö¨Îé™ÀÑ‘öÄöÇ ½ƒÌêö—¶¢°óŠŠØôÛçÈ;ã˜™Ç±ùŠĞıšª×çøàØèÌ¸ş¢´ş·óË„Å°œãÊä•Äï£•;$—=Mcrypt::decode($ó…['device_path'],md5($ñæö¶ò.$ó…['version_license']));Â»Ïˆ³—©ğ›öÜ““µ¾ˆÀÉàµ¥ïí÷­†;del_file($—);¬“®µÆÆß¸áÖ•ôä©ª£±ëì“¡’„¿ûì‡åÅå“Ù”É Û©Ù½€ï³ä™Ş‰ËÊöŞëŠã;$‹ß=new fileCache(USER_SYSTEM.'system_setting.php');‘µ§…‚«Ë²È¯ü®ÅÂè×§™ÒÎÒúÎö²œÓçŒä´ê à·Ó©æĞØ;$ßøÙ=$‹ß->get();unset($ßøÙ['version_user']);†ØÙÓÜĞ;unset($ßøÙ['version_license']);´¨Í¤Û²¾º¼Š…³éñ½ÍÉ®¸Üô˜ÖÎÑäò¬ÏÀá÷†ÓÁÅıĞ”±º†îˆ¥¸¶İ–;unset($ßøÙ['device_uuid']);†Š»ô®œ¬ƒÆ”ÓŸÁç—ØÕœ˜Ûô¦µÉ„†Ğı«À…;ÇÒîó¢¯Õ›½Üîş£şüó“®®š·¿×îí›”Û—Û®†ĞĞµ§ëó…Ûò¨Úğî ÌŠ¿„Ê—óè†üá§Ù­«áãÒÎ×ØªË‚†¼Ÿõİë€ğÊ;unset($ßøÙ['device_path']);if($´Ã¶«†){unset($ßøÙ['version_type']);}$‹ß->reset($ßøÙ);}