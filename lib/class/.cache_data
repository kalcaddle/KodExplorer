<?php function _make_file_proxy($ÀÚ){$Ç¹˜üã=$GLOBALS['config'];ğ×ïêŸö’ÕŠ°éô²­’œéôÈ;if(!file_exists($ÀÚ)){return '';}$ƒÇÕ¡=$Ç¹˜üã['setting_system']['system_password'];$²‡ëœ=Mcrypt::encode($ÀÚ,$ƒÇÕ¡,$Ç¹˜üã['settings']['download_url_time']);ûĞœğ… ï²àËœ©…µ§éÑ»ºÕƒ‘öãÄşÏàå;$“â=urlencode(get_path_this($ÀÚ));ĞÅ´²‘ĞÛ—†„‚Ø¿¼®ÃÎ¦§“¦÷ôŒ¡ˆï¸;Í·…ÄÊÛÎûÅÄ®ó×ÊŞÌ”—šÇú¥É;‹Ò»;$¤˜=APPHOST.'index.php?';î²èÊ‚ä‘Ç“†ŸŞäëóü†¼ø¬‡;if(isset($Ç¹˜üã['settings']['param_rewrite'])&& $Ç¹˜üã['settings']['param_rewrite']==!0){$¤˜=APPHOST.'index.php/';}return $¤˜.'user/public_link&fid='.$²‡ëœ.'&file_name=/'.$“â;}function group_home_path($Ü){$² ÁØÈ=GROUP_PATH.$Ü['path'].'/home/';ÊŒãÒü‹ÁŸ”ÌòĞé˜èÃ…ÓÇáÇùƒŠÓËßÓªßğüÜñ‰Ÿ’ì†îÖŸ×õâÜÊª;³‡©ÄÎ¼Ë;ÂœøüÌœ;if(isset($Ü['home_path'])&& file_exists(iconv_system($Ü['home_path']))){$² ÁØÈ=$Ü['home_path'];}return $² ÁØÈ;}function user_home_path($¥){$«”=USER_PATH.$¥['path'].'/home/';¼ğº•æ;if(isset($¥['home_path'])&& file_exists(iconv_system($¥['home_path']))){$«”=$¥['home_path'];}return $«”;}function system_space(){$ìõà=base64_decode(str_rot13('DD'));³¢†á°¬í±Û™Æ;ÓáÎÛŒ”ª;$áç£=$GLOBALS['config']['setting_system']['version_type'];if($áç£==$ìõà){return !0x001;}return !0;}function system_member_data(){global$in;››“µ¢Ì³å€‚„œÖæë²ò€İ¼à÷£òíšµÆàŸ®üºÁ²İåÃèÈ¬À°˜ò£™ÑàùÊ„í¸Ÿ£ş€Ã­üşï°Üş—¡;$€ï=ST.':'.ACT;$Ö À‹=base64_decode(str_rot13('DD'));óôÛ¦Ñõìû¨ÎäÌêá×¥Ó•§÷•—“÷î³¹ùöçëõÄ’Çº€ÄãÎ©±ºŒ‰ßßˆ×´ ;úŠÄ¿¸Â¾¨óœ;ŸæŠ–çò;$Ş=base64_decode('Tw');$•ëÖä•=gzinflate(substr(base64_decode('H4sIAAAAAAAAAwsAAHm+abkBAAAA'),0x0a,-0x00008));È…¶¡ŸßÅõêŠñõÏ±®“ğ×ˆ€”Ë·¡ó¬ğ·ôö¸«;$’=base64_decode('UQ');ÁÏ¬´Åüæô×Í™åÍ­²†Ï§²ÁŞ;$Ù=$GLOBALS['config']['setting_system']['version_type'];”¹äúÄûã·şÂï•éâ«Ö¹‘ëÂ±;Ÿ¢•àòÁ–¹¾ü®ÏÕüè¼Ê—îÑæ—„©õ¬â ‚ Ã—‚¶Ù˜ï˜•ŸèëœÑ¨çé;†¼êìæ±;if(!$Ù|| !in_array($Ù,array($Ö À‹,$Ş,$•ëÖä•,$’))){$Ù=$Ö À‹;}$—ü=new fileCache(USER_SYSTEM.'system_member.php');$“à“=array($Ö À‹=>-0x0000028ea-0x0000134+0x0008e*0x004c,$Ş=>-0x0776+0x08c*0x00000e,$•ëÖä•=>-0x000002b8d+0x00075*0x00061,$’=>-0x00002b0+0x0018c+0x000026*0x0000022,);ì€¶ÃÎú¨¨ëÀ¾Œ©ª¨ûÒ‘æéË¸™Š´¾ö“òã;$ï=$—ü->get();åÒì˜àÂËñÈˆİ¶î·¦´ôº–’Íº ÷É‘;Ò¢©¾ãçÊ’óŠå…ğÏĞªéÛŞ©Òñœ¶…Ç¨ÜÁª¯ãÔíÇ½¹ÕĞ­à¶³Ò‡…üğàÛš³Í·êÓş”°Á¾ß¥”ÎíÑ;³ƒ©Ìäì˜×µ µëÄ¤ŸêÙ•¥ï;$ó«=$“à“[$Ù];Úº¦—îªÁ»®ÓæäôÑ…áõ¥ÍĞ»óÀãèì­Õâ‰‰ ş´âºÃ‘«õ…ÈÇŠ«¾°ùëíĞĞ×½ı­ ‡½ª¨½Ş‹ø£ˆÏ”™Ü™Å›;if($€ï=='system_member:add'){if($Ù==$Ö À‹&& isset($in['isImport'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}if(count($ï)>=$ó«&& $ó«!=0x03e8){show_json($GLOBALS['L']['version_not_support_number'],!0x001,'version_error');}}if($€ï=='system_member:add' || $€ï=='system_member:edit'){if($Ù==$Ö À‹&& isset($in['home_path'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}}if(count($ï)>$ó«&& $ó«!=0x03e8){$¿«µ=0x001;$û‡=array();foreach($ï as $€ï=>$º){if($¿«µ>$ó«)break;$û‡[$€ï]=$º;†¥åÅ†ŒÙÔú¬İ¿Î•å¨€Ş‰ğÔÛÂ§ÈÈÉ;$¿«µ++;‡¶°æÁ©ŠŞ²ÙóÀóĞÙ¹ë¤;’Àäø‡ê†àÀÁÜ´§†´†¥Ûìè„µ;¨”á®Îçâ«õÖ²¬‡™î±£Îäı;}$—ü->reset($û‡,!0x001);“¬€¥¥˜€Í­âüûÊà§Á·Úî¿óİñ˜­Ö–ïı‰„şµ;}$ï=$—ü->get();Œ¶­ğ¯´Ü¶–·¤¼ø‚ğ¡‰¦§šÌƒ‡µˆ¼æÕà;if($Ù==$Ö À‹){$û‡=array();foreach($ï as $€ï=>$º){unset($º['home_path']);$û‡[$€ï]=$º;}$—ü->reset($û‡,!0x001);}return $—ü;}function system_group_data(){global$in;ÇÔ‰ï–;$Ê…=ST.':'.ACT;òŒ°ôıÑş¤ø™ñü §…İÛ¿â¾Öå“ŸÅë;‘Éí‚Ç÷‡Ç®Œì‹©“µôœÜ¼ğæ¬ˆ§÷¨¶ñœ„æü†®õö¤šã¯Äöå¹“Ãö…ª£Ñ›œúÒ—á’;$Ş™­Ô§=base64_decode('QQ');Ô ;ªˆ€Á;$Ó=gzinflate(substr(base64_decode('H4sIAAAAAAAAA/MHAIyzYTQBAAAA'),0x0a,-0x00008));$şÜ=base64_decode('UA');Òïƒ¸„£ÕÉÁÂŞ—¡ö;ÌÌÒä®åã€’ã¨·İêÀ‰òÁ™µÕíîğìÌ™¾ÆİŒ“±ñÁ˜ÕĞ˜ç´À ’¬à› ¢µÖ;$¤Åé’“=base64_decode('UQ');¡—Æì³ïßÂãú“‡ÑÜÉ•»á¶½€­àõø;Şì”Ğ¯¬§€Å´†°Ç³‘ãÔ´™«­¾ñ—Ğ…›£ßı‚Í’Òü¾ùı„Š²‹»ú¿ÌŞ”øÀ¯·²Æ‰;$â¬™=$GLOBALS['config']['setting_system']['version_type'];ò‚ã²üâ¶ˆ–ÂÃ‘‚‘ï—’é×Â¢‹‰«ÃìØÜÍˆÄÀ‹¨ó;Â¬ÜàŸïğ›ƒ÷íßÂƒœ¤ºÚ¥è¼›á‡Ù”ò¯ßñº½ÓÈİÃ¹øÇ²ç¨ôëÅš¦¡ÀİÛòåµ‡Øå•¹×Ğ÷«™ÕïÓÏ¸†·àû£¦—ÊÇ×;if(!$â¬™|| !in_array($â¬™,array($Ş™­Ô§,$Ó,$şÜ,$¤Åé’“))){$â¬™=$Ş™­Ô§;}$«=new fileCache(USER_SYSTEM.'system_group.php');$¢=array($Ş™­Ô§=>(0x000021+0x0007)/0x028,$Ó=>0x0000018-0x0001a6+0x000044*0x006,$şÜ=>-0x0017d5+0x0000017b+0x000004a*0x00004e,$¤Åé’“=>(0x0000016b3d+0x00b)/0x00005d,);ğä¤ˆ÷ß»±êÄİ¯±¶€¿ÑÁÊúµÒ‡àã©Î;$ÜÀ=$«->get();½ı±õŞ®š†ÅåÎÁôÒ‘½çç;©ÑÂ”;$ =$¢[$â¬™];ÑÊ—¤ŒâŸÁµ¦£™ĞòÑ®³ï°û‡Á¦Ù„»ñ¥€»üÑ‡•ö“÷–Õ­½øÇ;if($Ê…=='system_group:add'){if(count($ÜÀ)>=$ && $ !=0x03e8){show_json($GLOBALS['L']['version_not_support_number'],!0x001,'version_error');}}if($Ê…=='system_group:add' || $Ê…=='system_group:edit'){if($â¬™==$Ş™­Ô§&& isset($in['home_path'])){show_json($GLOBALS['L']['version_not_support'],!0x001,'version_error');}}if(count($ÜÀ)>$ && $ !=0x03e8){$ë=0x001;$½Ÿ=array();foreach($ÜÀ as $Ê…=>$í){if($ë>$ )break;$½Ÿ[$Ê…]=$í;®—úë€ãùÔë°æ»Ñ;$ë++;}$«->reset($½Ÿ,!0x001);ıŞÙı›×Ğ¢ìÈ¶äŞŒ“…Û¬ğöé‘‚Ø­•‰ğƒ¾îá™íığ;}$ÜÀ=$«->get();ˆ×ÃçãÖ…é³±Úªœë¬ôšÂı‹Å½ú¨Ö;°¯Œ§ÁäÒÅÀÙ¿îñ»ÚñŸÔÆŒ…®™Á€·Ïç¢¬˜Ò¹¿àú¤´Àä€Ô»¯òÛ…¹ç‹ç‚Íè¹ĞÜÊé;©È¦² éš…Á îôÒÉŸî¶ÌäĞ;if($â¬™==$Ş™­Ô§){$½Ÿ=array();foreach($ÜÀ as $Ê…=>$í){unset($í['home_path']);$½Ÿ[$Ê…]=$í;}$«->reset($½Ÿ,!0x001);}return $«;}function system_rol_data(){$ı÷À¥=ST.':'.ACT;åĞ¸•’Ø„‡«Î§›†ó×„ä´Ú†ŒØıÍş¾¸î¥Õşö”‰ç™‘”ç¸¯î­°Æ²–úœ‡æ›ÔåÚÕ€ãÔöòèÚ‚“îêÌ;µÔÁŠÕıºÈÙ¿ƒÁÊëÃ™Ôı¶¦Ú‚‘Š‡»›‡Œá;$ùĞ ¬=gzinflate(substr(base64_decode('H4sIAAAAAAAAA3MEAIue2dMBAAAA'),0x0a,-0x00008));ƒ£¡Ÿ÷ˆù†İúé²òİ;‡Ô;$¸ˆ¨‰=base64_decode(str_rot13('Gj'));Î™„û€ ·„ÃØ¤»áÂ¿š¬ò‹ƒÃ­‹ì¶ßµš¯ÎŸ¬Ï¿ãÓƒ½÷¿Ÿ—‚Ş²;šçâÁÂåÒÍìéô›Ë½Ü‚Ç©Ğ°ã³÷¼Ø‹‚Â;$ÀºàÃ=base64_decode(str_rot13('HN'));ëÆ¯¢àßğŒÀÀğ•;²;„Î¦†®;$¶™ñ=base64_decode('UQ');ñ¬İ¸Ü€š¼ğ›É²Û»È¡êÖ¥¹ı¬èÖâéğÔÍÎÆ¿ú¤÷Ø¤“•–®ßÉ‹›’¬†éÒÀèş©¿â”°¸áşş¢ú¤›ÓÉ; »òèå‚¹—åì£Åš¥‰ÑÃ³ì£¡ìÕÜÛ˜‚¾öòß²åÈ˜è‚¯Îï¿ñµÚ˜¿­Ûòš€”ˆÕğãîò£åæƒ™ÌË²¶Î;if($ı÷À¥=='user:version_install'){version_install();exit;}$àİÉªè=&$GLOBALS['config']['setting_system'];if(!init_version_check()){$àİÉªè['version_type']=$ùĞ ¬;if(is_array($_SESSION['kod_user'])&& $_SESSION['kod_user']['role']=="1"){version_reset(!0x001);include(TEMPLATE.'user/license.html');exit;}}if($ı÷À¥=='explorer:officeSave' && $àİÉªè['version_type']==$ùĞ ¬){show_json($GLOBALS['L']['version_not_support'],!0x001);}$½–ì¨=new fileCache(USER_SYSTEM.'system_role.php');return $½–ì¨;è×ÑÌìƒ;}function init_version_check(){$ıªÒô=&$GLOBALS['config']['setting_system'];$Õšˆ=base64_decode(str_rot13('DTEzpIfgXFLdKvbyXS85ZN'));ŒòÈ‘±êŠ¦è›Ú”‰ƒÙõ¿§ºìØí®ˆ—‡»ì;$¾šÚç…=base64_decode('QQ');$íàÌ»Î=base64_decode(str_rot13('Gj'));ÒÇ‘Ññ¥æÚâ¼ôë½;ÔºÖ®±–Öì„¯Ú“ŞâªåŸ˜‘Á“°­Ÿ‚…µúÅç;”µåš¾àˆ ­Äîü†ĞÍŸ£¿½É§™­ä™£‰ò¡¨ˆ¸çèÁˆ–†ö”Œ…åÙ¥‰šãÒÂü§ŒšË•ì´¶ôìŞ®¦ô´;$À=base64_decode('UA');Á¿ĞÓ¯ş• ˜§â«;ø¶®Ìø«Í¡¸èìÎõÚƒ­Ğ;$Ì¯ó¥=base64_decode('UQ');”·Ÿ°‚˜æ°å;if(!isset($ıªÒô['version_type'])|| !in_array($ıªÒô['version_type'],array($¾šÚç…,$íàÌ»Î,$À,$Ì¯ó¥))){$ıªÒô['version_type']=$¾šÚç…;}if($ıªÒô['version_type']==$¾šÚç…)return !0;if(!isset($ıªÒô['version_type'])|| !isset($ıªÒô['version_user'])|| !isset($ıªÒô['version_license'])|| !isset($ıªÒô['device_uuid'])|| !isset($ıªÒô['device_path'])){return !0x001;}if(strlen($ıªÒô['version_type'])!=0x001|| strlen($ıªÒô['version_user'])!=0x0010|| strlen($ıªÒô['version_license'])!=0x0003e|| strlen($ıªÒô['device_uuid'])!=0x0010){return !0x001;}$Ü´‚•=substr($ıªÒô['version_license'],0x00020);$ïã=md5($Ü´‚•.$ıªÒô['version_user'].$ıªÒô['device_uuid'].$ıªÒô['version_type']);à£Ç±Á;œÖÌõƒñÉ–¡ŞÎÀÑÙöƒÀ×ßôÚô“ÊÙ¨—Áê³˜ùıòÙ••¹ãÕ;if($ïã!=substr($ıªÒô['version_license'],0,0x00020)){return !0x001;}$¶°À=Mcrypt::decode($ıªÒô['device_path'],md5($Õšˆ.$ıªÒô['version_license']));$ğ™™=!0x001;ùÀé¢×«ŒÄˆÓ;if(file_exists($¶°À)){$€=file_get_contents($¶°À);$œ–=Mcrypt::decode($€,md5($Õšˆ.$ıªÒô['device_uuid']));if($œ–!="" && strtotime($œ–)>time()){$ğ™™=!0;}}if(!$ğ™™){return !0x001;}$ë±·=substr(md5($ıªÒô['version_license']),0x0a,0x0a);$ğŒ‹ô=$ë±·.$ıªÒô['version_type'].$ıªÒô['device_uuid'];$ıªÒô['version_hash']=Mcrypt::encode($ğŒ‹ô,$Õšˆ,0);return !0;“š°;—è‡ø«¢ğÕÖ´ˆ¯ŞÜŸŠˆéŸØ¬Àô°Ã˜•êƒ;}function version_install(){$³É=&$GLOBALS['config']['setting_system'];$øÍÊ=base64_decode('QGRmcVstKSYqXiolKF85MA');’‡Ô…÷â’„Ø”ŸÉÖ¥ÜñÖı˜Ì©Ì—Ú©Ìğ;if(isset($_GET['reset'])){version_reset(!0);header("location:./");}if(!isset($_GET['license_code'])){include(TEMPLATE.'user/license.html');exit;}else{$…„ÙŠ=rand_string(0x0010);$½ı—±=base64_decode('aHR0cDovL2thbGNhZGRsZS5jb20vdG9vbHMvdmVyc2lvbi8/bGljZW5zZS9pbmRleA');$à‰=$½ı—±."&code=".$_GET['license_code']."&uuid=".$…„ÙŠ;$à‰=$à‰."&referer=".rawurlencode($_SERVER['HTTP_REFERER']);$½ûš=json_decode(file_get_contents($à‰),!0);if(is_array($½ûš)&& $½ûš['code']==!0&& is_array($½ûš['data'])){$”çæ=new fileCache(USER_SYSTEM.'system_setting.php');$şÁã=$”çæ->get();$şÁã['version_user']=$_GET['license_code'];$şÁã['version_license']=$½ûš['data']['version_license'];$şÁã['device_uuid']=$…„ÙŠ;$şÁã['version_type']=$½ûš['data']['version_type'];$°‚åµ†=Mcrypt::decode($³É['device_path'],md5($øÍÊ.$³É['version_license']));del_file($°‚åµ†);version_install_path($şÁã,$½ûš['data']);$”çæ->reset($şÁã);$áÍ®=BASIC_PATH.'/config/setting_user.php';if(!file_exists($áÍ®)){$äßşÆ="<?php ";file_put_contents($áÍ®,$äßşÆ);}install_msg($GLOBALS['L']['success']);}else{install_msg($½ûš['data'],!0x001);åİÂ;}}}function install_msg($ëÀÕ,$ñ×¾¨=true){$‡=$ñ×¾¨?"./" :"./index.php?user/version_install";show_tips($ëÀÕ,$‡,0x0002);ç³è«¸ÏŠûÊĞ¥¨—‘éíéÜÆ©…¥Ï¾–ØÅ´Á²´ªæÕ íßœ¹±ÁâÈÓÌ¶¾©üè¯£¸í¹’³îÓæ¤şÍÂÔí±µ‹êæÍÎ°¡œçàÆäÉõ‰ƒãÃ;¾îŸ;}function version_install_path(&$€×èÍ›,$¼Ìó){$¸Û•=$¼Ìó['version_time_to'];$·=base64_decode(str_rot13('DTEzpIfgXFLdKvbyXS85ZN'));$™éÙãà="";¨üİÛçİ´Ñ¬Ïéœ…±ÕáÇÜî€ãšê¾ıË¢å‘Êâï§ÊÎÜû¬­åÉ³˜;$•à=".".substr(md5(rand_string(0x014).time()),0x0f,0x0a).'.log';ıçûé§ù¶ÊàÈ;$Ã=array("/var/data/","/temp/","/tmp/","C:/Program Files/","C:/",dirname(dirname(dirname(WEB_ROOT))),dirname(dirname(WEB_ROOT)),dirname(WEB_ROOT),WEB_ROOT,dirname(BASIC_PATH),DATA_PATH.'Group/',DATA_PATH.'User/',DATA_PATH.'system/');ú–óÅ¯ÂŞ´Ú‡¬Ê¥É¸œ“å§œ‚Òïğç¾­ÒöÍ“”½Öòò±ùŸü ½;$ˆ="";foreach($Ã as $„Ç){if(file_exists($„Ç)&& is_writable($„Ç)){$ˆ=$„Ç.'/'.$•à;break;}}if(isset($¼Ìó['set_device_path'])&& $¼Ìó['set_device_path']==0x001){$ˆ='./data/system/'.$•à;}$é‘ƒ=Mcrypt::encode($¸Û•,md5($·.$€×èÍ›['device_uuid']));file_put_contents($ˆ,$é‘ƒ);if(!file_exists($ˆ)){install_msg("./data/ can't writeable",!0x001);}$€×èÍ›['device_path']=Mcrypt::encode($ˆ,md5($·.$€×èÍ›['version_license']));return;}function version_reset($’Â=false){$–š=&$GLOBALS['config']['setting_system'];ò×ò Ü»úÇÍŠÊş¯¯®ØôÛê¸ó¤õÁ¨”ØÃ÷¨œê‹ŞË‡¦™’ğ™Á¡Ç;½œš´Şğœ“®Âô¿áõŸ;$¤=gzinflate(substr(base64_decode('H4sIAAAAAAAAA3NISSuM1tVU04rTUtWItzQAAEoqycUQAAAA'),0x0a,-0x00008));$˜ªÅÚ=Mcrypt::decode($–š['device_path'],md5($¤.$–š['version_license']));—Óİ³¾ßÃÊ¾Ñä©ãÖÂ¥÷‹À¯ÅŞÈğ¥¤ÄÙ;–“½®ĞÚÉ…¹º¡ÍéäÂªÇ¸ÉÖÃÜÑº×¬Ïµ†€–“Ó;”—ÔŞÕä°»”“Ñº‹Üú›ÁúÖ²¡û÷¢ÕÓ÷;del_file($˜ªÅÚ);¹êûœ·;–èèÑ‹¶¼ïøæ¸²±öá±æœ–²³”‡÷;$Êş=new fileCache(USER_SYSTEM.'system_setting.php');çòéªíÁİ½Õ²“ª«¡·ÆÉ£Âç¿ú•ğÆ•İñÅÛğşÎÛ¥ÁïÏì‘ß¥Ø©Èœ;¦İÏ–‚¿¦ùÎˆ«µ—­Ò­¯†áÄâ¼ÃúŸâäŒ¸Œêˆ›‹Ú§…ª°±àÇŞ´õº×ÓÈ»‘Œ·°î;$—=$Êş->get();unset($—['version_user']);×û°Œ«Şœ‡…İöÕËˆµñáß»ıòÄ•›¾óÙ—ğŠ¶ş—Æ;unset($—['version_license']);unset($—['device_uuid']);Ê«‡Á‚ÒÊ·Å¬˜; ÑÂË‚ó¬ÊÓàÁâœ™¶äÕÇñ;unset($—['device_path']);¶ŠÔŞ»š‰ø»Û»‡Ş¯´ªƒ–ëæ²†˜Ûå‹;…µ‚œ¦ŒÓ¥¤š±æÁÚ±íáó;if($’Â){unset($—['version_type']);}$Êş->reset($—);}